<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="ArgoBooks.Controls.Reports.ReportDesignCanvas"
             x:Name="DesignCanvas"
             Background="#E0E0E0"
             Focusable="True"
             ClipToBounds="True">

    <UserControl.Styles>
        <!-- Margin guide style -->
        <Style Selector="Rectangle.margin-guide">
            <Setter Property="Stroke" Value="{DynamicResource PrimaryLightBrush}"/>
            <Setter Property="StrokeThickness" Value="1"/>
            <Setter Property="StrokeDashArray" Value="4,4"/>
            <Setter Property="IsHitTestVisible" Value="False"/>
        </Style>

        <!-- Selection rectangle style -->
        <Style Selector="Rectangle.selection-rect">
            <Setter Property="Stroke" Value="{DynamicResource PrimaryBrush}"/>
            <Setter Property="StrokeThickness" Value="2"/>
            <Setter Property="Fill" Value="#403B82F6"/>
            <Setter Property="IsHitTestVisible" Value="False"/>
        </Style>

        <!-- Grid line style -->
        <Style Selector="Line.grid-line">
            <Setter Property="Stroke" Value="#E0E0E0"/>
            <Setter Property="StrokeThickness" Value="1"/>
            <Setter Property="IsHitTestVisible" Value="False"/>
        </Style>

        <!-- Grid line major style -->
        <Style Selector="Line.grid-line-major">
            <Setter Property="Stroke" Value="#BDBDBD"/>
            <Setter Property="StrokeThickness" Value="1"/>
            <Setter Property="IsHitTestVisible" Value="False"/>
        </Style>
    </UserControl.Styles>

    <ScrollViewer x:Name="CanvasScrollViewer"
                  HorizontalScrollBarVisibility="Auto"
                  VerticalScrollBarVisibility="Auto"
                  Background="#E0E0E0">

        <!-- Zoom container using LayoutTransformControl for proper scroll behavior -->
        <LayoutTransformControl x:Name="ZoomTransformControl">
            <Border x:Name="ZoomContainer"
                    Padding="40"
                    Background="#E0E0E0">

                <!-- Page background -->
                <Border x:Name="PageBackground"
                        Background="{Binding PageBackgroundBrush, ElementName=DesignCanvas, FallbackValue=White}"
                        ClipToBounds="True">

                    <Grid>
                        <!-- Grid lines layer (behind everything) -->
                        <Canvas x:Name="GridLinesCanvas"
                                IsVisible="{Binding ShowGrid, ElementName=DesignCanvas}"
                                IsHitTestVisible="False"/>

                        <!-- Margin guides (hidden by default) -->
                        <Rectangle x:Name="MarginGuide"
                                   Classes="margin-guide"
                                   IsVisible="False"/>

                        <!-- Header area indicator with title and separator line -->
                        <Border x:Name="HeaderArea"
                                VerticalAlignment="Top"
                                Background="White"
                                IsVisible="{Binding ShowHeaderFooter, ElementName=DesignCanvas}"
                                IsHitTestVisible="False">
                            <Grid>
                                <TextBlock x:Name="HeaderTitleText"
                                           Text="{Binding Configuration.Title, ElementName=DesignCanvas, FallbackValue='Report Title'}"
                                           FontSize="18"
                                           FontWeight="Bold"
                                           Foreground="Black"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center" />
                                <!-- Separator line at bottom of header -->
                                <Border x:Name="HeaderSeparator"
                                        VerticalAlignment="Bottom"
                                        Height="1"
                                        Background="LightGray"
                                        Margin="40,0,40,5" />
                            </Grid>
                        </Border>

                        <!-- Footer area indicator with timestamp and page number -->
                        <Border x:Name="FooterArea"
                                VerticalAlignment="Bottom"
                                Background="White"
                                IsVisible="{Binding ShowHeaderFooter, ElementName=DesignCanvas}"
                                IsHitTestVisible="False">
                            <Grid>
                                <!-- Separator line at top of footer -->
                                <Border x:Name="FooterSeparator"
                                        VerticalAlignment="Top"
                                        Height="1"
                                        Background="LightGray"
                                        Margin="40,5,40,0" />
                                <!-- Footer content with timestamp on left and page number on right -->
                                <Grid x:Name="FooterContentGrid" Margin="40,0" VerticalAlignment="Center">
                                    <TextBlock x:Name="FooterTimestamp"
                                               Text="Generated: [Date/Time]"
                                               FontSize="10"
                                               Foreground="Gray"
                                               HorizontalAlignment="Left" />
                                    <TextBlock x:Name="FooterPageNumber"
                                               Text="Page 1"
                                               FontSize="10"
                                               Foreground="Gray"
                                               HorizontalAlignment="Right" />
                                </Grid>
                            </Grid>
                        </Border>

                        <!-- Elements canvas -->
                        <Canvas x:Name="ElementsCanvas"
                                Background="Transparent"
                                ClipToBounds="True">
                            <!-- Element controls are added here programmatically -->
                        </Canvas>

                        <!-- Selection rectangle (for multi-select) - on top of elements -->
                        <Canvas IsHitTestVisible="False" ClipToBounds="True">
                            <Rectangle x:Name="SelectionRectangle"
                                       Classes="selection-rect"
                                       IsVisible="False"/>
                        </Canvas>

                        <!-- Drop indicator for drag-drop -->
                        <Border x:Name="DropIndicator"
                                BorderBrush="#4CAF50"
                                BorderThickness="2"
                                Background="#204CAF50"
                                IsVisible="False"
                                IsHitTestVisible="False"/>
                    </Grid>
                </Border>
            </Border>
        </LayoutTransformControl>
    </ScrollViewer>
</UserControl>
