<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:controls="using:ArgoBooks.Controls"
             mc:Ignorable="d" d:DesignWidth="250" d:DesignHeight="200"
             x:Class="ArgoBooks.Controls.SidebarSection"
             x:DataType="controls:SidebarSection">

    <StackPanel Spacing="0">
        <!-- Section Header (from mockup: padding 15px, uppercase, 11px) -->
        <Border Padding="15,15,15,10"
                IsVisible="{Binding ShowHeader, RelativeSource={RelativeSource AncestorType=controls:SidebarSection}}">
            <Grid ColumnDefinitions="*,Auto">
                <!-- Title (hidden when collapsed) - displayed in uppercase -->
                <TextBlock Grid.Column="0"
                           Text="{Binding Title, RelativeSource={RelativeSource AncestorType=controls:SidebarSection}, Converter={StaticResource UpperCaseConverter}}"
                           FontSize="11"
                           FontWeight="SemiBold"
                           Foreground="{DynamicResource SidebarTextMutedBrush}"
                           LetterSpacing="0.5"
                           IsVisible="{Binding !IsCollapsed, RelativeSource={RelativeSource AncestorType=controls:SidebarSection}}" />

                <!-- Divider line when collapsed -->
                <Border Grid.Column="0"
                        Grid.ColumnSpan="2"
                        Height="1"
                        Background="{DynamicResource SidebarHoverBrush}"
                        Margin="10,5"
                        HorizontalAlignment="Stretch"
                        IsVisible="{Binding IsCollapsed, RelativeSource={RelativeSource AncestorType=controls:SidebarSection}}" />

                <!-- Collapse/Expand button with animated arrow (hidden when sidebar is collapsed) -->
                <Button Grid.Column="1"
                        Classes="section-toggle"
                        Width="20" Height="20"
                        Command="{Binding ToggleExpandedCommand, RelativeSource={RelativeSource AncestorType=controls:SidebarSection}}">
                    <Button.IsVisible>
                        <MultiBinding Converter="{x:Static BoolConverters.And}">
                            <Binding Path="IsCollapsible" RelativeSource="{RelativeSource AncestorType=controls:SidebarSection}" />
                            <Binding Path="!IsCollapsed" RelativeSource="{RelativeSource AncestorType=controls:SidebarSection}" />
                        </MultiBinding>
                    </Button.IsVisible>
                    <controls:ToggleArrow IconSize="12"
                                          Foreground="{DynamicResource SidebarTextMutedBrush}"
                                          Orientation="Vertical"
                                          IsCollapsed="{Binding !IsExpanded, RelativeSource={RelativeSource AncestorType=controls:SidebarSection}}" />
                </Button>
            </Grid>
        </Border>

        <!-- Section Items with animated expand/collapse -->
        <Border ClipToBounds="True"
                Classes="section-content"
                Classes.collapsed="{Binding !IsExpanded, RelativeSource={RelativeSource AncestorType=controls:SidebarSection}}">
            <Border.Transitions>
                <Transitions>
                    <DoubleTransition Property="MaxHeight" Duration="0:0:0.2" Easing="CubicEaseOut" />
                </Transitions>
            </Border.Transitions>
            <ItemsControl ItemsSource="{Binding Items, RelativeSource={RelativeSource AncestorType=controls:SidebarSection}}"
                          Padding="10,0">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <controls:SidebarItem Text="{Binding Text}"
                                              Icon="{Binding Icon}"
                                              PageName="{Binding PageName}"
                                              IsActive="{Binding IsActive}"
                                              IsCollapsed="{Binding IsCollapsed, RelativeSource={RelativeSource AncestorType=controls:SidebarSection}}"
                                              Command="{Binding Command}"
                                              CommandParameter="{Binding PageName}"
                                              BadgeText="{Binding BadgeText}"
                                              ShowBadge="{Binding ShowBadge}"
                                              TooltipText="{Binding Text}"
                                              IsVisible="{Binding IsVisible}"
                                              Margin="0,2" />
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Border>
    </StackPanel>

    <UserControl.Styles>
        <!-- Section Content Expand/Collapse Animation -->
        <Style Selector="Border.section-content">
            <Setter Property="MaxHeight" Value="1000" />
        </Style>
        <Style Selector="Border.section-content.collapsed">
            <Setter Property="MaxHeight" Value="0" />
        </Style>

        <!-- Section Toggle Button Style -->
        <Style Selector="Button.section-toggle">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>
        <Style Selector="Button.section-toggle /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="Transparent" />
        </Style>
        <Style Selector="Button.section-toggle:pointerover /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="Transparent" />
        </Style>
    </UserControl.Styles>
</UserControl>
