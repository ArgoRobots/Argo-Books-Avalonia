<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="ArgoBooks.Controls.Reports.ReportDesignCanvas"
             x:Name="DesignCanvas"
             Background="#E0E0E0"
             Focusable="True"
             ClipToBounds="True">

    <UserControl.Styles>
        <!-- Margin guide style -->
        <Style Selector="Rectangle.margin-guide">
            <Setter Property="Stroke" Value="#90CAF9"/>
            <Setter Property="StrokeThickness" Value="1"/>
            <Setter Property="StrokeDashArray" Value="4,4"/>
            <Setter Property="IsHitTestVisible" Value="False"/>
        </Style>

        <!-- Selection rectangle style -->
        <Style Selector="Rectangle.selection-rect">
            <Setter Property="Stroke" Value="#2196F3"/>
            <Setter Property="StrokeThickness" Value="1"/>
            <Setter Property="StrokeDashArray" Value="2,2"/>
            <Setter Property="Fill" Value="#202196F3"/>
            <Setter Property="IsHitTestVisible" Value="False"/>
        </Style>

        <!-- Grid line style -->
        <Style Selector="Line.grid-line">
            <Setter Property="Stroke" Value="#E0E0E0"/>
            <Setter Property="StrokeThickness" Value="1"/>
            <Setter Property="IsHitTestVisible" Value="False"/>
        </Style>

        <!-- Grid line major style -->
        <Style Selector="Line.grid-line-major">
            <Setter Property="Stroke" Value="#BDBDBD"/>
            <Setter Property="StrokeThickness" Value="1"/>
            <Setter Property="IsHitTestVisible" Value="False"/>
        </Style>
    </UserControl.Styles>

    <ScrollViewer x:Name="CanvasScrollViewer"
                  HorizontalScrollBarVisibility="Auto"
                  VerticalScrollBarVisibility="Auto"
                  Background="#E0E0E0">

        <!-- Zoom container using LayoutTransformControl for proper scroll behavior -->
        <LayoutTransformControl x:Name="ZoomTransformControl">
            <Border x:Name="ZoomContainer"
                    Padding="40"
                    Background="#E0E0E0">

                <!-- Page background -->
                <Border x:Name="PageBackground"
                        Background="{Binding PageBackgroundBrush, ElementName=DesignCanvas, FallbackValue=White}"
                        ClipToBounds="True">

                    <Grid>
                        <!-- Grid lines layer (behind everything) -->
                        <Canvas x:Name="GridLinesCanvas"
                                IsVisible="{Binding ShowGrid, ElementName=DesignCanvas}"
                                IsHitTestVisible="False"/>

                        <!-- Margin guides (hidden by default) -->
                        <Rectangle x:Name="MarginGuide"
                                   Classes="margin-guide"
                                   IsVisible="False"/>

                        <!-- Header area indicator with title -->
                        <Border x:Name="HeaderArea"
                                VerticalAlignment="Top"
                                Background="#10000000"
                                IsVisible="{Binding ShowHeaderFooter, ElementName=DesignCanvas}"
                                IsHitTestVisible="False">
                            <TextBlock x:Name="HeaderTitleText"
                                       Text="{Binding Configuration.Title, ElementName=DesignCanvas, FallbackValue='Report Title'}"
                                       FontSize="16"
                                       FontWeight="Bold"
                                       Foreground="#333333"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       Margin="0,15,0,0" />
                        </Border>

                        <!-- Footer area indicator with page number -->
                        <Border x:Name="FooterArea"
                                VerticalAlignment="Bottom"
                                Background="#10000000"
                                IsVisible="{Binding ShowHeaderFooter, ElementName=DesignCanvas}"
                                IsHitTestVisible="False">
                            <StackPanel Orientation="Horizontal"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center">
                                <TextBlock Text="Page 1"
                                           FontSize="10"
                                           Foreground="#666666" />
                            </StackPanel>
                        </Border>

                        <!-- Elements canvas -->
                        <Canvas x:Name="ElementsCanvas"
                                Background="Transparent"
                                ClipToBounds="True">
                            <!-- Element controls are added here programmatically -->
                        </Canvas>

                        <!-- Selection rectangle (for multi-select) - on top of elements -->
                        <Canvas IsHitTestVisible="False" ClipToBounds="True">
                            <Rectangle x:Name="SelectionRectangle"
                                       Classes="selection-rect"
                                       IsVisible="False"/>
                        </Canvas>

                        <!-- Drop indicator for drag-drop -->
                        <Border x:Name="DropIndicator"
                                BorderBrush="#4CAF50"
                                BorderThickness="2"
                                Background="#204CAF50"
                                IsVisible="False"
                                IsHitTestVisible="False"/>
                    </Grid>
                </Border>
            </Border>
        </LayoutTransformControl>
    </ScrollViewer>
</UserControl>
