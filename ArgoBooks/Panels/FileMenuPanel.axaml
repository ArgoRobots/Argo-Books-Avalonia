<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:ArgoBooks.ViewModels"
             mc:Ignorable="d" d:DesignWidth="260" d:DesignHeight="400"
             x:Class="ArgoBooks.Panels.FileMenuPanel"
             x:DataType="vm:FileMenuPanelViewModel">

    <Design.DataContext>
        <vm:FileMenuPanelViewModel />
    </Design.DataContext>

    <Panel IsVisible="{Binding IsOpen}">
        <!-- Transparent backdrop for click-away -->
        <Border Background="Transparent"
                PointerPressed="Backdrop_PointerPressed" />

        <!-- File Menu Panel -->
        <Border x:Name="FileMenuBorder"
                Background="{DynamicResource SurfaceBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Width="260"
                HorizontalAlignment="Left"
                VerticalAlignment="Top"
                Margin="70,60,0,0"
                BoxShadow="0 4 20 0 #26000000"
                Focusable="True"
                KeyDown="FileMenu_KeyDown">
            <StackPanel x:Name="MenuItems" Margin="0,8">
                <!-- Create New Company -->
                <Button x:Name="MenuItem0"
                        Classes="menu-item"
                        Command="{Binding NewCompanyCommand}">
                    <Grid ColumnDefinitions="Auto,*">
                        <PathIcon Grid.Column="0"
                                  Data="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"
                                  Width="18" Height="18"
                                  Margin="0,0,12,0" />
                        <TextBlock Grid.Column="1" Text="Create New Company" VerticalAlignment="Center" />
                    </Grid>
                </Button>

                <!-- Open Company -->
                <Button x:Name="MenuItem1"
                        Classes="menu-item"
                        Command="{Binding OpenCompanyCommand}">
                    <Grid ColumnDefinitions="Auto,*">
                        <PathIcon Grid.Column="0"
                                  Data="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z"
                                  Width="18" Height="18"
                                  Margin="0,0,12,0" />
                        <TextBlock Grid.Column="1" Text="Open Company..." VerticalAlignment="Center" />
                    </Grid>
                </Button>

                <!-- Open Recent -->
                <Button x:Name="MenuItem2"
                        Classes="menu-item"
                        PointerEntered="OpenRecent_PointerEntered"
                        PointerExited="OpenRecent_PointerExited">
                    <Grid ColumnDefinitions="Auto,*,Auto">
                        <PathIcon Grid.Column="0"
                                  Data="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"
                                  Width="18" Height="18"
                                  Margin="0,0,12,0" />
                        <TextBlock Grid.Column="1" Text="Open Recent" VerticalAlignment="Center" />
                        <PathIcon Grid.Column="2"
                                  Data="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"
                                  Width="12" Height="12"
                                  Foreground="{DynamicResource TextTertiaryBrush}" />
                    </Grid>
                </Button>

                <!-- Divider -->
                <Border Height="1"
                        Background="{DynamicResource BorderBrush}"
                        Margin="0,8" />

                <!-- Save -->
                <Button x:Name="MenuItem3"
                        Classes="menu-item"
                        Command="{Binding SaveCommand}">
                    <Grid ColumnDefinitions="Auto,*,Auto">
                        <PathIcon Grid.Column="0"
                                  Data="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"
                                  Width="18" Height="18"
                                  Margin="0,0,12,0" />
                        <TextBlock Grid.Column="1" Text="Save" VerticalAlignment="Center" />
                        <TextBlock Grid.Column="2"
                                   Text="Ctrl+S"
                                   FontSize="12"
                                   Foreground="{DynamicResource TextTertiaryBrush}" />
                    </Grid>
                </Button>

                <!-- Save As -->
                <Button x:Name="MenuItem4"
                        Classes="menu-item"
                        Command="{Binding SaveAsCommand}">
                    <Grid ColumnDefinitions="Auto,*,Auto">
                        <PathIcon Grid.Column="0"
                                  Data="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2v9.67z"
                                  Width="18" Height="18"
                                  Margin="0,0,12,0" />
                        <TextBlock Grid.Column="1" Text="Save As..." VerticalAlignment="Center" />
                        <TextBlock Grid.Column="2"
                                   Text="Ctrl+Shift+S"
                                   FontSize="12"
                                   Foreground="{DynamicResource TextTertiaryBrush}" />
                    </Grid>
                </Button>

                <!-- Close Company -->
                <Button x:Name="MenuItem5"
                        Classes="menu-item"
                        Command="{Binding CloseCompanyCommand}">
                    <Grid ColumnDefinitions="Auto,*">
                        <PathIcon Grid.Column="0"
                                  Data="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"
                                  Width="18" Height="18"
                                  Margin="0,0,12,0" />
                        <TextBlock Grid.Column="1" Text="Close Company" VerticalAlignment="Center" />
                    </Grid>
                </Button>

                <!-- Divider -->
                <Border Height="1"
                        Background="{DynamicResource BorderBrush}"
                        Margin="0,8" />

                <!-- Import -->
                <Button x:Name="MenuItem6"
                        Classes="menu-item"
                        Command="{Binding ImportCommand}">
                    <Grid ColumnDefinitions="Auto,*">
                        <PathIcon Grid.Column="0"
                                  Data="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"
                                  Width="18" Height="18"
                                  Margin="0,0,12,0" />
                        <TextBlock Grid.Column="1" Text="Import..." VerticalAlignment="Center" />
                    </Grid>
                </Button>

                <!-- Export As -->
                <Button x:Name="MenuItem7"
                        Classes="menu-item"
                        Command="{Binding ExportAsCommand}">
                    <Grid ColumnDefinitions="Auto,*">
                        <PathIcon Grid.Column="0"
                                  Data="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"
                                  Width="18" Height="18"
                                  Margin="0,0,12,0" />
                        <TextBlock Grid.Column="1" Text="Export As..." VerticalAlignment="Center" />
                    </Grid>
                </Button>

                <!-- Divider -->
                <Border Height="1"
                        Background="{DynamicResource BorderBrush}"
                        Margin="0,8" />

                <!-- Show in Folder -->
                <Button x:Name="MenuItem8"
                        Classes="menu-item"
                        Command="{Binding ShowInFolderCommand}">
                    <Grid ColumnDefinitions="Auto,*">
                        <PathIcon Grid.Column="0"
                                  Data="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"
                                  Width="18" Height="18"
                                  Margin="0,0,12,0" />
                        <TextBlock Grid.Column="1" Text="Show Company in Folder" VerticalAlignment="Center" />
                    </Grid>
                </Button>
            </StackPanel>
        </Border>

        <!-- Recent Companies Submenu (positioned absolutely outside main menu) -->
        <Border x:Name="RecentSubmenu"
                IsVisible="{Binding IsRecentSubmenuOpen}"
                Background="{DynamicResource SurfaceBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Width="220"
                HorizontalAlignment="Left"
                VerticalAlignment="Top"
                Margin="328,140,0,0"
                BoxShadow="0 4 20 0 #26000000"
                PointerEntered="RecentSubmenu_PointerEntered"
                PointerExited="RecentSubmenu_PointerExited">
            <StackPanel Margin="0,8">
                <!-- Recent Company Items -->
                <Button Classes="menu-item"
                        Command="{Binding OpenRecentCompanyCommand}"
                        CommandParameter="{Binding RecentCompanies[0]}">
                    <Grid ColumnDefinitions="Auto,*">
                        <PathIcon Grid.Column="0"
                                  Data="M12 7V3H2v18h20V7H12zM6 19H4v-2h2v2zm0-4H4v-2h2v2zm0-4H4V9h2v2zm0-4H4V5h2v2zm4 12H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V9h2v2zm0-4H8V5h2v2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8v10zm-2-8h-2v2h2v-2zm0 4h-2v2h2v-2z"
                                  Width="16" Height="16"
                                  Margin="0,0,12,0" />
                        <TextBlock Grid.Column="1" Text="My Company Inc." VerticalAlignment="Center" />
                    </Grid>
                </Button>
                <Button Classes="menu-item"
                        Command="{Binding OpenRecentCompanyCommand}"
                        CommandParameter="{Binding RecentCompanies[1]}">
                    <Grid ColumnDefinitions="Auto,*">
                        <PathIcon Grid.Column="0"
                                  Data="M20 4H4v2h16V4zm1 10v-2l-1-5H4l-1 5v2h1v6h10v-6h4v6h2v-6h1zm-9 4H6v-4h6v4z"
                                  Width="16" Height="16"
                                  Margin="0,0,12,0" />
                        <TextBlock Grid.Column="1" Text="Side Business LLC" VerticalAlignment="Center" />
                    </Grid>
                </Button>
                <Button Classes="menu-item"
                        Command="{Binding OpenRecentCompanyCommand}"
                        CommandParameter="{Binding RecentCompanies[2]}">
                    <Grid ColumnDefinitions="Auto,*">
                        <PathIcon Grid.Column="0"
                                  Data="M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-6 0h-4V4h4v2z"
                                  Width="16" Height="16"
                                  Margin="0,0,12,0" />
                        <TextBlock Grid.Column="1" Text="Consulting Services" VerticalAlignment="Center" />
                    </Grid>
                </Button>

                <!-- Divider -->
                <Border Height="1"
                        Background="{DynamicResource BorderBrush}"
                        Margin="0,8" />

                <!-- Clear Recent -->
                <Button Classes="menu-item"
                        Command="{Binding ClearRecentCommand}">
                    <Grid ColumnDefinitions="Auto,*">
                        <PathIcon Grid.Column="0"
                                  Data="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"
                                  Width="16" Height="16"
                                  Margin="0,0,12,0" />
                        <TextBlock Grid.Column="1" Text="Clear Recent" VerticalAlignment="Center" />
                    </Grid>
                </Button>
            </StackPanel>
        </Border>
    </Panel>

    <UserControl.Styles>
        <!-- Menu Item Style -->
        <Style Selector="Button.menu-item">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="16,10" />
            <Setter Property="HorizontalAlignment" Value="Stretch" />
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="CornerRadius" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>
        <Style Selector="Button.menu-item /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="Transparent" />
        </Style>
        <Style Selector="Button.menu-item:pointerover /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource SurfaceHoverBrush}" />
        </Style>
        <Style Selector="Button.menu-item:pressed /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource SurfacePressedBrush}" />
        </Style>
        <Style Selector="Button.menu-item:focus /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource SurfaceHoverBrush}" />
        </Style>
        <Style Selector="Button.menu-item PathIcon">
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}" />
        </Style>
    </UserControl.Styles>
</UserControl>
