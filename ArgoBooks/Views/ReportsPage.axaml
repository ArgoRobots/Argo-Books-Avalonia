<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:ArgoBooks.ViewModels"
             xmlns:enums="using:ArgoBooks.Core.Enums"
             xmlns:controls="using:ArgoBooks.Controls"
             xmlns:reports="using:ArgoBooks.Controls.Reports"
             xmlns:converters="using:ArgoBooks.Converters"
             xmlns:local="using:ArgoBooks"
             xmlns:loc="using:ArgoBooks.Localization"
             xmlns:icons="using:ArgoBooks"
             mc:Ignorable="d" d:DesignWidth="1400" d:DesignHeight="900"
             x:Class="ArgoBooks.Views.ReportsPage"
             x:DataType="vm:ReportsPageViewModel">

    <UserControl.Resources>
        <converters:EqualConverter x:Key="EqualConverter" />
        <converters:EnumDisplayNameConverter x:Key="EnumDisplayNameConverter" />
        <converters:TransactionTypeSupportsReturnsConverter x:Key="TransactionTypeSupportsReturnsConverter" />
    </UserControl.Resources>

    <Design.DataContext>
        <vm:ReportsPageViewModel />
    </Design.DataContext>

    <Panel>
    <Grid RowDefinitions="Auto,*,Auto">
        <!-- Step Indicator -->
        <Border Grid.Row="0"
                Background="{DynamicResource SurfaceBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="0,0,0,1"
                Padding="24,16">
            <Grid RowDefinitions="Auto">
                <!-- Step Progress Dots -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="0" HorizontalAlignment="Center">
                    <!-- Step 1 -->
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <!-- Active circle (current or completed) -->
                        <Border Width="32" Height="32" CornerRadius="16"
                                Background="{DynamicResource PrimaryBrush}"
                                IsVisible="{Binding IsStep1Active}">
                            <Panel>
                                <!-- Show checkmark only if completed AND not currently on step 1 -->
                                <PathIcon Data="{x:Static local:Icons.Check}"
                                          Width="16" Height="16"
                                          Foreground="White"
                                          IsVisible="{Binding IsStep1CompletedAndPast}" />
                                <!-- Show number if on step 1 or not completed -->
                                <TextBlock Text="1"
                                           Foreground="White"
                                           FontWeight="SemiBold"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"
                                           IsVisible="{Binding !IsStep1CompletedAndPast}" />
                            </Panel>
                        </Border>
                        <!-- Inactive circle -->
                        <Border Width="32" Height="32" CornerRadius="16"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="2"
                                Background="{DynamicResource SurfaceBrush}"
                                IsVisible="{Binding !IsStep1Active}">
                            <TextBlock Text="1"
                                       Foreground="{DynamicResource TextSecondaryBrush}"
                                       FontWeight="SemiBold"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center" />
                        </Border>
                        <TextBlock Text="{loc:Loc 'Template &amp; Settings'}"
                                   FontWeight="Medium"
                                   VerticalAlignment="Center"
                                   Foreground="{DynamicResource TextPrimaryBrush}" />
                    </StackPanel>

                    <!-- Connector 1-2 -->
                    <Panel Width="60" Height="2" Margin="12,0" VerticalAlignment="Center">
                        <Border Background="{DynamicResource BorderBrush}" />
                        <Border Background="{DynamicResource PrimaryBrush}" IsVisible="{Binding IsConnector1Active}" />
                    </Panel>

                    <!-- Step 2 -->
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <!-- Active circle -->
                        <Border Width="32" Height="32" CornerRadius="16"
                                Background="{DynamicResource PrimaryBrush}"
                                IsVisible="{Binding IsStep2Active}">
                            <Panel>
                                <!-- Show checkmark only if completed AND not currently on step 2 -->
                                <PathIcon Data="{x:Static local:Icons.Check}"
                                          Width="16" Height="16"
                                          Foreground="White"
                                          IsVisible="{Binding IsStep2CompletedAndPast}" />
                                <!-- Show number if on step 2 or not completed -->
                                <TextBlock Text="2"
                                           Foreground="White"
                                           FontWeight="SemiBold"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"
                                           IsVisible="{Binding !IsStep2CompletedAndPast}" />
                            </Panel>
                        </Border>
                        <!-- Inactive circle -->
                        <Border Width="32" Height="32" CornerRadius="16"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="2"
                                Background="{DynamicResource SurfaceBrush}"
                                IsVisible="{Binding !IsStep2Active}">
                            <TextBlock Text="2"
                                       Foreground="{DynamicResource TextSecondaryBrush}"
                                       FontWeight="SemiBold"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center" />
                        </Border>
                        <Panel>
                            <TextBlock Text="{loc:Loc 'Layout Designer'}"
                                       FontWeight="Medium"
                                       VerticalAlignment="Center"
                                       Foreground="{DynamicResource TextPrimaryBrush}"
                                       IsVisible="{Binding IsStep2Active}" />
                            <TextBlock Text="{loc:Loc 'Layout Designer'}"
                                       FontWeight="Medium"
                                       VerticalAlignment="Center"
                                       Foreground="{DynamicResource TextSecondaryBrush}"
                                       IsVisible="{Binding !IsStep2Active}" />
                        </Panel>
                    </StackPanel>

                    <!-- Connector 2-3 -->
                    <Panel Width="60" Height="2" Margin="12,0" VerticalAlignment="Center">
                        <Border Background="{DynamicResource BorderBrush}" />
                        <Border Background="{DynamicResource PrimaryBrush}" IsVisible="{Binding IsConnector2Active}" />
                    </Panel>

                    <!-- Step 3 -->
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <!-- Active circle -->
                        <Border Width="32" Height="32" CornerRadius="16"
                                Background="{DynamicResource PrimaryBrush}"
                                IsVisible="{Binding IsStep3Active}">
                            <Panel>
                                <!-- Step 3 is the final step, never shows checkmark until export is done -->
                                <TextBlock Text="3"
                                           Foreground="White"
                                           FontWeight="SemiBold"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center" />
                            </Panel>
                        </Border>
                        <!-- Inactive circle -->
                        <Border Width="32" Height="32" CornerRadius="16"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="2"
                                Background="{DynamicResource SurfaceBrush}"
                                IsVisible="{Binding !IsStep3Active}">
                            <TextBlock Text="3"
                                       Foreground="{DynamicResource TextSecondaryBrush}"
                                       FontWeight="SemiBold"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center" />
                        </Border>
                        <Panel>
                            <TextBlock Text="{loc:Loc 'Preview &amp; Export'}"
                                       FontWeight="Medium"
                                       VerticalAlignment="Center"
                                       Foreground="{DynamicResource TextPrimaryBrush}"
                                       IsVisible="{Binding IsStep3Active}" />
                            <TextBlock Text="{loc:Loc 'Preview &amp; Export'}"
                                       FontWeight="Medium"
                                       VerticalAlignment="Center"
                                       Foreground="{DynamicResource TextSecondaryBrush}"
                                       IsVisible="{Binding !IsStep3Active}" />
                        </Panel>
                    </StackPanel>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content Area -->
        <Panel Grid.Row="1">
            <!-- Step 1: Template & Settings -->
            <Grid IsVisible="{Binding IsStep1}"
                  ColumnDefinitions="*,400"
                  Margin="24">
                <!-- Left: Templates with Tab Navigation -->
                <Border Grid.Column="0"
                        Background="{DynamicResource SurfaceBrush}"
                        CornerRadius="12"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="1"
                        Margin="0,0,24,0">
                    <Grid RowDefinitions="Auto,*">
                            <!-- Tab Navigation -->
                            <Border Grid.Row="0"
                                    BorderBrush="{DynamicResource BorderBrush}"
                                    BorderThickness="0,0,0,1">
                                <TabControl SelectedIndex="{Binding Step1TabIndex}"
                                            Margin="0"
                                            Classes="page-tabs">
                                    <TabItem Header="{loc:Loc 'Templates'}" />
                                    <TabItem Header="{loc:Loc 'Custom'}" />
                                </TabControl>
                            </Border>

                            <!-- Tab Content (Scrollable) -->
                            <ScrollViewer Grid.Row="1"
                                          VerticalScrollBarVisibility="Auto"
                                          HorizontalScrollBarVisibility="Disabled">
                                <Panel Margin="24">
                                    <!-- Templates Tab Content -->
                                    <StackPanel Spacing="16" IsVisible="{Binding IsTemplatesTabSelected}">

                                    <!-- Visual / Analytical Section Header -->
                                    <TextBlock Text="{loc:Loc 'Visual / Analytical'}"
                                               FontSize="14"
                                               FontWeight="SemiBold"
                                               Opacity="0.7"
                                               HorizontalAlignment="Center"
                                               Margin="0,0,0,4" />

                                    <!-- Built-in Templates Grid (responsive) -->
                                    <ItemsControl ItemsSource="{Binding ReportTemplateOptions}"
                                                  HorizontalAlignment="Center">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel Orientation="Horizontal" />
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Button Margin="0,0,12,12"
                                                        Padding="20,24"
                                                        CornerRadius="8"
                                                        Width="200"
                                                        HorizontalContentAlignment="Center"
                                                        Command="{Binding $parent[ItemsControl].((vm:ReportsPageViewModel)DataContext).SelectTemplateCommand}"
                                                        CommandParameter="{Binding TemplateName}"
                                                        Classes.selected="{Binding IsSelected}">
                                                    <Button.Styles>
                                                        <Style Selector="Button">
                                                            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
                                                            <Setter Property="BorderThickness" Value="2" />
                                                            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
                                                        </Style>
                                                        <Style Selector="Button /template/ ContentPresenter#PART_ContentPresenter">
                                                            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
                                                        </Style>
                                                        <Style Selector="Button:pointerover /template/ ContentPresenter#PART_ContentPresenter">
                                                            <Setter Property="Background" Value="{DynamicResource SurfaceAltBrush}" />
                                                        </Style>
                                                        <Style Selector="Button.selected">
                                                            <Setter Property="BorderBrush" Value="{DynamicResource PrimaryBrush}" />
                                                        </Style>
                                                        <Style Selector="Button.selected /template/ ContentPresenter#PART_ContentPresenter">
                                                            <Setter Property="BorderBrush" Value="{DynamicResource PrimaryBrush}" />
                                                        </Style>
                                                        <Style Selector="Button.selected:pointerover">
                                                            <Setter Property="BorderBrush" Value="{DynamicResource PrimaryBrush}" />
                                                        </Style>
                                                        <Style Selector="Button.selected:pointerover /template/ ContentPresenter#PART_ContentPresenter">
                                                            <Setter Property="Background" Value="{DynamicResource SurfaceAltBrush}" />
                                                            <Setter Property="BorderBrush" Value="{DynamicResource PrimaryBrush}" />
                                                        </Style>
                                                    </Button.Styles>
                                                    <StackPanel Spacing="8" HorizontalAlignment="Center">
                                                        <Border Background="{Binding IconBackground}"
                                                                CornerRadius="12"
                                                                Padding="12"
                                                                HorizontalAlignment="Center">
                                                            <PathIcon Data="{Binding IconData}"
                                                                      Width="28" Height="28"
                                                                      Foreground="{Binding IconForeground}" />
                                                        </Border>
                                                        <TextBlock Text="{Binding DisplayName, Converter={StaticResource TranslateConverter}}"
                                                                   FontSize="14"
                                                                   FontWeight="SemiBold"
                                                                   HorizontalAlignment="Center"
                                                                   Foreground="{DynamicResource TextPrimaryBrush}" />
                                                        <TextBlock Text="{Binding Description, Converter={StaticResource TranslateConverter}}"
                                                                   FontSize="12"
                                                                   HorizontalAlignment="Center"
                                                                   Foreground="{DynamicResource TextTertiaryBrush}"
                                                                   TextWrapping="Wrap"
                                                                   TextAlignment="Center"
                                                                   MinHeight="32" />
                                                    </StackPanel>
                                                </Button>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>

                                    <!-- Accounting Section Header -->
                                    <TextBlock Text="{loc:Loc 'Accounting'}"
                                               FontSize="14"
                                               FontWeight="SemiBold"
                                               Opacity="0.7"
                                               HorizontalAlignment="Center"
                                               Margin="0,8,0,4" />

                                    <!-- Accounting Templates Grid -->
                                    <ItemsControl ItemsSource="{Binding AccountingTemplateOptions}"
                                                  HorizontalAlignment="Center">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel Orientation="Horizontal" />
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Button Margin="0,0,12,12"
                                                        Padding="20,24"
                                                        CornerRadius="8"
                                                        Width="200"
                                                        HorizontalContentAlignment="Center"
                                                        Command="{Binding $parent[ItemsControl].((vm:ReportsPageViewModel)DataContext).SelectTemplateCommand}"
                                                        CommandParameter="{Binding TemplateName}"
                                                        Classes.selected="{Binding IsSelected}">
                                                    <Button.Styles>
                                                        <Style Selector="Button">
                                                            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
                                                            <Setter Property="BorderThickness" Value="2" />
                                                            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
                                                        </Style>
                                                        <Style Selector="Button /template/ ContentPresenter#PART_ContentPresenter">
                                                            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
                                                        </Style>
                                                        <Style Selector="Button:pointerover /template/ ContentPresenter#PART_ContentPresenter">
                                                            <Setter Property="Background" Value="{DynamicResource SurfaceAltBrush}" />
                                                        </Style>
                                                        <Style Selector="Button.selected">
                                                            <Setter Property="BorderBrush" Value="{DynamicResource PrimaryBrush}" />
                                                        </Style>
                                                        <Style Selector="Button.selected /template/ ContentPresenter#PART_ContentPresenter">
                                                            <Setter Property="BorderBrush" Value="{DynamicResource PrimaryBrush}" />
                                                        </Style>
                                                        <Style Selector="Button.selected:pointerover">
                                                            <Setter Property="BorderBrush" Value="{DynamicResource PrimaryBrush}" />
                                                        </Style>
                                                        <Style Selector="Button.selected:pointerover /template/ ContentPresenter#PART_ContentPresenter">
                                                            <Setter Property="Background" Value="{DynamicResource SurfaceAltBrush}" />
                                                            <Setter Property="BorderBrush" Value="{DynamicResource PrimaryBrush}" />
                                                        </Style>
                                                    </Button.Styles>
                                                    <StackPanel Spacing="8" HorizontalAlignment="Center">
                                                        <Border Background="{Binding IconBackground}"
                                                                CornerRadius="12"
                                                                Padding="12"
                                                                HorizontalAlignment="Center">
                                                            <PathIcon Data="{Binding IconData}"
                                                                      Width="28" Height="28"
                                                                      Foreground="{Binding IconForeground}" />
                                                        </Border>
                                                        <TextBlock Text="{Binding DisplayName, Converter={StaticResource TranslateConverter}}"
                                                                   FontSize="14"
                                                                   FontWeight="SemiBold"
                                                                   HorizontalAlignment="Center"
                                                                   Foreground="{DynamicResource TextPrimaryBrush}" />
                                                        <TextBlock Text="{Binding Description, Converter={StaticResource TranslateConverter}}"
                                                                   FontSize="12"
                                                                   HorizontalAlignment="Center"
                                                                   Foreground="{DynamicResource TextTertiaryBrush}"
                                                                   TextWrapping="Wrap"
                                                                   TextAlignment="Center"
                                                                   MinHeight="32" />
                                                    </StackPanel>
                                                </Button>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>

                                    <!-- Custom Templates Section -->
                                    <StackPanel Spacing="12" IsVisible="{Binding CustomTemplateNames.Count}">
                                        <TextBlock Text="{loc:Loc 'Custom Templates'}"
                                                   FontSize="14"
                                                   FontWeight="Medium"
                                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                                   HorizontalAlignment="Center"
                                                   Margin="0,8,0,0" />
                                        <ItemsControl ItemsSource="{Binding CustomTemplateNames}"
                                                      HorizontalAlignment="Center">
                                            <ItemsControl.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <WrapPanel Orientation="Horizontal" />
                                                </ItemsPanelTemplate>
                                            </ItemsControl.ItemsPanel>
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate x:DataType="vm:CustomTemplateOption">
                                                    <Button Margin="0,0,12,12"
                                                            Padding="16"
                                                            CornerRadius="8"
                                                            Width="200"
                                                            HorizontalContentAlignment="Stretch"
                                                            Command="{Binding $parent[ItemsControl].((vm:ReportsPageViewModel)DataContext).SelectTemplateCommand}"
                                                            CommandParameter="{Binding Name}"
                                                            Classes.selected="{Binding IsSelected}">
                                                        <Button.Styles>
                                                            <Style Selector="Button">
                                                                <Setter Property="Background" Value="{DynamicResource SurfaceAltBrush}" />
                                                                <Setter Property="BorderThickness" Value="2" />
                                                                <Setter Property="BorderBrush" Value="Transparent" />
                                                            </Style>
                                                            <Style Selector="Button /template/ ContentPresenter#PART_ContentPresenter">
                                                                <Setter Property="Background" Value="{DynamicResource SurfaceAltBrush}" />
                                                                <Setter Property="Transitions">
                                                                    <Transitions>
                                                                        <BrushTransition Property="Background" Duration="0:0:0.15" />
                                                                    </Transitions>
                                                                </Setter>
                                                            </Style>
                                                            <Style Selector="Button:pointerover /template/ ContentPresenter#PART_ContentPresenter">
                                                                <Setter Property="Background" Value="{DynamicResource SurfaceHoverBrush}" />
                                                            </Style>
                                                            <Style Selector="Button.selected">
                                                                <Setter Property="BorderBrush" Value="{DynamicResource PrimaryBrush}" />
                                                            </Style>
                                                            <Style Selector="Button.selected /template/ ContentPresenter#PART_ContentPresenter">
                                                                <Setter Property="BorderBrush" Value="{DynamicResource PrimaryBrush}" />
                                                            </Style>
                                                            <Style Selector="Button.selected:pointerover">
                                                                <Setter Property="BorderBrush" Value="{DynamicResource PrimaryBrush}" />
                                                            </Style>
                                                            <Style Selector="Button.selected:pointerover /template/ ContentPresenter#PART_ContentPresenter">
                                                                <Setter Property="Background" Value="{DynamicResource SurfaceHoverBrush}" />
                                                                <Setter Property="BorderBrush" Value="{DynamicResource PrimaryBrush}" />
                                                            </Style>
                                                        </Button.Styles>
                                                        <Grid ColumnDefinitions="*,Auto,Auto">
                                                            <TextBlock Grid.Column="0"
                                                                       Text="{Binding Name}"
                                                                       FontWeight="Medium"
                                                                       VerticalAlignment="Center"
                                                                       Foreground="{DynamicResource TextPrimaryBrush}" />
                                                            <Button Grid.Column="1"
                                                                    Classes="icon-button"
                                                                    ToolTip.Tip="{loc:Loc 'Rename template'}"
                                                                    Command="{Binding $parent[ItemsControl].((vm:ReportsPageViewModel)DataContext).OpenRenameTemplateCommand}"
                                                                    CommandParameter="{Binding Name}">
                                                                <PathIcon Data="{x:Static icons:Icons.Edit}"
                                                                          Width="14" Height="14" />
                                                            </Button>
                                                            <Button Grid.Column="2"
                                                                    Classes="icon-button danger"
                                                                    ToolTip.Tip="{loc:Loc 'Delete template'}"
                                                                    Command="{Binding $parent[ItemsControl].((vm:ReportsPageViewModel)DataContext).OpenDeleteTemplateCommand}"
                                                                    CommandParameter="{Binding Name}">
                                                                <PathIcon Data="{x:Static icons:Icons.Delete}"
                                                                          Width="14" Height="14" />
                                                            </Button>
                                                        </Grid>
                                                    </Button>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </StackPanel>

                                <!-- Custom Charts Tab Content -->
                                <StackPanel Spacing="16" IsVisible="{Binding IsChartsTabSelected}">
                                    <TextBlock Text="{loc:Loc 'Select charts to include in your report'}"
                                               FontSize="13"
                                               Foreground="{DynamicResource TextSecondaryBrush}" />

                                    <!-- Grouped Chart Categories -->
                                    <ItemsControl ItemsSource="{Binding ChartCategories}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <StackPanel Spacing="20" />
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate x:DataType="vm:ChartCategoryGroup">
                                                <StackPanel Spacing="12">
                                                    <!-- Category Header with Select All -->
                                                    <Grid ColumnDefinitions="*,Auto">
                                                        <TextBlock Grid.Column="0"
                                                                   Text="{Binding Name}"
                                                                   FontSize="15"
                                                                   FontWeight="SemiBold"
                                                                   VerticalAlignment="Center"
                                                                   Foreground="{DynamicResource TextPrimaryBrush}" />
                                                        <CheckBox Grid.Column="1"
                                                                  Content="{loc:Loc 'Select All'}"
                                                                  FontSize="12"
                                                                  IsChecked="{Binding IsAllSelected, Mode=OneWay}"
                                                                  Command="{Binding $parent[ItemsControl].((vm:ReportsPageViewModel)DataContext).ToggleSelectAllInCategoryCommand}"
                                                                  CommandParameter="{Binding}"
                                                                  VerticalAlignment="Center"
                                                                  Foreground="{DynamicResource TextSecondaryBrush}">
                                                            <CheckBox.Styles>
                                                                <Style Selector="CheckBox">
                                                                    <Setter Property="Opacity" Value="0.8" />
                                                                </Style>
                                                                <Style Selector="CheckBox:pointerover">
                                                                    <Setter Property="Opacity" Value="1" />
                                                                </Style>
                                                            </CheckBox.Styles>
                                                        </CheckBox>
                                                    </Grid>

                                                    <!-- Charts in this category -->
                                                    <ItemsControl ItemsSource="{Binding Charts}">
                                                        <ItemsControl.ItemsPanel>
                                                            <ItemsPanelTemplate>
                                                                <WrapPanel Orientation="Horizontal" />
                                                            </ItemsPanelTemplate>
                                                        </ItemsControl.ItemsPanel>
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate x:DataType="vm:ChartOption">
                                                                <Button Margin="0,0,12,12"
                                                                        Padding="14"
                                                                        CornerRadius="8"
                                                                        Width="280"
                                                                        HorizontalContentAlignment="Stretch"
                                                                        Command="{Binding $parent[ItemsControl;1].((vm:ReportsPageViewModel)DataContext).ToggleChartCommand}"
                                                                        CommandParameter="{Binding}"
                                                                        Classes.selected="{Binding IsSelected}">
                                                                    <Button.Styles>
                                                                        <Style Selector="Button">
                                                                            <Setter Property="Background" Value="{DynamicResource SurfaceAltBrush}" />
                                                                            <Setter Property="BorderThickness" Value="2" />
                                                                            <Setter Property="BorderBrush" Value="Transparent" />
                                                                        </Style>
                                                                        <Style Selector="Button /template/ ContentPresenter#PART_ContentPresenter">
                                                                            <Setter Property="Background" Value="{DynamicResource SurfaceAltBrush}" />
                                                                            <Setter Property="CornerRadius" Value="8" />
                                                                            <Setter Property="Transitions">
                                                                                <Transitions>
                                                                                    <BrushTransition Property="Background" Duration="0:0:0.15" />
                                                                                    <BrushTransition Property="BorderBrush" Duration="0:0:0.15" />
                                                                                </Transitions>
                                                                            </Setter>
                                                                        </Style>
                                                                        <Style Selector="Button:pointerover /template/ ContentPresenter#PART_ContentPresenter">
                                                                            <Setter Property="Background" Value="{DynamicResource SurfaceHoverBrush}" />
                                                                        </Style>
                                                                        <Style Selector="Button.selected">
                                                                            <Setter Property="BorderBrush" Value="{DynamicResource PrimaryBrush}" />
                                                                        </Style>
                                                                        <Style Selector="Button.selected /template/ ContentPresenter#PART_ContentPresenter">
                                                                            <Setter Property="BorderBrush" Value="{DynamicResource PrimaryBrush}" />
                                                                        </Style>
                                                                    </Button.Styles>
                                                                    <StackPanel Spacing="4">
                                                                        <StackPanel Orientation="Horizontal" Spacing="12">
                                                                            <Border CornerRadius="8"
                                                                                    Padding="8"
                                                                                    Background="{Binding IconBackground}">
                                                                                <PathIcon Data="{Binding IconData}"
                                                                                          Width="18" Height="18"
                                                                                          Foreground="{Binding IconForeground}" />
                                                                            </Border>
                                                                            <TextBlock Text="{Binding Name}"
                                                                                       FontSize="14"
                                                                                       FontWeight="SemiBold"
                                                                                       VerticalAlignment="Center"
                                                                                       TextTrimming="CharacterEllipsis"
                                                                                       Foreground="{DynamicResource TextPrimaryBrush}" />
                                                                        </StackPanel>
                                                                        <TextBlock Text="{Binding Description}"
                                                                                   FontSize="12"
                                                                                   Foreground="{DynamicResource TextTertiaryBrush}"
                                                                                   TextWrapping="Wrap"
                                                                                   Margin="0,4,0,0" />
                                                                    </StackPanel>
                                                                </Button>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>
                                                </StackPanel>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                                </Panel>
                            </ScrollViewer>
                        </Grid>
                    </Border>

                    <!-- Right: Settings -->
                    <Border Grid.Column="1"
                            Background="{DynamicResource SurfaceBrush}"
                            CornerRadius="12"
                            BorderBrush="{DynamicResource BorderBrush}"
                            BorderThickness="1">
                        <ScrollViewer VerticalScrollBarVisibility="Auto"
                                      HorizontalScrollBarVisibility="Disabled">
                            <StackPanel Spacing="20" Margin="24">
                                <TextBlock Text="{loc:Loc 'Report Settings'}"
                                       FontSize="18"
                                       FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextPrimaryBrush}" />

                            <!-- Report Name -->
                            <StackPanel Spacing="8">
                                <TextBlock Text="{loc:Loc 'Report Name'}"
                                           FontSize="14"
                                           FontWeight="Medium"
                                           Foreground="{DynamicResource TextSecondaryBrush}" />
                                <TextBox Text="{Binding ReportName}"
                                         Watermark="{loc:Loc 'Enter report name...'}"
                                         Padding="12,10" />
                            </StackPanel>

                            <!-- Date Range -->
                            <StackPanel Spacing="8">
                                <TextBlock Text="{loc:Loc 'Date Range'}"
                                           FontSize="14"
                                           FontWeight="Medium"
                                           Foreground="{DynamicResource TextSecondaryBrush}" />
                                <ItemsControl ItemsSource="{Binding DatePresets}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <UniformGrid Columns="2" />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate DataType="vm:DatePresetOption">
                                            <RadioButton Content="{Binding Name, Converter={StaticResource TranslateConverter}}"
                                                         GroupName="DateRange"
                                                         IsChecked="{Binding IsSelected}"
                                                         Command="{Binding $parent[ItemsControl].((vm:ReportsPageViewModel)DataContext).SelectDatePresetCommand}"
                                                         CommandParameter="{Binding}"
                                                         Margin="0,3"
                                                         FontSize="13" />
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <!-- Custom Date Range -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        Padding="16"
                                        Margin="0,8,0,0"
                                        IsVisible="{Binding IsCustomDateRange}">
                                    <StackPanel Spacing="12">
                                        <TextBlock Text="{loc:Loc 'Custom Date Range'}"
                                                   FontSize="13"
                                                   FontWeight="Medium"
                                                   Foreground="{DynamicResource TextSecondaryBrush}" />
                                        <StackPanel Spacing="8">
                                            <StackPanel Spacing="4">
                                                <TextBlock Text="{loc:Loc 'Start Date'}"
                                                           FontSize="11"
                                                           Foreground="{DynamicResource TextTertiaryBrush}" />
                                                <DatePicker SelectedDate="{Binding CustomStartDate}"
                                                            HorizontalAlignment="Stretch" />
                                            </StackPanel>
                                            <StackPanel Spacing="4">
                                                <TextBlock Text="{loc:Loc 'End Date'}"
                                                           FontSize="11"
                                                           Foreground="{DynamicResource TextTertiaryBrush}" />
                                                <DatePicker SelectedDate="{Binding CustomEndDate}"
                                                            HorizontalAlignment="Stretch" />
                                            </StackPanel>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            </StackPanel>
                        </ScrollViewer>
                    </Border>
                </Grid>

            <!-- Step 2: Layout Designer -->
            <Grid IsVisible="{Binding IsStep2}"
                  ColumnDefinitions="Auto,*,260">

                <!-- Left Panel: Element Toolbox (Collapsible) -->
                <Border x:Name="ElementToolbox"
                        Grid.Column="0"
                        Background="{DynamicResource SurfaceBrush}"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="0,0,1,0"
                        ClipToBounds="True">
                    <Grid RowDefinitions="Auto,*">
                        <!-- Header with Toggle -->
                        <Grid Grid.Row="0" Margin="8,8,8,0">
                            <TextBlock Text="{loc:Loc 'Elements'}"
                                       FontSize="14"
                                       FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextPrimaryBrush}"
                                       IsVisible="{Binding IsElementPanelExpanded}"
                                       VerticalAlignment="Center" />
                            <Button Classes="icon-button"
                                    HorizontalAlignment="Right"
                                    Width="24" Height="24"
                                    Click="OnToggleElementPanelClick"
                                    ToolTip.Tip="{loc:Loc 'Toggle Panel'}">
                                <controls:ToggleArrow IconSize="12"
                                                      Foreground="{DynamicResource TextPrimaryBrush}"
                                                      IsCollapsed="{Binding !IsElementPanelExpanded}" />
                            </Button>
                        </Grid>

                        <!-- Expanded Content (Full buttons) -->
                        <StackPanel x:Name="ElementPanelContent"
                                    Grid.Row="1"
                                    Spacing="8"
                                    Margin="8,8,8,12"
                                    IsVisible="{Binding IsElementPanelExpanded}">
                            <Button Classes="toolbox-button" Command="{Binding AddElementCommand}" CommandParameter="{x:Static enums:ReportElementType.Chart}" ToolTip.Tip="{loc:Loc 'Add Chart'}">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <PathIcon Data="{x:Static icons:Icons.Analytics}"
                                              Width="18" Height="18"
                                              Foreground="{DynamicResource PrimaryBrush}" />
                                    <TextBlock Text="{loc:Loc 'Chart'}" VerticalAlignment="Center" />
                                </StackPanel>
                            </Button>
                            <Button Classes="toolbox-button" Command="{Binding AddElementCommand}" CommandParameter="{x:Static enums:ReportElementType.Label}" ToolTip.Tip="{loc:Loc 'Add Label'}">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <PathIcon Data="{x:Static icons:Icons.FormatBold}"
                                              Width="18" Height="18"
                                              Foreground="{DynamicResource PrimaryBrush}" />
                                    <TextBlock Text="{loc:Loc 'Label'}" VerticalAlignment="Center" />
                                </StackPanel>
                            </Button>
                            <Button Classes="toolbox-button" Command="{Binding AddElementCommand}" CommandParameter="{x:Static enums:ReportElementType.DateRange}" ToolTip.Tip="{loc:Loc 'Add Date Range'}">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <PathIcon Data="{x:Static icons:Icons.Calendar}"
                                              Width="18" Height="18"
                                              Foreground="{DynamicResource PrimaryBrush}" />
                                    <TextBlock Text="{loc:Loc 'Date Range'}" VerticalAlignment="Center" />
                                </StackPanel>
                            </Button>
                            <Button Classes="toolbox-button" Command="{Binding AddElementCommand}" CommandParameter="{x:Static enums:ReportElementType.Summary}" ToolTip.Tip="{loc:Loc 'Add Summary'}">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <PathIcon Data="{x:Static icons:Icons.BarChart}"
                                              Width="18" Height="18"
                                              Foreground="{DynamicResource PrimaryBrush}" />
                                    <TextBlock Text="{loc:Loc 'Summary'}" VerticalAlignment="Center" />
                                </StackPanel>
                            </Button>
                            <Button Classes="toolbox-button" Command="{Binding AddElementCommand}" CommandParameter="{x:Static enums:ReportElementType.Image}" ToolTip.Tip="{loc:Loc 'Add Image'}">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <PathIcon Data="{x:Static icons:Icons.Image}"
                                              Width="18" Height="18"
                                              Foreground="{DynamicResource PrimaryBrush}" />
                                    <TextBlock Text="{loc:Loc 'Image'}" VerticalAlignment="Center" />
                                </StackPanel>
                            </Button>
                            <Button Classes="toolbox-button" Command="{Binding AddElementCommand}" CommandParameter="{x:Static enums:ReportElementType.Table}" ToolTip.Tip="{loc:Loc 'Add Table'}">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <PathIcon Data="{x:Static icons:Icons.Grid2x2}"
                                              Width="18" Height="18"
                                              Foreground="{DynamicResource PrimaryBrush}" />
                                    <TextBlock Text="{loc:Loc 'Table'}" VerticalAlignment="Center" />
                                </StackPanel>
                            </Button>
                            <Button Classes="toolbox-button" Command="{Binding AddElementCommand}" CommandParameter="{x:Static enums:ReportElementType.AccountingTable}" ToolTip.Tip="{loc:Loc 'Add Accounting Table'}">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <PathIcon Data="{x:Static icons:Icons.Receipts}"
                                              Width="18" Height="18"
                                              Foreground="{DynamicResource PrimaryBrush}" />
                                    <TextBlock Text="{loc:Loc 'Accounting'}" VerticalAlignment="Center" />
                                </StackPanel>
                            </Button>
                        </StackPanel>

                        <!-- Collapsed Content (Icon-only buttons) -->
                        <!-- Margin left = 14px to align with expanded buttons: 8 (expanded margin) + 1 (border) + 12 (padding) - 7 (icon center offset in 32px button) = 14 -->
                        <StackPanel Grid.Row="1"
                                    Spacing="4"
                                    Margin="0,10,0,0"
                                    HorizontalAlignment="Left"
                                    IsVisible="{Binding !IsElementPanelExpanded}">
                            <Button Classes="icon-button" Margin="4,6,0,6" Width="32" Height="32" Command="{Binding AddElementCommand}" CommandParameter="{x:Static enums:ReportElementType.Chart}" ToolTip.Tip="{loc:Loc 'Add Chart'}">
                                <PathIcon Data="{x:Static icons:Icons.Analytics}"
                                          Width="18" Height="18"
                                          Foreground="{DynamicResource PrimaryBrush}" />
                            </Button>
                            <Button Classes="icon-button" Margin="4,6,0,6" Width="32" Height="32" Command="{Binding AddElementCommand}" CommandParameter="{x:Static enums:ReportElementType.Label}" ToolTip.Tip="{loc:Loc 'Add Label'}">
                                <PathIcon Data="{x:Static icons:Icons.FormatBold}"
                                          Width="18" Height="18"
                                          Foreground="{DynamicResource PrimaryBrush}" />
                            </Button>
                            <Button Classes="icon-button" Margin="4,6,0,6" Width="32" Height="32" Command="{Binding AddElementCommand}" CommandParameter="{x:Static enums:ReportElementType.DateRange}" ToolTip.Tip="{loc:Loc 'Add Date Range'}">
                                <PathIcon Data="{x:Static icons:Icons.Calendar}"
                                          Width="18" Height="18"
                                          Foreground="{DynamicResource PrimaryBrush}" />
                            </Button>
                            <Button Classes="icon-button" Margin="4,6,0,6" Width="32" Height="32" Command="{Binding AddElementCommand}" CommandParameter="{x:Static enums:ReportElementType.Summary}" ToolTip.Tip="{loc:Loc 'Add Summary'}">
                                <PathIcon Data="{x:Static icons:Icons.BarChart}"
                                          Width="18" Height="18"
                                          Foreground="{DynamicResource PrimaryBrush}" />
                            </Button>
                            <Button Classes="icon-button" Margin="4,6,0,6" Width="32" Height="32" Command="{Binding AddElementCommand}" CommandParameter="{x:Static enums:ReportElementType.Image}" ToolTip.Tip="{loc:Loc 'Add Image'}">
                                <PathIcon Data="{x:Static icons:Icons.Image}"
                                          Width="18" Height="18"
                                          Foreground="{DynamicResource PrimaryBrush}" />
                            </Button>
                            <Button Classes="icon-button" Margin="4,6,0,6" Width="32" Height="32" Command="{Binding AddElementCommand}" CommandParameter="{x:Static enums:ReportElementType.Table}" ToolTip.Tip="{loc:Loc 'Add Table'}">
                                <PathIcon Data="{x:Static icons:Icons.Grid2x2}"
                                          Width="18" Height="18"
                                          Foreground="{DynamicResource PrimaryBrush}" />
                            </Button>
                            <Button Classes="icon-button" Margin="4,6,0,6" Width="32" Height="32" Command="{Binding AddElementCommand}" CommandParameter="{x:Static enums:ReportElementType.AccountingTable}" ToolTip.Tip="{loc:Loc 'Add Accounting Table'}">
                                <PathIcon Data="{x:Static icons:Icons.Receipts}"
                                          Width="18" Height="18"
                                          Foreground="{DynamicResource PrimaryBrush}" />
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Center: Design Canvas -->
                <Grid Grid.Column="1" RowDefinitions="Auto,*">
                    <!-- Toolbar -->
                    <Border x:Name="ToolbarBorder"
                            Grid.Row="0"
                            Background="{DynamicResource SurfaceBrush}"
                            BorderBrush="{DynamicResource BorderBrush}"
                            BorderThickness="0,0,0,1"
                            Padding="8">
                            <ScrollViewer x:Name="ToolbarScrollViewer"
                                          HorizontalScrollBarVisibility="Auto"
                                          VerticalScrollBarVisibility="Disabled">
                        <StackPanel x:Name="ToolbarContent" Orientation="Horizontal" Spacing="4">
                                <!-- Undo/Redo Button Group (same as header) -->
                                <controls:UndoRedoButtonGroup x:Name="ReportsUndoRedoGroup"
                                                              DataContext="{Binding UndoRedoViewModel}" />

                                <!-- Save Template Button with Asterisk Container (right after undo/redo) -->
                                <!-- Uses Grid for overlay positioning so asterisk doesn't shift other buttons -->
                                <Grid x:Name="SaveButtonContainer" VerticalAlignment="Center">
                                    <Button Classes="toolbar-button" Command="{Binding OpenSaveTemplateCommand}" ToolTip.Tip="{loc:Loc 'Save as Template'}">
                                        <PathIcon Data="{x:Static icons:Icons.Save}"
                                                  Width="16" Height="16" />
                                    </Button>
                                    <!-- Asterisk overlay - added dynamically via code-behind when needed -->
                                </Grid>

                                <Border Width="1" Height="24" Background="{DynamicResource BorderBrush}" Margin="4,0" />

                                <!-- Horizontal Alignment -->
                                <Button Classes="toolbar-button" Command="{Binding AlignElementsCommand}" CommandParameter="{x:Static enums:ElementAlignment.Left}" ToolTip.Tip="{loc:Loc 'Align Left'}" IsEnabled="{Binding HasSelectedElements}">
                                    <PathIcon Data="{x:Static icons:Icons.IndentRight}"
                                              Width="16" Height="16" />
                                </Button>
                                <Button Classes="toolbar-button" Command="{Binding AlignElementsCommand}" CommandParameter="{x:Static enums:ElementAlignment.CenterH}" ToolTip.Tip="{loc:Loc 'Align Center Horizontally'}" IsEnabled="{Binding HasSelectedElements}">
                                    <PathIcon Data="{x:Static icons:Icons.DistributeH}"
                                              Width="16" Height="16" />
                                </Button>
                                <Button Classes="toolbar-button" Command="{Binding AlignElementsCommand}" CommandParameter="{x:Static enums:ElementAlignment.Right}" ToolTip.Tip="{loc:Loc 'Align Right'}" IsEnabled="{Binding HasSelectedElements}">
                                    <PathIcon Data="{x:Static icons:Icons.IndentLeft}"
                                              Width="16" Height="16" />
                                </Button>

                                <Border Width="1" Height="24" Background="{DynamicResource BorderBrush}" Margin="4,0" />

                                <!-- Vertical Alignment -->
                                <Button Classes="toolbar-button" Command="{Binding AlignElementsCommand}" CommandParameter="{x:Static enums:ElementAlignment.Top}" ToolTip.Tip="{loc:Loc 'Align Top'}" IsEnabled="{Binding HasSelectedElements}">
                                    <PathIcon Data="{x:Static icons:Icons.AlignTop}"
                                              Width="16" Height="16" />
                                </Button>
                                <Button Classes="toolbar-button" Command="{Binding AlignElementsCommand}" CommandParameter="{x:Static enums:ElementAlignment.CenterV}" ToolTip.Tip="{loc:Loc 'Align Center Vertically'}" IsEnabled="{Binding HasSelectedElements}">
                                    <PathIcon Data="{x:Static icons:Icons.DistributeV}"
                                              Width="16" Height="16" />
                                </Button>
                                <Button Classes="toolbar-button" Command="{Binding AlignElementsCommand}" CommandParameter="{x:Static enums:ElementAlignment.Bottom}" ToolTip.Tip="{loc:Loc 'Align Bottom'}" IsEnabled="{Binding HasSelectedElements}">
                                    <PathIcon Data="{x:Static icons:Icons.DownloadFile}"
                                              Width="16" Height="16" />
                                </Button>

                                <Border Width="1" Height="24" Background="{DynamicResource BorderBrush}" Margin="4,0" />

                                <!-- Distribution -->
                                <Button Classes="toolbar-button" Command="{Binding DistributeElementsCommand}" CommandParameter="{x:Static enums:DistributeDirection.Horizontal}" ToolTip.Tip="{loc:Loc 'Distribute Horizontally'}" IsEnabled="{Binding HasMultipleSelectedElements}">
                                    <PathIcon Data="{x:Static icons:Icons.VerticalRules}"
                                              Width="16" Height="16" />
                                </Button>
                                <Button Classes="toolbar-button" Command="{Binding DistributeElementsCommand}" CommandParameter="{x:Static enums:DistributeDirection.Vertical}" ToolTip.Tip="{loc:Loc 'Distribute Vertically'}" IsEnabled="{Binding HasMultipleSelectedElements}">
                                    <PathIcon Data="{x:Static icons:Icons.HorizontalRules}"
                                              Width="16" Height="16" />
                                </Button>

                                <Border Width="1" Height="24" Background="{DynamicResource BorderBrush}" Margin="4,0" />

                                <!-- Same Size -->
                                <Button Classes="toolbar-button" Command="{Binding MatchSizeCommand}" CommandParameter="{x:Static enums:MatchSizeMode.Width}" ToolTip.Tip="{loc:Loc 'Same Width'}" IsEnabled="{Binding HasMultipleSelectedElements}">
                                    <PathIcon Data="{x:Static icons:Icons.AlignHCenter}"
                                              Width="16" Height="16" />
                                </Button>
                                <Button Classes="toolbar-button" Command="{Binding MatchSizeCommand}" CommandParameter="{x:Static enums:MatchSizeMode.Height}" ToolTip.Tip="{loc:Loc 'Same Height'}" IsEnabled="{Binding HasMultipleSelectedElements}">
                                    <PathIcon Data="{x:Static icons:Icons.AlignVCenter}"
                                              Width="16" Height="16" />
                                </Button>
                                <Button Classes="toolbar-button" Command="{Binding MatchSizeCommand}" CommandParameter="{x:Static enums:MatchSizeMode.Both}" ToolTip.Tip="{loc:Loc 'Same Size'}" IsEnabled="{Binding HasMultipleSelectedElements}">
                                    <PathIcon Data="{x:Static icons:Icons.FullscreenAlt}"
                                              Width="16" Height="16" />
                                </Button>

                                <Border Width="1" Height="24" Background="{DynamicResource BorderBrush}" Margin="4,0" />

                                <!-- Z-Order -->
                                <Button Classes="toolbar-button" Command="{Binding BringToFrontCommand}" ToolTip.Tip="{loc:Loc 'Bring to Front'}" IsEnabled="{Binding HasSelectedElements}">
                                    <PathIcon Data="{x:Static icons:Icons.SelectionAll}"
                                              Width="16" Height="16" />
                                </Button>
                                <Button Classes="toolbar-button" Command="{Binding SendToBackCommand}" ToolTip.Tip="{loc:Loc 'Send to Back'}" IsEnabled="{Binding HasSelectedElements}">
                                    <PathIcon Data="{x:Static icons:Icons.SelectionDash}"
                                              Width="16" Height="16" />
                                </Button>

                                <Border Width="1" Height="24" Background="{DynamicResource BorderBrush}" Margin="4,0" />

                                <!-- Delete -->
                                <Button Classes="toolbar-button danger" Command="{Binding DeleteSelectedElementsCommand}" ToolTip.Tip="{loc:Loc 'Delete (Del)'}" IsEnabled="{Binding HasSelectedElements}">
                                    <PathIcon Data="{x:Static icons:Icons.Delete}"
                                              Width="16" Height="16" />
                                </Button>

                                <Border Width="1" Height="24" Background="{DynamicResource BorderBrush}" Margin="4,0" />

                                <!-- Grid Toggle -->
                                <ToggleButton Classes="toolbar-toggle" IsChecked="{Binding ShowGrid}" ToolTip.Tip="{loc:Loc 'Toggle Grid (Ctrl+G)'}">
                                    <PathIcon Data="{x:Static icons:Icons.GridSmall}"
                                              Width="16" Height="16" />
                                </ToggleButton>

                                <Border Width="1" Height="24" Background="{DynamicResource BorderBrush}" Margin="4,0" />

                                <!-- Page Settings Button -->
                                <Button Classes="toolbar-button" Command="{Binding OpenPageSettingsCommand}" ToolTip.Tip="{loc:Loc 'Page Settings'}">
                                    <PathIcon Data="{x:Static icons:Icons.Settings}"
                                              Width="16" Height="16" />
                                </Button>
                                </StackPanel>
                        </ScrollViewer>
                    </Border>

                    <!-- Canvas Area with SkiaReportDesignCanvas (unified SkiaSharp rendering) -->
                    <!-- Wrapped in Grid to allow save confirmation overlay -->
                    <Grid Grid.Row="1">
                        <!-- Starts with Opacity=0 to prevent flash before fit-to-window is applied -->
                        <reports:SkiaReportDesignCanvas x:Name="DesignCanvas"
                                                        Opacity="0"
                                                        Configuration="{Binding Configuration}"
                                                        ZoomLevel="{Binding ZoomLevel, Mode=TwoWay}"
                                                        ShowGrid="{Binding ShowGrid}"
                                                        GridSize="{Binding GridSize}"
                                                        SnapToGrid="{Binding SnapToGrid}"
                                                        CurrentDesignerPage="{Binding CurrentDesignerPage, Mode=TwoWay}"
                                                        UndoRedoManager="{Binding UndoRedoManager}" />

                        <!-- Save Confirmation Overlay -->
                        <Border x:Name="SaveConfirmationBorder"
                                IsVisible="{Binding ShowSaveConfirmation}"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Top"
                                Margin="0,16,0,0"
                                Padding="12,8"
                                CornerRadius="4"
                                Background="{DynamicResource SuccessBrush}"
                                IsHitTestVisible="False"
                                Opacity="0">
                            <Border.Transitions>
                                <Transitions>
                                    <DoubleTransition Property="Opacity" Duration="0:0:0.3" Easing="CubicEaseOut" />
                                </Transitions>
                            </Border.Transitions>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <PathIcon Data="{x:Static local:Icons.Check}"
                                          Width="16" Height="16"
                                          Foreground="White" />
                                <TextBlock Text="{loc:Loc 'Saved'}"
                                           Foreground="White"
                                           FontWeight="Medium"
                                           VerticalAlignment="Center" />
                            </StackPanel>
                        </Border>

                        <!-- No Changes Message Overlay -->
                        <Border x:Name="NoChangesBorder"
                                IsVisible="{Binding ShowNoChangesMessage}"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Top"
                                Margin="0,16,0,0"
                                Padding="12,8"
                                CornerRadius="4"
                                Background="#6B7280"
                                IsHitTestVisible="False"
                                Opacity="0">
                            <Border.Transitions>
                                <Transitions>
                                    <DoubleTransition Property="Opacity" Duration="0:0:0.3" Easing="CubicEaseOut" />
                                </Transitions>
                            </Border.Transitions>
                            <TextBlock Text="{loc:Loc 'No changes to save'}"
                                       Foreground="White"
                                       FontWeight="Medium"
                                       VerticalAlignment="Center" />
                        </Border>

                        <!-- Right-Click Context Menu -->
                        <controls:ReportsContextMenu IsOpen="{Binding IsContextMenuOpen}"
                                                      MenuX="{Binding ContextMenuX}"
                                                      MenuY="{Binding ContextMenuY}"
                                                      BringToFrontCommand="{Binding ContextMenuBringToFrontCommand}"
                                                      SendToBackCommand="{Binding ContextMenuSendToBackCommand}"
                                                      DuplicateCommand="{Binding ContextMenuDuplicateCommand}"
                                                      DeleteCommand="{Binding ContextMenuDeleteCommand}"
                                                      CloseCommand="{Binding HideContextMenuCommand}" />
                    </Grid>
                </Grid>

                <!-- Right Panel: Properties -->
                <Border Grid.Column="2"
                        Background="{DynamicResource SurfaceBrush}"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="1,0,0,0"
                        Padding="16,16,0,16">
                    <ScrollViewer VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled">
                        <StackPanel Spacing="16" Width="212" Margin="0,0,16,0">
                            <TextBlock Text="{loc:Loc 'Properties'}"
                                       FontSize="14"
                                       FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextPrimaryBrush}" />

                            <!-- Position & Size -->
                            <StackPanel Spacing="8" IsVisible="{Binding SelectedElement, Converter={x:Static ObjectConverters.IsNotNull}}">
                                <TextBlock Text="{loc:Loc 'Position &amp; Size'}"
                                           FontSize="12"
                                           FontWeight="Medium"
                                           Foreground="{DynamicResource TextSecondaryBrush}" />

                                <Grid ColumnDefinitions="*,8,*" RowDefinitions="Auto,8,Auto">
                                    <StackPanel Grid.Column="0" Grid.Row="0" Spacing="4">
                                        <TextBlock Text="{loc:Loc 'X'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                        <controls:ArgoNumericUpDown Value="{Binding SelectedElement.X}" Minimum="0" />
                                    </StackPanel>
                                    <StackPanel Grid.Column="2" Grid.Row="0" Spacing="4">
                                        <TextBlock Text="{loc:Loc 'Y'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                        <controls:ArgoNumericUpDown Value="{Binding SelectedElement.Y}" Minimum="0" />
                                    </StackPanel>
                                    <StackPanel Grid.Column="0" Grid.Row="2" Spacing="4">
                                        <TextBlock Text="{loc:Loc 'Width'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                        <controls:ArgoNumericUpDown Value="{Binding SelectedElement.Width}" Minimum="20" />
                                    </StackPanel>
                                    <StackPanel Grid.Column="2" Grid.Row="2" Spacing="4">
                                        <TextBlock Text="{loc:Loc 'Height'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                        <controls:ArgoNumericUpDown Value="{Binding SelectedElement.Height}" Minimum="20" />
                                    </StackPanel>
                                </Grid>
                            </StackPanel>

                            <!-- Chart Properties -->
                            <StackPanel Spacing="8" IsVisible="{Binding IsChartSelected}">
                                <TextBlock Text="{loc:Loc 'Chart Properties'}"
                                           FontSize="12"
                                           FontWeight="Medium"
                                           Foreground="{DynamicResource TextSecondaryBrush}" />
                                <controls:SearchableDropdown
                                    Label="{loc:Loc 'Chart Type'}"
                                    Placeholder="{loc:Loc 'Search chart types...'}"
                                    ItemsSource="{Binding ChartTypeOptions}"
                                    SelectedItem="{Binding SelectedChartDataTypeOption}" />
                                <StackPanel Spacing="4" IsVisible="{Binding !IsDistributionChartSelected}">
                                    <TextBlock Text="{loc:Loc 'Chart Style'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <ComboBox ItemsSource="{Binding ChartStyleOptions}"
                                              SelectedItem="{Binding SelectedChartStyleOption}"
                                              HorizontalAlignment="Stretch" />
                                </StackPanel>
                                <CheckBox Content="{loc:Loc 'Show Title'}" IsChecked="{Binding SelectedChartElement.ShowTitle}" />
                                <CheckBox Content="{loc:Loc 'Show Legend'}" IsChecked="{Binding SelectedChartElement.ShowLegend}" IsVisible="{Binding IsDistributionChartSelected}" />
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Title Font'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <ComboBox ItemsSource="{Binding FontFamilies}"
                                              SelectedItem="{Binding SelectedChartElement.TitleFontFamily}"
                                              HorizontalAlignment="Stretch" />
                                </StackPanel>
                                <StackPanel Spacing="4" IsVisible="{Binding !IsDistributionChartSelected}">
                                    <TextBlock Text="{loc:Loc 'Axis Font'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <ComboBox ItemsSource="{Binding FontFamilies}"
                                              SelectedItem="{Binding SelectedChartElement.FontFamily}"
                                              HorizontalAlignment="Stretch" />
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Title Size'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <controls:ArgoNumericUpDown Value="{Binding SelectedChartElement.TitleFontSize}" Minimum="6" Maximum="36" />
                                </StackPanel>
                                <StackPanel Spacing="4" IsVisible="{Binding !IsDistributionChartSelected}">
                                    <TextBlock Text="{loc:Loc 'Axis Size'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <controls:ArgoNumericUpDown Value="{Binding SelectedChartElement.AxisFontSize}" Minimum="6" Maximum="24" />
                                </StackPanel>
                                <StackPanel Spacing="4" IsVisible="{Binding IsDistributionChartSelected}">
                                    <TextBlock Text="{loc:Loc 'Legend Size'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <controls:ArgoNumericUpDown Value="{Binding SelectedChartElement.LegendFontSize}" Minimum="6" Maximum="24" />
                                </StackPanel>
                                <StackPanel Spacing="4" IsVisible="{Binding IsDistributionChartSelected}">
                                    <TextBlock Text="{loc:Loc 'Legend Max Characters'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <controls:ArgoNumericUpDown Value="{Binding SelectedChartElement.LegendMaxCharacters}" Minimum="5" Maximum="50" />
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Border Color'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <controls:ColorPickerInput ColorValue="{Binding SelectedChartElement.BorderColor, Mode=TwoWay}" />
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Border Thickness'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <controls:ArgoNumericUpDown Value="{Binding SelectedChartElement.BorderThickness}" Minimum="0" Maximum="10" />
                                </StackPanel>
                            </StackPanel>

                            <!-- Label Properties -->
                            <StackPanel Spacing="8" IsVisible="{Binding IsLabelSelected}">
                                <TextBlock Text="{loc:Loc 'Label Properties'}"
                                           FontSize="12"
                                           FontWeight="Medium"
                                           Foreground="{DynamicResource TextSecondaryBrush}" />
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Text'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <TextBox Text="{Binding SelectedLabelElement.Text}" />
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Font Family'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <ComboBox ItemsSource="{Binding FontFamilies}"
                                              SelectedItem="{Binding SelectedLabelElement.FontFamily}"
                                              HorizontalAlignment="Stretch" />
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Font Size'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <controls:ArgoNumericUpDown Value="{Binding SelectedLabelElement.FontSize}" Minimum="6" Maximum="72" />
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Text Color'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <controls:ColorPickerInput ColorValue="{Binding SelectedLabelElement.TextColor, Mode=TwoWay}" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Spacing="16">
                                    <CheckBox Content="{loc:Loc 'Bold'}" IsChecked="{Binding SelectedLabelElement.IsBold}" />
                                    <CheckBox Content="{loc:Loc 'Italic'}" IsChecked="{Binding SelectedLabelElement.IsItalic}" />
                                    <CheckBox Content="{loc:Loc 'Underline'}" IsChecked="{Binding SelectedLabelElement.IsUnderline}" />
                                </StackPanel>
                                <Grid ColumnDefinitions="*,8,*">
                                    <StackPanel Grid.Column="0" Spacing="4">
                                        <TextBlock Text="{loc:Loc 'H Align'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                        <ComboBox ItemsSource="{Binding HorizontalAlignments}"
                                                  SelectedItem="{Binding SelectedLabelElement.HorizontalAlignment}"
                                                  HorizontalAlignment="Stretch" />
                                    </StackPanel>
                                    <StackPanel Grid.Column="2" Spacing="4">
                                        <TextBlock Text="{loc:Loc 'V Align'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                        <ComboBox ItemsSource="{Binding VerticalAlignments}"
                                                  SelectedItem="{Binding SelectedLabelElement.VerticalAlignment}"
                                                  HorizontalAlignment="Stretch" />
                                    </StackPanel>
                                </Grid>
                            </StackPanel>

                            <!-- Image Properties -->
                            <StackPanel Spacing="8" IsVisible="{Binding IsImageSelected}">
                                <TextBlock Text="{loc:Loc 'Image Properties'}"
                                           FontSize="12"
                                           FontWeight="Medium"
                                           Foreground="{DynamicResource TextSecondaryBrush}" />

                                <!-- No image selected state -->
                                <Button Classes="secondary-button"
                                        Command="{Binding BrowseImagePathCommand}"
                                        IsVisible="{Binding !HasSelectedImage}"
                                        HorizontalAlignment="Stretch"
                                        HorizontalContentAlignment="Center"
                                        Padding="12,10">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <PathIcon Data="{x:Static icons:Icons.FolderFilled}"
                                                  Width="16" Height="16" />
                                        <TextBlock Text="{loc:Loc 'Select Image...'}" />
                                    </StackPanel>
                                </Button>

                                <!-- Image selected state -->
                                <StackPanel Spacing="8" IsVisible="{Binding HasSelectedImage}">
                                    <Grid ColumnDefinitions="Auto,*">
                                        <PathIcon Grid.Column="0"
                                                  Data="{x:Static icons:Icons.Image}"
                                                  Width="16" Height="16"
                                                  Foreground="{DynamicResource TextSecondaryBrush}"
                                                  VerticalAlignment="Center"
                                                  Margin="0,0,8,0" />
                                        <TextBlock Grid.Column="1"
                                                   Text="{Binding SelectedImageFileName}"
                                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                                   TextTrimming="CharacterEllipsis"
                                                   VerticalAlignment="Center"
                                                   ToolTip.Tip="{Binding SelectedImageElement.ImagePath}" />
                                    </Grid>
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <Button Classes="secondary-button"
                                                Content="{loc:Loc 'Change'}"
                                                Command="{Binding BrowseImagePathCommand}"
                                                Padding="12,6" />
                                        <Button Classes="secondary-button danger"
                                                Content="{loc:Loc 'Remove'}"
                                                Command="{Binding RemoveImageCommand}"
                                                Padding="12,6" />
                                    </StackPanel>
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Scale Mode'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <ComboBox ItemsSource="{Binding ImageScaleModes}"
                                              SelectedItem="{Binding SelectedImageElement.ScaleMode}"
                                              HorizontalAlignment="Stretch" />
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Opacity (%)'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <Grid ColumnDefinitions="*,Auto">
                                        <Slider Grid.Column="0"
                                                Value="{Binding SelectedImageElement.Opacity}"
                                                Minimum="0" Maximum="100"
                                                VerticalAlignment="Center" />
                                        <TextBox Grid.Column="1"
                                                 Text="{Binding SelectedImageElement.Opacity}"
                                                 Width="50"
                                                 Margin="8,0,0,0"
                                                 VerticalAlignment="Center" />
                                    </Grid>
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Corner Radius (%)'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <controls:ArgoNumericUpDown Value="{Binding SelectedImageElement.CornerRadiusPercent}" Minimum="0" Maximum="50" />
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Background Color'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <controls:ColorPickerInput ColorValue="{Binding SelectedImageElement.BackgroundColor, Mode=TwoWay}" />
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Border Color'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <controls:ColorPickerInput ColorValue="{Binding SelectedImageElement.BorderColor, Mode=TwoWay}" />
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Border Thickness'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <controls:ArgoNumericUpDown Value="{Binding SelectedImageElement.BorderThickness}" Minimum="0" Maximum="20" />
                                </StackPanel>
                            </StackPanel>

                            <!-- Date Range Properties -->
                            <StackPanel Spacing="8" IsVisible="{Binding IsDateRangeSelected}">
                                <TextBlock Text="{loc:Loc 'Date Range Properties'}"
                                           FontSize="12"
                                           FontWeight="Medium"
                                           Foreground="{DynamicResource TextSecondaryBrush}" />
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Date Format'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <ComboBox ItemsSource="{Binding DateFormats}"
                                              SelectedItem="{Binding SelectedDateRangeElement.DateFormat}"
                                              HorizontalAlignment="Stretch" />
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Font Family'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <ComboBox ItemsSource="{Binding FontFamilies}"
                                              SelectedItem="{Binding SelectedDateRangeElement.FontFamily}"
                                              HorizontalAlignment="Stretch" />
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Font Size'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <controls:ArgoNumericUpDown Value="{Binding SelectedDateRangeElement.FontSize}" Minimum="6" Maximum="72" />
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Text Color'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <controls:ColorPickerInput ColorValue="{Binding SelectedDateRangeElement.TextColor, Mode=TwoWay}" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Spacing="16">
                                    <CheckBox Content="{loc:Loc 'Bold'}" IsChecked="{Binding SelectedDateRangeElement.IsBold}" />
                                    <CheckBox Content="{loc:Loc 'Italic'}" IsChecked="{Binding SelectedDateRangeElement.IsItalic}" />
                                    <CheckBox Content="{loc:Loc 'Underline'}" IsChecked="{Binding SelectedDateRangeElement.IsUnderline}" />
                                </StackPanel>
                                <Grid ColumnDefinitions="*,8,*">
                                    <StackPanel Grid.Column="0" Spacing="4">
                                        <TextBlock Text="{loc:Loc 'H Align'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                        <ComboBox ItemsSource="{Binding HorizontalAlignments}"
                                                  SelectedItem="{Binding SelectedDateRangeElement.HorizontalAlignment}"
                                                  HorizontalAlignment="Stretch" />
                                    </StackPanel>
                                    <StackPanel Grid.Column="2" Spacing="4">
                                        <TextBlock Text="{loc:Loc 'V Align'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                        <ComboBox ItemsSource="{Binding VerticalAlignments}"
                                                  SelectedItem="{Binding SelectedDateRangeElement.VerticalAlignment}"
                                                  HorizontalAlignment="Stretch" />
                                    </StackPanel>
                                </Grid>
                            </StackPanel>

                            <!-- Summary Properties -->
                            <StackPanel Spacing="8" IsVisible="{Binding IsSummarySelected}">
                                <TextBlock Text="{loc:Loc 'Summary Properties'}"
                                           FontSize="12"
                                           FontWeight="Medium"
                                           Foreground="{DynamicResource TextSecondaryBrush}" />
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Transaction Type'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <ComboBox ItemsSource="{Binding TransactionTypes}"
                                              SelectedItem="{Binding SelectedSummaryElement.TransactionType}"
                                              HorizontalAlignment="Stretch">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Converter={StaticResource EnumDisplayNameConverter}}" />
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>
                                </StackPanel>
                                <CheckBox Content="{loc:Loc 'Show Total Revenue'}" IsChecked="{Binding SelectedSummaryElement.ShowTotalRevenue}" />
                                <CheckBox Content="{loc:Loc 'Show Total Transactions'}" IsChecked="{Binding SelectedSummaryElement.ShowTotalTransactions}" />
                                <CheckBox Content="{loc:Loc 'Show Average Value'}" IsChecked="{Binding SelectedSummaryElement.ShowAverageValue}" />
                                <CheckBox Content="{loc:Loc 'Show Growth Rate'}" IsChecked="{Binding SelectedSummaryElement.ShowGrowthRate}" />
                                <CheckBox Content="{loc:Loc 'Include Returns'}" IsChecked="{Binding SelectedSummaryElement.IncludeReturns}"
                                          IsVisible="{Binding SelectedSummaryElement.TransactionType, Converter={StaticResource TransactionTypeSupportsReturnsConverter}}" />
                                <CheckBox Content="{loc:Loc 'Include Losses'}" IsChecked="{Binding SelectedSummaryElement.IncludeLosses}"
                                          IsVisible="{Binding SelectedSummaryElement.TransactionType, Converter={StaticResource TransactionTypeSupportsReturnsConverter}}" />

                                <TextBlock Text="{loc:Loc 'Formatting'}"
                                           FontSize="12"
                                           FontWeight="Medium"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           Margin="0,8,0,0" />
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Font Family'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <ComboBox ItemsSource="{Binding FontFamilies}"
                                              SelectedItem="{Binding SelectedSummaryElement.FontFamily}"
                                              HorizontalAlignment="Stretch" />
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Font Size'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <controls:ArgoNumericUpDown Value="{Binding SelectedSummaryElement.FontSize}" Minimum="6" Maximum="24" />
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Background Color'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <controls:ColorPickerInput ColorValue="{Binding SelectedSummaryElement.BackgroundColor, Mode=TwoWay}" />
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Border Color'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <controls:ColorPickerInput ColorValue="{Binding SelectedSummaryElement.BorderColor, Mode=TwoWay}" />
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Border Thickness'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <controls:ArgoNumericUpDown Value="{Binding SelectedSummaryElement.BorderThickness}" Minimum="0" Maximum="10" />
                                </StackPanel>
                                <Grid ColumnDefinitions="*,8,*">
                                    <StackPanel Grid.Column="0" Spacing="4">
                                        <TextBlock Text="{loc:Loc 'H Align'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                        <ComboBox ItemsSource="{Binding HorizontalAlignments}"
                                                  SelectedItem="{Binding SelectedSummaryElement.HorizontalAlignment}"
                                                  HorizontalAlignment="Stretch" />
                                    </StackPanel>
                                    <StackPanel Grid.Column="2" Spacing="4">
                                        <TextBlock Text="{loc:Loc 'V Align'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                        <ComboBox ItemsSource="{Binding VerticalAlignments}"
                                                  SelectedItem="{Binding SelectedSummaryElement.VerticalAlignment}"
                                                  HorizontalAlignment="Stretch" />
                                    </StackPanel>
                                </Grid>
                            </StackPanel>

                            <!-- Table Properties -->
                            <StackPanel Spacing="8" IsVisible="{Binding IsTableSelected}">
                                <TextBlock Text="{loc:Loc 'Table Properties'}"
                                           FontSize="12"
                                           FontWeight="Medium"
                                           Foreground="{DynamicResource TextSecondaryBrush}" />

                                <!-- Tab Buttons -->
                                <StackPanel Spacing="0">
                                    <Grid ColumnDefinitions="*,*,*">
                                        <Button Grid.Column="0"
                                                Content="{loc:Loc 'General'}"
                                                Classes="property-tab-button"
                                                Classes.selected="{Binding TablePropertiesTabIndex, Converter={StaticResource EqualConverter}, ConverterParameter=0}"
                                                Command="{Binding SetTablePropertiesTabCommand}"
                                                CommandParameter="0" />
                                        <Button Grid.Column="1"
                                                Content="{loc:Loc 'Style'}"
                                                Classes="property-tab-button"
                                                Classes.selected="{Binding TablePropertiesTabIndex, Converter={StaticResource EqualConverter}, ConverterParameter=1}"
                                                Command="{Binding SetTablePropertiesTabCommand}"
                                                CommandParameter="1" />
                                        <Button Grid.Column="2"
                                                Content="{loc:Loc 'Columns'}"
                                                Classes="property-tab-button"
                                                Classes.selected="{Binding TablePropertiesTabIndex, Converter={StaticResource EqualConverter}, ConverterParameter=2}"
                                                Command="{Binding SetTablePropertiesTabCommand}"
                                                CommandParameter="2" />
                                    </Grid>
                                    <Border Height="1" Background="{DynamicResource BorderBrush}" Margin="0,0,0,8" />
                                </StackPanel>

                                <!-- General Tab -->
                                <StackPanel Spacing="8" IsVisible="{Binding TablePropertiesTabIndex, Converter={StaticResource EqualConverter}, ConverterParameter=0}">
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="{loc:Loc 'Transaction Type'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                        <ComboBox ItemsSource="{Binding TransactionTypes}"
                                                  SelectedItem="{Binding SelectedTableElement.TransactionType}"
                                                  HorizontalAlignment="Stretch">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Converter={StaticResource EnumDisplayNameConverter}}" />
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>
                                    </StackPanel>
                                    <CheckBox Content="{loc:Loc 'Include Returns'}" IsChecked="{Binding SelectedTableElement.IncludeReturns}"
                                              IsVisible="{Binding SelectedTableElement.TransactionType, Converter={StaticResource TransactionTypeSupportsReturnsConverter}}" />
                                    <CheckBox Content="{loc:Loc 'Include Losses'}" IsChecked="{Binding SelectedTableElement.IncludeLosses}"
                                              IsVisible="{Binding SelectedTableElement.TransactionType, Converter={StaticResource TransactionTypeSupportsReturnsConverter}}" />
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="{loc:Loc 'Sort Order'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                        <ComboBox ItemsSource="{Binding TableSortOrders}"
                                                  SelectedItem="{Binding SelectedTableElement.SortOrder}"
                                                  HorizontalAlignment="Stretch">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Converter={StaticResource EnumDisplayNameConverter}}" />
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>
                                    </StackPanel>
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="{loc:Loc 'Max Rows'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                        <controls:ArgoNumericUpDown Value="{Binding SelectedTableElement.MaxRows}" Minimum="1" Maximum="50" />
                                    </StackPanel>
                                </StackPanel>

                                <!-- Style Tab -->
                                <StackPanel Spacing="8" IsVisible="{Binding TablePropertiesTabIndex, Converter={StaticResource EqualConverter}, ConverterParameter=1}">
                                    <TextBlock Text="{loc:Loc 'Display Options'}"
                                               FontSize="11"
                                               FontWeight="Medium"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <CheckBox Content="{loc:Loc 'Show Title'}" IsChecked="{Binding SelectedTableElement.ShowTitle}" />
                                    <CheckBox Content="{loc:Loc 'Show Headers'}" IsChecked="{Binding SelectedTableElement.ShowHeaders}" />
                                    <CheckBox Content="{loc:Loc 'Show Grid Lines'}" IsChecked="{Binding SelectedTableElement.ShowGridLines}" />
                                    <CheckBox Content="{loc:Loc 'Show Totals Row'}" IsChecked="{Binding SelectedTableElement.ShowTotalsRow}" />
                                    <CheckBox Content="{loc:Loc 'Alternate Row Colors'}" IsChecked="{Binding SelectedTableElement.AlternateRowColors}" />
                                    <CheckBox Content="{loc:Loc 'Auto Size Columns'}" IsChecked="{Binding SelectedTableElement.AutoSizeColumns}" />

                                    <TextBlock Text="{loc:Loc 'Text Alignment'}"
                                               FontSize="11"
                                               FontWeight="Medium"
                                               Foreground="{DynamicResource TextTertiaryBrush}"
                                               Margin="0,8,0,0" />
                                    <ComboBox ItemsSource="{Binding HorizontalAlignments}"
                                              SelectedItem="{Binding SelectedTableElement.TextAlignment}"
                                              HorizontalAlignment="Stretch" />

                                    <TextBlock Text="{loc:Loc 'Title'}"
                                               FontSize="11"
                                               FontWeight="Medium"
                                               Foreground="{DynamicResource TextTertiaryBrush}"
                                               Margin="0,8,0,0" />
                                    <Grid ColumnDefinitions="*,8,*">
                                        <StackPanel Grid.Column="0" Spacing="4">
                                            <TextBlock Text="{loc:Loc 'Size'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                            <controls:ArgoNumericUpDown Value="{Binding SelectedTableElement.TitleFontSize}" Minimum="6" Maximum="24" />
                                        </StackPanel>
                                        <StackPanel Grid.Column="2" Spacing="4">
                                            <TextBlock Text="{loc:Loc 'Family'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                            <ComboBox ItemsSource="{Binding FontFamilies}"
                                                      SelectedItem="{Binding SelectedTableElement.TitleFontFamily}"
                                                      HorizontalAlignment="Stretch" />
                                        </StackPanel>
                                    </Grid>

                                    <TextBlock Text="{loc:Loc 'Header Font'}"
                                               FontSize="11"
                                               FontWeight="Medium"
                                               Foreground="{DynamicResource TextTertiaryBrush}"
                                               Margin="0,8,0,0" />
                                    <Grid ColumnDefinitions="*,8,*">
                                        <StackPanel Grid.Column="0" Spacing="4">
                                            <TextBlock Text="{loc:Loc 'Size'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                            <controls:ArgoNumericUpDown Value="{Binding SelectedTableElement.HeaderFontSize}" Minimum="6" Maximum="24" />
                                        </StackPanel>
                                        <StackPanel Grid.Column="2" Spacing="4">
                                            <TextBlock Text="{loc:Loc 'Family'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                            <ComboBox ItemsSource="{Binding FontFamilies}"
                                                      SelectedItem="{Binding SelectedTableElement.HeaderFontFamily}"
                                                      HorizontalAlignment="Stretch" />
                                        </StackPanel>
                                    </Grid>

                                    <TextBlock Text="{loc:Loc 'Data Font'}"
                                               FontSize="11"
                                               FontWeight="Medium"
                                               Foreground="{DynamicResource TextTertiaryBrush}"
                                               Margin="0,8,0,0" />
                                    <Grid ColumnDefinitions="*,8,*">
                                        <StackPanel Grid.Column="0" Spacing="4">
                                            <TextBlock Text="{loc:Loc 'Size'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                            <controls:ArgoNumericUpDown Value="{Binding SelectedTableElement.FontSize}" Minimum="6" Maximum="24" />
                                        </StackPanel>
                                        <StackPanel Grid.Column="2" Spacing="4">
                                            <TextBlock Text="{loc:Loc 'Family'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                            <ComboBox ItemsSource="{Binding FontFamilies}"
                                                      SelectedItem="{Binding SelectedTableElement.FontFamily}"
                                                      HorizontalAlignment="Stretch" />
                                        </StackPanel>
                                    </Grid>

                                    <TextBlock Text="{loc:Loc 'Row Heights'}"
                                               FontSize="11"
                                               FontWeight="Medium"
                                               Foreground="{DynamicResource TextTertiaryBrush}"
                                               Margin="0,8,0,0" />
                                    <Grid ColumnDefinitions="*,8,*">
                                        <StackPanel Grid.Column="0" Spacing="4">
                                            <TextBlock Text="{loc:Loc 'Header'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                            <controls:ArgoNumericUpDown Value="{Binding SelectedTableElement.HeaderRowHeight}" Minimum="16" Maximum="50" />
                                        </StackPanel>
                                        <StackPanel Grid.Column="2" Spacing="4">
                                            <TextBlock Text="{loc:Loc 'Data'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                            <controls:ArgoNumericUpDown Value="{Binding SelectedTableElement.DataRowHeight}" Minimum="16" Maximum="50" />
                                        </StackPanel>
                                    </Grid>
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="{loc:Loc 'Cell Padding'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                        <controls:ArgoNumericUpDown Value="{Binding SelectedTableElement.CellPadding}" Minimum="0" Maximum="20" />
                                    </StackPanel>

                                    <TextBlock Text="{loc:Loc 'Colors'}"
                                               FontSize="11"
                                               FontWeight="Medium"
                                               Foreground="{DynamicResource TextTertiaryBrush}"
                                               Margin="0,8,0,0" />
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="{loc:Loc 'Title BG'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                        <controls:ColorPickerInput ColorValue="{Binding SelectedTableElement.TitleBackgroundColor, Mode=TwoWay}" />
                                    </StackPanel>
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="{loc:Loc 'Title Text'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                        <controls:ColorPickerInput ColorValue="{Binding SelectedTableElement.TitleTextColor, Mode=TwoWay}" />
                                    </StackPanel>
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="{loc:Loc 'Header BG'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                        <controls:ColorPickerInput ColorValue="{Binding SelectedTableElement.HeaderBackgroundColor, Mode=TwoWay}" />
                                    </StackPanel>
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="{loc:Loc 'Header Text'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                        <controls:ColorPickerInput ColorValue="{Binding SelectedTableElement.HeaderTextColor, Mode=TwoWay}" />
                                    </StackPanel>
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="{loc:Loc 'Row Text'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                        <controls:ColorPickerInput ColorValue="{Binding SelectedTableElement.DataRowTextColor, Mode=TwoWay}" />
                                    </StackPanel>
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="{loc:Loc 'Grid Lines'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                        <controls:ColorPickerInput ColorValue="{Binding SelectedTableElement.GridLineColor, Mode=TwoWay}" />
                                    </StackPanel>
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="{loc:Loc 'Base Row'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                        <controls:ColorPickerInput ColorValue="{Binding SelectedTableElement.BaseRowColor, Mode=TwoWay}" />
                                    </StackPanel>
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="{loc:Loc 'Alt Row'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                        <controls:ColorPickerInput ColorValue="{Binding SelectedTableElement.AlternateRowColor, Mode=TwoWay}" />
                                    </StackPanel>
                                </StackPanel>

                                <!-- Columns Tab -->
                                <StackPanel Spacing="8" IsVisible="{Binding TablePropertiesTabIndex, Converter={StaticResource EqualConverter}, ConverterParameter=2}">
                                    <CheckBox Content="{loc:Loc 'Date'}" IsChecked="{Binding SelectedTableElement.ShowDateColumn}" />
                                    <CheckBox Content="{loc:Loc 'Transaction ID'}" IsChecked="{Binding SelectedTableElement.ShowTransactionIdColumn}" />
                                    <CheckBox Content="{loc:Loc 'Company'}" IsChecked="{Binding SelectedTableElement.ShowCompanyColumn}" />
                                    <CheckBox Content="{loc:Loc 'Product'}" IsChecked="{Binding SelectedTableElement.ShowProductColumn}" />
                                    <CheckBox Content="{loc:Loc 'Quantity'}" IsChecked="{Binding SelectedTableElement.ShowQuantityColumn}" />
                                    <CheckBox Content="{loc:Loc 'Total'}" IsChecked="{Binding SelectedTableElement.ShowTotalColumn}" />
                                    <CheckBox Content="{loc:Loc 'Status'}" IsChecked="{Binding SelectedTableElement.ShowStatusColumn}" />
                                </StackPanel>
                            </StackPanel>

                            <!-- Accounting Table Properties -->
                            <StackPanel Spacing="8" IsVisible="{Binding IsAccountingTableSelected}">
                                <TextBlock Text="{loc:Loc 'Accounting Table Properties'}"
                                           FontSize="12"
                                           FontWeight="Medium"
                                           Foreground="{DynamicResource TextSecondaryBrush}" />

                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Report Type'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <ComboBox ItemsSource="{Binding AccountingReportTypes}"
                                              SelectedItem="{Binding SelectedAccountingTableElement.ReportType}"
                                              HorizontalAlignment="Stretch">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Converter={StaticResource EnumDisplayNameConverter}}" />
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>
                                </StackPanel>

                                <CheckBox Content="{loc:Loc 'Show Company Header'}" IsChecked="{Binding SelectedAccountingTableElement.ShowCompanyHeader}" />
                                <CheckBox Content="{loc:Loc 'Show Grid Lines'}" IsChecked="{Binding SelectedAccountingTableElement.ShowGridLines}" />
                                <CheckBox Content="{loc:Loc 'Alternate Row Colors'}" IsChecked="{Binding SelectedAccountingTableElement.AlternateRowColors}" />

                                <TextBlock Text="{loc:Loc 'Font'}"
                                           FontSize="11"
                                           FontWeight="Medium"
                                           Foreground="{DynamicResource TextTertiaryBrush}"
                                           Margin="0,8,0,0" />
                                <Grid ColumnDefinitions="*,8,*">
                                    <StackPanel Grid.Column="0" Spacing="4">
                                        <TextBlock Text="{loc:Loc 'Size'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                        <controls:ArgoNumericUpDown Value="{Binding SelectedAccountingTableElement.FontSize}" Minimum="6" Maximum="24" />
                                    </StackPanel>
                                    <StackPanel Grid.Column="2" Spacing="4">
                                        <TextBlock Text="{loc:Loc 'Family'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                        <ComboBox ItemsSource="{Binding FontFamilies}"
                                                  SelectedItem="{Binding SelectedAccountingTableElement.FontFamily}"
                                                  HorizontalAlignment="Stretch" />
                                    </StackPanel>
                                </Grid>

                                <TextBlock Text="{loc:Loc 'Row Heights'}"
                                           FontSize="11"
                                           FontWeight="Medium"
                                           Foreground="{DynamicResource TextTertiaryBrush}"
                                           Margin="0,8,0,0" />
                                <Grid ColumnDefinitions="*,8,*">
                                    <StackPanel Grid.Column="0" Spacing="4">
                                        <TextBlock Text="{loc:Loc 'Header'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                        <controls:ArgoNumericUpDown Value="{Binding SelectedAccountingTableElement.HeaderRowHeight}" Minimum="16" Maximum="50" />
                                    </StackPanel>
                                    <StackPanel Grid.Column="2" Spacing="4">
                                        <TextBlock Text="{loc:Loc 'Data'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                        <controls:ArgoNumericUpDown Value="{Binding SelectedAccountingTableElement.DataRowHeight}" Minimum="16" Maximum="50" />
                                    </StackPanel>
                                </Grid>

                                <TextBlock Text="{loc:Loc 'Colors'}"
                                           FontSize="11"
                                           FontWeight="Medium"
                                           Foreground="{DynamicResource TextTertiaryBrush}"
                                           Margin="0,8,0,0" />
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Header BG'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <controls:ColorPickerInput ColorValue="{Binding SelectedAccountingTableElement.HeaderBackgroundColor, Mode=TwoWay}" />
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Header Text'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <controls:ColorPickerInput ColorValue="{Binding SelectedAccountingTableElement.HeaderTextColor, Mode=TwoWay}" />
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Section Header BG'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <controls:ColorPickerInput ColorValue="{Binding SelectedAccountingTableElement.SectionHeaderBackgroundColor, Mode=TwoWay}" />
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Total BG'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <controls:ColorPickerInput ColorValue="{Binding SelectedAccountingTableElement.TotalBackgroundColor, Mode=TwoWay}" />
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Total Text'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <controls:ColorPickerInput ColorValue="{Binding SelectedAccountingTableElement.TotalTextColor, Mode=TwoWay}" />
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{loc:Loc 'Grid Lines'}" FontSize="11" Foreground="{DynamicResource TextTertiaryBrush}" />
                                    <controls:ColorPickerInput ColorValue="{Binding SelectedAccountingTableElement.GridLineColor, Mode=TwoWay}" />
                                </StackPanel>
                            </StackPanel>

                            <!-- No Selection Message -->
                            <StackPanel IsVisible="{Binding SelectedElement, Converter={x:Static ObjectConverters.IsNull}}"
                                        Spacing="8"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Center"
                                        Margin="0,40">
                                <PathIcon Data="{x:Static icons:Icons.Edit}"
                                          Width="32" Height="32"
                                          Foreground="{DynamicResource TextTertiaryBrush}"
                                          HorizontalAlignment="Center" />
                                <TextBlock Text="{loc:Loc 'No element selected'}"
                                           FontSize="13"
                                           Foreground="{DynamicResource TextTertiaryBrush}"
                                           HorizontalAlignment="Center" />
                                <TextBlock Text="{loc:Loc 'Click an element on the canvas to edit its properties'}"
                                           FontSize="11"
                                           Foreground="{DynamicResource TextTertiaryBrush}"
                                           TextWrapping="Wrap"
                                           TextAlignment="Center"
                                           HorizontalAlignment="Center" />
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>
                </Border>
            </Grid>

            <!-- Step 3: Preview & Export -->
            <Grid IsVisible="{Binding IsStep3}"
                  ColumnDefinitions="*,300">

                <!-- Preview Area -->
                <Border Grid.Column="0"
                        Background="{DynamicResource BackgroundSecondaryBrush}"
                        Margin="24">
                    <ScrollViewer x:Name="PreviewScrollViewer"
                                  HorizontalScrollBarVisibility="Auto"
                                  VerticalScrollBarVisibility="Auto">
                        <LayoutTransformControl x:Name="PreviewZoomTransformControl"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Top"
                                                Margin="10">
                            <ItemsControl ItemsSource="{Binding PreviewPageImages}"
                                          Width="{Binding PreviewDisplayWidth}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Spacing="16"
                                                    Margin="0,10" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:CompileBindings="False">
                                        <Border Background="{DynamicResource SurfaceBrush}"
                                                CornerRadius="4"
                                                BoxShadow="0 1 4 0 #22000000">
                                            <Image Source="{Binding}"
                                                   Stretch="Uniform" />
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </LayoutTransformControl>
                    </ScrollViewer>
                </Border>

                <!-- Export Settings -->
                <Border Grid.Column="1"
                        Background="{DynamicResource SurfaceBrush}"
                        Margin="0,24,24,24"
                        CornerRadius="0"
                        Padding="24">
                    <StackPanel Spacing="20">
                        <TextBlock Text="{loc:Loc 'Export Settings'}"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextPrimaryBrush}" />

                        <!-- Format Selection -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="{loc:Loc 'Format'}"
                                       FontSize="14"
                                       FontWeight="Medium"
                                       Foreground="{DynamicResource TextSecondaryBrush}" />

                            <StackPanel Spacing="4">
                                <RadioButton GroupName="ExportFormat"
                                             IsChecked="{Binding SelectedExportFormat, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static enums:ExportFormat.PDF}}"
                                             Command="{Binding SelectExportFormatCommand}"
                                             CommandParameter="{x:Static enums:ExportFormat.PDF}">
                                    <StackPanel>
                                        <TextBlock Text="{loc:Loc 'PDF Document'}"
                                                   FontWeight="Medium"
                                                   Foreground="{DynamicResource TextPrimaryBrush}" />
                                        <TextBlock Text="{loc:Loc 'For printing &amp; sharing'}"
                                                   FontSize="12"
                                                   Foreground="{DynamicResource TextSecondaryBrush}" />
                                    </StackPanel>
                                </RadioButton>
                                <RadioButton GroupName="ExportFormat"
                                             IsChecked="{Binding SelectedExportFormat, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static enums:ExportFormat.PNG}}"
                                             Command="{Binding SelectExportFormatCommand}"
                                             CommandParameter="{x:Static enums:ExportFormat.PNG}">
                                    <StackPanel>
                                        <TextBlock Text="{loc:Loc 'PNG Image'}"
                                                   FontWeight="Medium"
                                                   Foreground="{DynamicResource TextPrimaryBrush}" />
                                        <TextBlock Text="{loc:Loc 'High quality, lossless'}"
                                                   FontSize="12"
                                                   Foreground="{DynamicResource TextSecondaryBrush}" />
                                    </StackPanel>
                                </RadioButton>
                                <RadioButton GroupName="ExportFormat"
                                             IsChecked="{Binding SelectedExportFormat, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static enums:ExportFormat.JPEG}}"
                                             Command="{Binding SelectExportFormatCommand}"
                                             CommandParameter="{x:Static enums:ExportFormat.JPEG}">
                                    <StackPanel>
                                        <TextBlock Text="{loc:Loc 'JPEG Image'}"
                                                   FontWeight="Medium"
                                                   Foreground="{DynamicResource TextPrimaryBrush}" />
                                        <TextBlock Text="{loc:Loc 'Smaller file size'}"
                                                   FontSize="12"
                                                   Foreground="{DynamicResource TextSecondaryBrush}" />
                                    </StackPanel>
                                </RadioButton>
                            </StackPanel>
                        </StackPanel>

                        <!-- Quality Slider -->
                        <StackPanel Spacing="8">
                            <Grid ColumnDefinitions="*,Auto">
                                <TextBlock Grid.Column="0"
                                           Text="{loc:Loc 'Quality'}"
                                           FontSize="14"
                                           FontWeight="Medium"
                                           Foreground="{DynamicResource TextSecondaryBrush}" />
                                <TextBlock Grid.Column="1"
                                           Text="{Binding ExportQuality, StringFormat={}{0}%}"
                                           FontSize="14"
                                           Foreground="{DynamicResource TextPrimaryBrush}" />
                            </Grid>
                            <Slider Value="{Binding ExportQuality}"
                                    Minimum="50"
                                    Maximum="100"
                                    TickFrequency="5"
                                    IsSnapToTickEnabled="True" />
                        </StackPanel>

                        <!-- File Path -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="{loc:Loc 'File Path'}"
                                       FontSize="14"
                                       FontWeight="Medium"
                                       Foreground="{DynamicResource TextSecondaryBrush}" />
                            <Grid ColumnDefinitions="*,Auto">
                                <TextBox Grid.Column="0"
                                         Text="{Binding ExportFilePath}"
                                         Watermark="{loc:Loc 'Select file path...'}"
                                         Padding="12,10" />
                                <Button Grid.Column="1"
                                        Classes="toolbar-button"
                                        Margin="8,0,0,0"
                                        ToolTip.Tip="{loc:Loc 'Browse'}"
                                        Command="{Binding BrowseExportPathCommand}">
                                    <PathIcon Data="{x:Static icons:Icons.FolderFilled}"
                                              Width="16" Height="16" />
                                </Button>
                            </Grid>
                        </StackPanel>

                        <!-- Options -->
                        <StackPanel Spacing="8">
                            <CheckBox Content="{loc:Loc 'Open after export'}"
                                      IsChecked="{Binding OpenAfterExport}" />
                            <CheckBox Content="{loc:Loc 'Include metadata'}"
                                      IsChecked="{Binding IncludeMetadata}" />
                        </StackPanel>

                        <!-- Export Message -->
                        <TextBlock Text="{Binding ExportMessage}"
                                   FontSize="13"
                                   Foreground="{DynamicResource SuccessBrush}"
                                   TextWrapping="Wrap"
                                   IsVisible="{Binding ExportMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />
                    </StackPanel>
                </Border>
            </Grid>
        </Panel>

        <!-- Footer Navigation -->
        <Border Grid.Row="2"
                Background="{DynamicResource SurfaceBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="0,1,0,0"
                Padding="24,16">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <!-- Previous Button -->
                <Button Grid.Column="0"
                        Classes="secondary-button"
                        HorizontalAlignment="Left"
                        Command="{Binding GoToPreviousStepCommand}"
                        IsVisible="{Binding CanGoBack}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <PathIcon Data="{x:Static icons:Icons.ChevronLeft}"
                                  Width="16" Height="16" />
                        <TextBlock Text="{loc:Loc 'Previous'}" />
                    </StackPanel>
                </Button>

                <!-- Center: Zoom Controls (Step 2 - Layout Designer) -->
                <StackPanel Grid.Column="1"
                            Orientation="Horizontal"
                            Spacing="8"
                            HorizontalAlignment="Center"
                            IsVisible="{Binding IsStep2}">
                    <Button Classes="toolbar-button" Click="OnZoomOutClick" ToolTip.Tip="{loc:Loc 'Zoom Out (Ctrl+-)'}">
                        <PathIcon Data="{x:Static icons:Icons.ZoomOut}"
                                  Width="16" Height="16" />
                    </Button>
                    <Slider Value="{Binding ZoomLevel}"
                            Minimum="0.25"
                            Maximum="2.0"
                            Width="150"
                            VerticalAlignment="Center" />
                    <Button Classes="toolbar-button" Click="OnZoomInClick" ToolTip.Tip="{loc:Loc 'Zoom In (Ctrl++)'}">
                        <PathIcon Data="{x:Static icons:Icons.ZoomIn}"
                                  Width="16" Height="16" />
                    </Button>
                    <TextBlock Text="{Binding ZoomLevel, StringFormat={}{0:P0}}"
                               VerticalAlignment="Center"
                               FontSize="12"
                               Width="50"
                               TextAlignment="Center"
                               Foreground="{DynamicResource TextSecondaryBrush}" />
                    <Button Classes="toolbar-button" Click="OnZoomFitClick" ToolTip.Tip="{loc:Loc 'Fit to Window'}">
                        <!-- Fit to window icon: corners with center focus dot -->
                        <PathIcon Data="{x:Static icons:Icons.ScanFocus}"
                                  Width="16" Height="16" />
                    </Button>

                    <!-- Add/Delete Page -->
                    <Border Width="1" Height="20" Background="{DynamicResource BorderBrush}" Margin="4,0" />
                    <Button Classes="toolbar-button" Command="{Binding AddPageCommand}" ToolTip.Tip="{loc:Loc 'Add Page'}">
                        <PathIcon Data="{x:Static icons:Icons.AddAlt}"
                                  Width="16" Height="16" />
                    </Button>
                    <Button Classes="toolbar-button" Command="{Binding DeletePageCommand}" IsEnabled="{Binding CanDeletePage}" ToolTip.Tip="{loc:Loc 'Delete Page'}">
                        <PathIcon Data="{x:Static icons:Icons.Delete}"
                                  Width="16" Height="16" />
                    </Button>
                </StackPanel>

                <!-- Center: Zoom Controls (Step 3 - Preview) -->
                <StackPanel Grid.Column="1"
                            Orientation="Horizontal"
                            Spacing="8"
                            HorizontalAlignment="Center"
                            IsVisible="{Binding IsStep3}">
                    <Button Classes="toolbar-button" Click="OnPreviewZoomOutClick" ToolTip.Tip="{loc:Loc 'Zoom Out (Ctrl+-)'}">
                        <PathIcon Data="{x:Static icons:Icons.ZoomOut}"
                                  Width="16" Height="16" />
                    </Button>
                    <Slider Value="{Binding PreviewZoom}"
                            Minimum="0.25"
                            Maximum="2.0"
                            Width="150"
                            VerticalAlignment="Center" />
                    <Button Classes="toolbar-button" Click="OnPreviewZoomInClick" ToolTip.Tip="{loc:Loc 'Zoom In (Ctrl++)'}">
                        <PathIcon Data="{x:Static icons:Icons.ZoomIn}"
                                  Width="16" Height="16" />
                    </Button>
                    <TextBlock Text="{Binding PreviewZoom, StringFormat={}{0:P0}}"
                               VerticalAlignment="Center"
                               FontSize="12"
                               Width="50"
                               TextAlignment="Center"
                               Foreground="{DynamicResource TextSecondaryBrush}" />
                    <Button Classes="toolbar-button" Click="OnPreviewZoomFitClick" ToolTip.Tip="{loc:Loc 'Fit to Window'}">
                        <PathIcon Data="{x:Static icons:Icons.ScanFocus}"
                                  Width="16" Height="16" />
                    </Button>
                </StackPanel>

                <!-- Next Button -->
                <Button Grid.Column="2"
                        Classes="primary-button"
                        HorizontalAlignment="Right"
                        Command="{Binding GoToNextStepCommand}"
                        IsVisible="{Binding CanGoNext}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBlock Text="{loc:Loc 'Next'}" />
                        <PathIcon Data="{x:Static icons:Icons.ChevronRightNav}"
                                  Width="16" Height="16"
                                  Foreground="White" />
                    </StackPanel>
                </Button>

                <!-- Create Report Button (Final Step) -->
                <Button Grid.Column="2"
                        Classes="primary-button"
                        HorizontalAlignment="Right"
                        Command="{Binding ExportReportCommand}"
                        IsVisible="{Binding IsOnFinalStep}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <PathIcon Data="{x:Static local:Icons.Check}"
                                  Width="16" Height="16"
                                  Foreground="White" />
                        <TextBlock Text="{loc:Loc 'Create Report'}" />
                    </StackPanel>
                </Button>
            </Grid>
        </Border>
    </Grid>
    </Panel>

    <UserControl.Styles>
        <!-- TabControl - page tabs styling -->
        <Style Selector="TabControl.page-tabs">
            <Setter Property="Background" Value="Transparent" />
        </Style>
        <Style Selector="TabControl.page-tabs /template/ ItemsPresenter#PART_ItemsPresenter">
            <Setter Property="Margin" Value="24,0" />
        </Style>
        <Style Selector="TabControl.page-tabs /template/ Border#PART_InnerBorder">
            <Setter Property="BorderThickness" Value="0" />
        </Style>
        <Style Selector="TabControl.page-tabs /template/ ContentPresenter#PART_SelectedContentHost">
            <Setter Property="IsVisible" Value="False" />
        </Style>

        <!-- Tab Item Styling -->
        <Style Selector="TabControl.page-tabs TabItem">
            <Setter Property="FontSize" Value="14" />
            <Setter Property="FontWeight" Value="Medium" />
            <Setter Property="Padding" Value="4,12,4,10" />
            <Setter Property="Margin" Value="8,0" />
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>
        <Style Selector="TabControl.page-tabs TabItem:pointerover">
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
        </Style>
        <Style Selector="TabControl.page-tabs TabItem:pointerover /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="TextBlock.Foreground" Value="{DynamicResource TextPrimaryBrush}" />
        </Style>
        <Style Selector="TabControl.page-tabs TabItem:selected">
            <Setter Property="Foreground" Value="{DynamicResource PrimaryBrush}" />
        </Style>
        <Style Selector="TabControl.page-tabs TabItem:selected /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="TextBlock.Foreground" Value="{DynamicResource PrimaryBrush}" />
        </Style>
        <Style Selector="TabControl.page-tabs TabItem:selected /template/ Border#PART_SelectedPipe">
            <Setter Property="IsVisible" Value="True" />
            <Setter Property="Background" Value="{DynamicResource PrimaryBrush}" />
            <Setter Property="Height" Value="2" />
            <Setter Property="VerticalAlignment" Value="Bottom" />
            <Setter Property="Margin" Value="0,0,0,0" />
            <Setter Property="CornerRadius" Value="1" />
        </Style>

        <!-- Toolbox Button -->
        <Style Selector="Button.toolbox-button">
            <Setter Property="Background" Value="{DynamicResource SurfaceAltBrush}" />
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Padding" Value="12,10" />
            <Setter Property="HorizontalAlignment" Value="Stretch" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>
        <Style Selector="Button.toolbox-button:pointerover">
            <Setter Property="Background" Value="{DynamicResource SurfaceHoverBrush}" />
        </Style>

        <!-- Property Tab Button (for properties panel tabs - with background) -->
        <Style Selector="Button.property-tab-button">
            <Setter Property="Background" Value="{DynamicResource SurfaceAltBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="8,6" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="HorizontalAlignment" Value="Stretch" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="FontSize" Value="11" />
            <Setter Property="CornerRadius" Value="4" />
            <Setter Property="Margin" Value="1" />
        </Style>
        <Style Selector="Button.property-tab-button /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource SurfaceAltBrush}" />
        </Style>
        <Style Selector="Button.property-tab-button:pointerover /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource SurfaceHoverBrush}" />
        </Style>
        <Style Selector="Button.property-tab-button.selected">
            <Setter Property="Background" Value="{DynamicResource PrimaryBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource PrimaryBrush}" />
            <Setter Property="Foreground" Value="White" />
        </Style>
        <Style Selector="Button.property-tab-button.selected /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource PrimaryBrush}" />
        </Style>

        <!-- Toolbar Button -->
        <Style Selector="Button.toolbar-button">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Width" Value="32" />
            <Setter Property="Height" Value="32" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>
        <Style Selector="Button.toolbar-button:pointerover /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource SurfaceHoverBrush}" />
        </Style>
        <Style Selector="Button.toolbar-button PathIcon">
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}" />
        </Style>
        <Style Selector="Button.toolbar-button.danger:pointerover /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource ErrorLightBrush}" />
        </Style>
        <Style Selector="Button.toolbar-button.danger:pointerover PathIcon">
            <Setter Property="Foreground" Value="{DynamicResource ErrorBrush}" />
        </Style>

        <!-- Toolbar Toggle Button -->
        <Style Selector="ToggleButton.toolbar-toggle">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Width" Value="32" />
            <Setter Property="Height" Value="32" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>
        <Style Selector="ToggleButton.toolbar-toggle:checked /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource PrimaryBrush}" />
        </Style>
        <Style Selector="ToggleButton.toolbar-toggle:checked PathIcon">
            <Setter Property="Foreground" Value="White" />
        </Style>
        <Style Selector="ToggleButton.toolbar-toggle PathIcon">
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}" />
        </Style>

        <!-- Undo/Redo Main Button -->
        <Style Selector="Button.undo-redo-main">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Width" Value="32" />
            <Setter Property="Height" Value="28" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="CornerRadius" Value="4,0,0,4" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>
        <Style Selector="Button.undo-redo-main /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
            <Setter Property="CornerRadius" Value="4,0,0,4" />
        </Style>
        <Style Selector="Button.undo-redo-main:pointerover /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource SurfaceHoverBrush}" />
        </Style>
        <Style Selector="Button.undo-redo-main:pressed /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource SurfacePressedBrush}" />
        </Style>
        <Style Selector="Button.undo-redo-main:disabled /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource SurfaceAltBrush}" />
        </Style>
        <Style Selector="Button.undo-redo-main PathIcon">
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
        </Style>
        <Style Selector="Button.undo-redo-main:disabled PathIcon">
            <Setter Property="Foreground" Value="{DynamicResource TextTertiaryBrush}" />
        </Style>

        <!-- Undo/Redo Dropdown Button -->
        <Style Selector="Button.undo-redo-dropdown">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
            <Setter Property="BorderThickness" Value="0,1,1,1" />
            <Setter Property="Width" Value="18" />
            <Setter Property="Height" Value="28" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="CornerRadius" Value="0,4,4,0" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>
        <Style Selector="Button.undo-redo-dropdown /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
            <Setter Property="CornerRadius" Value="0,4,4,0" />
        </Style>
        <Style Selector="Button.undo-redo-dropdown:pointerover /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource SurfaceHoverBrush}" />
        </Style>
        <Style Selector="Button.undo-redo-dropdown:pressed /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource SurfacePressedBrush}" />
        </Style>
        <Style Selector="Button.undo-redo-dropdown:disabled /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource SurfaceAltBrush}" />
        </Style>
        <Style Selector="Button.undo-redo-dropdown PathIcon">
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}" />
        </Style>
        <Style Selector="Button.undo-redo-dropdown:disabled PathIcon">
            <Setter Property="Foreground" Value="{DynamicResource TextTertiaryBrush}" />
        </Style>

        <!-- Close Button (for modals) -->
        <Style Selector="Button.close-button">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Width" Value="32" />
            <Setter Property="Height" Value="32" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>
        <Style Selector="Button.close-button:pointerover /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource SurfaceHoverBrush}" />
        </Style>
        <Style Selector="Button.close-button PathIcon">
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}" />
        </Style>

    </UserControl.Styles>
</UserControl>
