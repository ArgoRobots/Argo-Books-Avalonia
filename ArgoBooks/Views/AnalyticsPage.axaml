<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:ArgoBooks.ViewModels"
             xmlns:controls="using:ArgoBooks.Controls"
             xmlns:lvc="using:LiveChartsCore.SkiaSharpView.Avalonia"
             mc:Ignorable="d" d:DesignWidth="1400" d:DesignHeight="900"
             x:Class="ArgoBooks.Views.AnalyticsPage"
             x:DataType="vm:AnalyticsPageViewModel">

    <Design.DataContext>
        <vm:AnalyticsPageViewModel />
    </Design.DataContext>

    <Panel>
        <Grid RowDefinitions="Auto,*">
        <!-- Header Bar with Date Range and Tabs -->
        <Border Grid.Row="0"
                Background="{DynamicResource SurfaceBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="0,0,0,1"
                ClipToBounds="False">
            <Grid RowDefinitions="Auto,Auto" ClipToBounds="False">
                <!-- Top Row: Date Range Selector -->
                <Border Grid.Row="0"
                        Padding="24,16"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="0,0,0,1">
                    <Grid ColumnDefinitions="*,Auto,Auto">
                        <!-- Page Title -->
                        <TextBlock Grid.Column="0"
                                   Text="Analytics"
                                   FontSize="20"
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                   VerticalAlignment="Center" />

                        <!-- Chart Type Selector -->
                        <controls:ChartTypeSelector Grid.Column="1"
                                                    Margin="0,0,16,0"
                                                    IsVisible="{Binding !IsGeographicTabSelected}" />

                        <!-- Date Range Controls -->
                        <controls:DateRangeSelector Grid.Column="2" />
                    </Grid>
                </Border>

                <!-- Tab Bar -->
                <Grid Grid.Row="1" ClipToBounds="False">
                    <!-- Analytics Tabs -->
                    <TabControl SelectedIndex="{Binding SelectedTabIndex}"
                                Classes="page-tabs">
                        <TabItem Header="Dashboard" />
                        <TabItem Header="Geographic" />
                        <TabItem Header="Operational" />
                        <TabItem Header="Performance" />
                        <TabItem Header="Customers" />
                        <TabItem Header="Returns" />
                        <TabItem Header="Losses" />
                    </TabControl>
                </Grid>
            </Grid>
        </Border>

        <!-- Main Content Area -->
        <ScrollViewer Grid.Row="1"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled"
                      Background="{DynamicResource BackgroundSecondaryBrush}">
            <Panel>
                <!-- Dashboard Tab Content -->
                <StackPanel Margin="24" Spacing="24"
                            IsVisible="{Binding IsDashboardTabSelected}">
                    <!-- Stats Grid -->
                    <UniformGrid Columns="4" Rows="1">
                        <controls:StatCard Label="Total Purchases"
                                           Value="{Binding TotalPurchases}"
                                           Icon="M19 14V6c0-1.1-.9-2-2-2H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zm-9-1c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm13-6v11c0 1.1-.9 2-2 2H4v-2h17V7h2z"
                                           IconColor="Danger"
                                           ChangeValue="{Binding PurchasesChangeValue}"
                                           ChangeText="{Binding PurchasesChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}"
                                           Margin="0,0,12,0" />
                        <controls:StatCard Label="Total Sales"
                                           Value="{Binding TotalSales}"
                                           Icon="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z"
                                           IconColor="Success"
                                           ChangeValue="{Binding SalesChangeValue}"
                                           ChangeText="{Binding SalesChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}"
                                           Margin="0,0,12,0" />
                        <controls:StatCard Label="Net Profit"
                                           Value="{Binding NetProfit}"
                                           Icon="M11 17h2v-6h-2v6zm1-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 9h2V7h-2v2z"
                                           IconColor="Primary"
                                           ChangeValue="{Binding ProfitChangeValue}"
                                           ChangeText="{Binding ProfitChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}"
                                           Margin="0,0,12,0" />
                        <controls:StatCard Label="Profit Margin"
                                           Value="{Binding ProfitMargin}"
                                           Icon="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"
                                           IconColor="Info"
                                           ChangeValue="{Binding ProfitMarginChangeValue}"
                                           ChangeText="{Binding ProfitMarginChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                    </UniformGrid>

                    <!-- Charts Row 1: Profit Analysis -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Profit Trends Chart -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Chart with data -->
                                <lvc:CartesianChart Title="{Binding ProfitOverTimeTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    Series="{Binding ProfitTrendsSeries}"
                                                    XAxes="{Binding ProfitTrendsXAxes}"
                                                    YAxes="{Binding ProfitTrendsYAxes}"
                                                    IsVisible="{Binding HasProfitTrendsData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasProfitTrendsData}">
                                    <TextBlock Text="No profit data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>

                        <!-- Sales vs Expenses Chart -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Chart with data -->
                                <lvc:CartesianChart Title="{Binding SalesVsExpensesTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    Series="{Binding SalesVsExpensesSeries}"
                                                    XAxes="{Binding SalesVsExpensesXAxes}"
                                                    YAxes="{Binding SalesVsExpensesYAxes}"
                                                    IsVisible="{Binding HasSalesVsExpensesData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasSalesVsExpensesData}">
                                    <TextBlock Text="No comparison data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>
                    </Grid>

                    <!-- Charts Row 2: Sales -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Sales Trends Chart -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Chart with data -->
                                <lvc:CartesianChart Title="{Binding SalesTrendsTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    Series="{Binding RevenueTrendsSeries}"
                                                    XAxes="{Binding RevenueTrendsXAxes}"
                                                    YAxes="{Binding RevenueTrendsYAxes}"
                                                    IsVisible="{Binding HasRevenueTrendsData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasRevenueTrendsData}">
                                    <TextBlock Text="No sales data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>

                        <!-- Sales Distribution Chart -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Pie Chart with data -->
                                <lvc:PieChart Title="{Binding SalesDistributionTitle}"
                                              PointerPressed="OnChartPointerPressed"
                                              Series="{Binding RevenueDistributionSeries}"
                                              LegendPosition="Right"
                                              LegendTextPaint="{Binding LegendTextPaint}"
                                              IsVisible="{Binding HasRevenueDistributionData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasRevenueDistributionData}">
                                    <TextBlock Text="No distribution data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>
                    </Grid>

                    <!-- Charts Row 3: Purchases -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Purchase Trends Chart -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Chart with data -->
                                <lvc:CartesianChart Title="{Binding PurchaseTrendsTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    Series="{Binding ExpensesTrendsSeries}"
                                                    XAxes="{Binding ExpensesTrendsXAxes}"
                                                    YAxes="{Binding ExpensesTrendsYAxes}"
                                                    IsVisible="{Binding HasExpensesTrendsData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasExpensesTrendsData}">
                                    <TextBlock Text="No purchase data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>

                        <!-- Purchase Distribution Chart -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Pie Chart with data -->
                                <lvc:PieChart Title="{Binding PurchaseDistributionTitle}"
                                              PointerPressed="OnChartPointerPressed"
                                              Series="{Binding ExpensesDistributionSeries}"
                                              LegendPosition="Right"
                                              LegendTextPaint="{Binding LegendTextPaint}"
                                              IsVisible="{Binding HasExpensesDistributionData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasExpensesDistributionData}">
                                    <TextBlock Text="No distribution data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>
                    </Grid>
                </StackPanel>

                <!-- Geographic Tab Content -->
                <StackPanel Margin="24" Spacing="24"
                            IsVisible="{Binding IsGeographicTabSelected}">
                    <!-- Row 1: Countries/Companies of Origin -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Countries of Origin Chart -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Pie Chart with data -->
                                <lvc:PieChart Title="{Binding CountriesOfOriginTitle}"
                                              PointerPressed="OnChartPointerPressed"
                                              Series="{Binding CountriesOfOriginSeries}"
                                              LegendPosition="Right"
                                              LegendTextPaint="{Binding LegendTextPaint}"
                                              IsVisible="{Binding HasCountriesOfOriginData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasCountriesOfOriginData}">
                                    <TextBlock Text="No country data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>

                        <!-- Companies of Origin Chart -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Pie Chart with data -->
                                <lvc:PieChart Title="{Binding CompaniesOfOriginTitle}"
                                              PointerPressed="OnChartPointerPressed"
                                              Series="{Binding CompaniesOfOriginSeries}"
                                              LegendPosition="Right"
                                              LegendTextPaint="{Binding LegendTextPaint}"
                                              IsVisible="{Binding HasCompaniesOfOriginData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasCompaniesOfOriginData}">
                                    <TextBlock Text="No company data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>
                    </Grid>

                    <!-- Row 2: Countries/Companies of Destination -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Countries of Destination Chart -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Pie Chart with data -->
                                <lvc:PieChart Title="{Binding CountriesOfDestinationTitle}"
                                              PointerPressed="OnChartPointerPressed"
                                              Series="{Binding CountriesOfDestinationSeries}"
                                              LegendPosition="Right"
                                              LegendTextPaint="{Binding LegendTextPaint}"
                                              IsVisible="{Binding HasCountriesOfDestinationData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasCountriesOfDestinationData}">
                                    <TextBlock Text="No destination data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>

                        <!-- Companies of Destination Chart -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Pie Chart with data -->
                                <lvc:PieChart Title="{Binding CompaniesOfDestinationTitle}"
                                              PointerPressed="OnChartPointerPressed"
                                              Series="{Binding CompaniesOfDestinationSeries}"
                                              LegendPosition="Right"
                                              LegendTextPaint="{Binding LegendTextPaint}"
                                              IsVisible="{Binding HasCompaniesOfDestinationData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasCompaniesOfDestinationData}">
                                    <TextBlock Text="No company data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>
                    </Grid>

                    <!-- Row 3: World Map (Full Width) -->
                    <Border Background="{DynamicResource SurfaceBrush}"
                            BorderBrush="{DynamicResource BorderBrush}"
                            BorderThickness="1"
                            CornerRadius="12"
                            Height="550">
                        <Grid RowDefinitions="Auto,*">
                            <Border Grid.Row="0"
                                    Padding="20,16"
                                    BorderBrush="{DynamicResource BorderBrush}"
                                    BorderThickness="0,0,0,1">
                                <Grid ColumnDefinitions="*,Auto">
                                    <TextBlock Grid.Column="0"
                                               Text="World Map Overview"
                                               FontSize="16"
                                               FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               VerticalAlignment="Center" />
                                    <!-- Origin/Destination Toggle -->
                                    <Border Grid.Column="1"
                                            Background="{DynamicResource SurfaceAltBrush}"
                                            CornerRadius="6"
                                            Padding="4">
                                        <StackPanel Orientation="Horizontal" Spacing="4">
                                            <RadioButton Content="Origin"
                                                         GroupName="MapMode"
                                                         IsChecked="{Binding IsMapModeOrigin}"
                                                         Classes="segmented-button" />
                                            <RadioButton Content="Destination"
                                                         GroupName="MapMode"
                                                         IsChecked="{Binding IsMapModeDestination}"
                                                         Classes="segmented-button" />
                                        </StackPanel>
                                    </Border>
                                </Grid>
                            </Border>
                            <Border Grid.Row="1" Padding="10">
                                <Panel>
                                    <lvc:GeoMap Series="{Binding GeoMapSeries}"
                                                MapProjection="Mercator"
                                                IsVisible="{Binding HasWorldMapData}"
                                                PointerPressed="OnChartPointerPressed" />
                                    <Border Background="{DynamicResource SurfaceAltBrush}"
                                            CornerRadius="8"
                                            IsVisible="{Binding !HasWorldMapData}">
                                        <TextBlock Text="No geographic data available"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"
                                                   FontSize="14"
                                                   Foreground="{DynamicResource TextTertiaryBrush}" />
                                    </Border>
                                </Panel>
                            </Border>
                        </Grid>
                    </Border>
                </StackPanel>

                <!-- Operational Tab Content -->
                <StackPanel Margin="24" Spacing="24"
                            IsVisible="{Binding IsOperationalTabSelected}">
                    <!-- Stats Grid -->
                    <UniformGrid Columns="4" Rows="1">
                        <controls:StatCard Label="Active Accountants"
                                           Value="{Binding ActiveAccountants}"
                                           Icon="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
                                           IconColor="Primary"
                                           Margin="0,0,12,0" />
                        <controls:StatCard Label="Transactions Processed"
                                           Value="{Binding TransactionsProcessed}"
                                           Icon="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm7 13H5v-.23c0-.62.28-1.2.76-1.58C7.47 15.82 9.64 15 12 15s4.53.82 6.24 2.19c.48.38.76.97.76 1.58V19z"
                                           IconColor="Success"
                                           ChangeValue="{Binding TransactionsChangeValue}"
                                           ChangeText="{Binding TransactionsChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}"
                                           Margin="0,0,12,0" />
                        <controls:StatCard Label="Avg Processing Time"
                                           Value="{Binding AvgProcessingTime}"
                                           Icon="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"
                                           IconColor="Warning"
                                           ChangeValue="{Binding ProcessingTimeChangeValue}"
                                           ChangeText="{Binding ProcessingTimeChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}"
                                           Margin="0,0,12,0" />
                        <controls:StatCard Label="Accuracy Rate"
                                           Value="{Binding AccuracyRate}"
                                           Icon="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"
                                           IconColor="Info"
                                           ChangeValue="{Binding AccuracyChangeValue}"
                                           ChangeText="{Binding AccuracyChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                    </UniformGrid>

                    <!-- Charts -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Transactions by Accountant -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Pie Chart with data -->
                                <lvc:PieChart Title="{Binding TransactionsByAccountantTitle}"
                                              PointerPressed="OnChartPointerPressed"
                                              Series="{Binding AccountantsTransactionsSeries}"
                                              LegendPosition="Right"
                                              LegendTextPaint="{Binding LegendTextPaint}"
                                              IsVisible="{Binding HasAccountantsTransactionsData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasAccountantsTransactionsData}">
                                    <TextBlock Text="No accountant data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>

                        <!-- Workload Distribution -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Chart with data -->
                                <lvc:CartesianChart Title="{Binding WorkloadDistributionTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    Series="{Binding TotalTransactionsSeries}"
                                                    XAxes="{Binding TotalTransactionsXAxes}"
                                                    YAxes="{Binding TotalTransactionsYAxes}"
                                                    IsVisible="{Binding HasTotalTransactionsData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasTotalTransactionsData}">
                                    <TextBlock Text="No workload data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>
                    </Grid>

                    <!-- Processing Trends -->
                    <Border Background="{DynamicResource SurfaceBrush}"
                            BorderBrush="{DynamicResource BorderBrush}"
                            BorderThickness="1"
                            CornerRadius="12"
                            Padding="10"
                            Height="300">
                        <Panel>
                            <!-- Chart with data -->
                            <lvc:CartesianChart Title="{Binding ProcessingTimeTrendsTitle}"
                                                PointerPressed="OnChartPointerPressed"
                                                Series="{Binding AvgTransactionValueSeries}"
                                                XAxes="{Binding AvgTransactionValueXAxes}"
                                                YAxes="{Binding AvgTransactionValueYAxes}"
                                                IsVisible="{Binding HasAvgTransactionValueData}" />
                            <!-- No data placeholder -->
                            <Border Background="{DynamicResource SurfaceAltBrush}"
                                    CornerRadius="8"
                                    IsVisible="{Binding !HasAvgTransactionValueData}">
                                <TextBlock Text="No processing data available"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"
                                           FontSize="14"
                                           Foreground="{DynamicResource TextTertiaryBrush}" />
                            </Border>
                        </Panel>
                    </Border>
                </StackPanel>

                <!-- Performance Tab Content -->
                <StackPanel Margin="24" Spacing="24"
                            IsVisible="{Binding IsPerformanceTabSelected}">
                    <!-- Stats Grid -->
                    <UniformGrid Columns="4" Rows="1">
                        <controls:StatCard Label="Revenue Growth"
                                           Value="{Binding RevenueGrowth}"
                                           Icon="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"
                                           IconColor="Success"
                                           ChangeValue="{Binding RevenueGrowthChangeValue}"
                                           ChangeText="{Binding RevenueGrowthChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}"
                                           Margin="0,0,12,0" />
                        <controls:StatCard Label="Total Transactions"
                                           Value="{Binding TotalTransactions}"
                                           Icon="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm7 13H5v-.23c0-.62.28-1.2.76-1.58C7.47 15.82 9.64 15 12 15s4.53.82 6.24 2.19c.48.38.76.97.76 1.58V19z"
                                           IconColor="Primary"
                                           ChangeValue="{Binding TotalTransactionsChangeValue}"
                                           ChangeText="{Binding TotalTransactionsChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}"
                                           Margin="0,0,12,0" />
                        <controls:StatCard Label="Avg Transaction Value"
                                           Value="{Binding AvgTransactionValue}"
                                           Icon="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z"
                                           IconColor="Info"
                                           ChangeValue="{Binding AvgTransactionChangeValue}"
                                           ChangeText="{Binding AvgTransactionChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}"
                                           Margin="0,0,12,0" />
                        <controls:StatCard Label="Avg Shipping Cost"
                                           Value="{Binding AvgShippingCost}"
                                           Icon="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm13.5-9l1.96 2.5H17V9.5h2.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"
                                           IconColor="Warning"
                                           ChangeValue="{Binding AvgShippingChangeValue}"
                                           ChangeText="{Binding AvgShippingChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                    </UniformGrid>

                    <!-- Charts Row 1 -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Average Transaction Value -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Chart with data -->
                                <lvc:CartesianChart Title="{Binding AverageTransactionValueTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    Series="{Binding AvgTransactionValueSeries}"
                                                    XAxes="{Binding AvgTransactionValueXAxes}"
                                                    YAxes="{Binding AvgTransactionValueYAxes}"
                                                    IsVisible="{Binding HasAvgTransactionValueData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasAvgTransactionValueData}">
                                    <TextBlock Text="No transaction data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>

                        <!-- Total Transactions Over Time -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Chart with data -->
                                <lvc:CartesianChart Title="{Binding TotalTransactionsTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    Series="{Binding TotalTransactionsSeries}"
                                                    XAxes="{Binding TotalTransactionsXAxes}"
                                                    YAxes="{Binding TotalTransactionsYAxes}"
                                                    IsVisible="{Binding HasTotalTransactionsData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasTotalTransactionsData}">
                                    <TextBlock Text="No transaction data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>
                    </Grid>

                    <!-- Charts Row 2 -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Average Shipping Costs -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Chart with data -->
                                <lvc:CartesianChart Title="{Binding AverageShippingCostsTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    Series="{Binding AvgShippingCostsSeries}"
                                                    XAxes="{Binding AvgShippingCostsXAxes}"
                                                    YAxes="{Binding AvgShippingCostsYAxes}"
                                                    IsVisible="{Binding HasAvgShippingCostsData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasAvgShippingCostsData}">
                                    <TextBlock Text="No shipping data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>

                        <!-- Growth Rates -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Chart with data -->
                                <lvc:CartesianChart Title="{Binding GrowthRatesTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    Series="{Binding GrowthRatesSeries}"
                                                    XAxes="{Binding GrowthRatesXAxes}"
                                                    YAxes="{Binding GrowthRatesYAxes}"
                                                    IsVisible="{Binding HasGrowthRatesData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasGrowthRatesData}">
                                    <TextBlock Text="No growth data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>
                    </Grid>
                </StackPanel>

                <!-- Customers Tab Content -->
                <StackPanel Margin="24" Spacing="24"
                            IsVisible="{Binding IsCustomersTabSelected}">
                    <!-- Stats Grid -->
                    <UniformGrid Columns="4" Rows="1">
                        <controls:StatCard Label="Total Customers"
                                           Value="{Binding TotalCustomers}"
                                           Icon="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"
                                           IconColor="Primary"
                                           ChangeValue="{Binding CustomersChangeValue}"
                                           ChangeText="{Binding CustomersChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}"
                                           Margin="0,0,12,0" />
                        <controls:StatCard Label="New Customers"
                                           Value="{Binding NewCustomers}"
                                           Icon="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
                                           IconColor="Success"
                                           ChangeValue="{Binding NewCustomersChangeValue}"
                                           ChangeText="{Binding NewCustomersChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}"
                                           Margin="0,0,12,0" />
                        <controls:StatCard Label="Retention Rate"
                                           Value="{Binding RetentionRate}"
                                           Icon="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
                                           IconColor="Info"
                                           ChangeValue="{Binding RetentionChangeValue}"
                                           ChangeText="{Binding RetentionChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}"
                                           Margin="0,0,12,0" />
                        <controls:StatCard Label="Avg Customer Value"
                                           Value="{Binding AvgCustomerValue}"
                                           Icon="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z"
                                           IconColor="Warning"
                                           ChangeValue="{Binding AvgCustomerValueChangeValue}"
                                           ChangeText="{Binding AvgCustomerValueChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                    </UniformGrid>

                    <!-- Charts Row 1 -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Top Customers by Revenue -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Pie Chart - using Companies of Origin for top customers -->
                                <lvc:PieChart Title="{Binding TopCustomersByRevenueTitle}"
                                              PointerPressed="OnChartPointerPressed"
                                              Series="{Binding CompaniesOfOriginSeries}"
                                              LegendPosition="Right"
                                              LegendTextPaint="{Binding LegendTextPaint}"
                                              IsVisible="{Binding HasCompaniesOfOriginData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasCompaniesOfOriginData}">
                                    <TextBlock Text="No customer data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>

                        <!-- Customer Payment Status -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <lvc:PieChart Title="{Binding CustomerPaymentStatusTitle}"
                                              PointerPressed="OnChartPointerPressed"
                                              Series="{Binding CustomerPaymentStatusSeries}"
                                              LegendPosition="Right"
                                              LegendTextPaint="{Binding LegendTextPaint}"
                                              IsVisible="{Binding HasCustomerPaymentStatusData}" />
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasCustomerPaymentStatusData}">
                                    <TextBlock Text="No payment data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>
                    </Grid>

                    <!-- Charts Row 2 -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Customer Growth -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Chart - using Growth Rates -->
                                <lvc:CartesianChart Title="{Binding CustomerGrowthTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    Series="{Binding GrowthRatesSeries}"
                                                    XAxes="{Binding GrowthRatesXAxes}"
                                                    YAxes="{Binding GrowthRatesYAxes}"
                                                    IsVisible="{Binding HasGrowthRatesData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasGrowthRatesData}">
                                    <TextBlock Text="No growth data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>

                        <!-- Customer Lifetime Value -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Chart - using Avg Transaction Value -->
                                <lvc:CartesianChart Title="{Binding CustomerLifetimeValueTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    Series="{Binding AvgTransactionValueSeries}"
                                                    XAxes="{Binding AvgTransactionValueXAxes}"
                                                    YAxes="{Binding AvgTransactionValueYAxes}"
                                                    IsVisible="{Binding HasAvgTransactionValueData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasAvgTransactionValueData}">
                                    <TextBlock Text="No value data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>
                    </Grid>

                    <!-- Charts Row 3 -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Active vs Inactive Customers -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <lvc:PieChart Title="{Binding ActiveVsInactiveCustomersTitle}"
                                              PointerPressed="OnChartPointerPressed"
                                              Series="{Binding ActiveInactiveCustomersSeries}"
                                              LegendPosition="Right"
                                              LegendTextPaint="{Binding LegendTextPaint}"
                                              IsVisible="{Binding HasActiveInactiveCustomersData}" />
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasActiveInactiveCustomersData}">
                                    <TextBlock Text="No customer activity data"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>

                        <!-- Rentals per Customer -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Chart - using Total Transactions -->
                                <lvc:CartesianChart Title="{Binding RentalsPerCustomerTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    Series="{Binding TotalTransactionsSeries}"
                                                    XAxes="{Binding TotalTransactionsXAxes}"
                                                    YAxes="{Binding TotalTransactionsYAxes}"
                                                    IsVisible="{Binding HasTotalTransactionsData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasTotalTransactionsData}">
                                    <TextBlock Text="No rental data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>
                    </Grid>
                </StackPanel>

                <!-- Returns Tab Content -->
                <StackPanel Margin="24" Spacing="24"
                            IsVisible="{Binding IsReturnsTabSelected}">
                    <!-- Stats Grid -->
                    <UniformGrid Columns="4" Rows="1">
                        <controls:StatCard Label="Total Returns"
                                           Value="{Binding TotalReturns}"
                                           Icon="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"
                                           IconColor="Warning"
                                           ChangeValue="{Binding ReturnsChangeValue}"
                                           ChangeText="{Binding ReturnsChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}"
                                           Margin="0,0,12,0" />
                        <controls:StatCard Label="Return Rate"
                                           Value="{Binding ReturnRate}"
                                           Icon="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"
                                           IconColor="Info"
                                           ChangeValue="{Binding ReturnRateChangeValue}"
                                           ChangeText="{Binding ReturnRateChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}"
                                           Margin="0,0,12,0" />
                        <controls:StatCard Label="Financial Impact"
                                           Value="{Binding ReturnsFinancialImpact}"
                                           Icon="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z"
                                           IconColor="Danger"
                                           ChangeValue="{Binding ReturnsImpactChangeValue}"
                                           ChangeText="{Binding ReturnsImpactChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}"
                                           Margin="0,0,12,0" />
                        <controls:StatCard Label="Avg Resolution Time"
                                           Value="{Binding AvgResolutionTime}"
                                           Icon="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"
                                           IconColor="Success"
                                           ChangeValue="{Binding ResolutionTimeChangeValue}"
                                           ChangeText="{Binding ResolutionTimeChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                    </UniformGrid>

                    <!-- Charts Row 1 -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Returns Over Time -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Chart with data -->
                                <lvc:CartesianChart Title="{Binding ReturnsOverTimeTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    Series="{Binding ReturnsOverTimeSeries}"
                                                    XAxes="{Binding ReturnsOverTimeXAxes}"
                                                    YAxes="{Binding ReturnsOverTimeYAxes}"
                                                    IsVisible="{Binding HasReturnsOverTimeData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasReturnsOverTimeData}">
                                    <TextBlock Text="No returns data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>

                        <!-- Return Reasons -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Pie Chart with data -->
                                <lvc:PieChart Title="{Binding ReturnReasonsTitle}"
                                              PointerPressed="OnChartPointerPressed"
                                              Series="{Binding ReturnReasonsSeries}"
                                              LegendPosition="Right"
                                              LegendTextPaint="{Binding LegendTextPaint}"
                                              IsVisible="{Binding HasReturnReasonsData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasReturnReasonsData}">
                                    <TextBlock Text="No return reasons data"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>
                    </Grid>

                    <!-- Charts Row 2 -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Financial Impact of Returns -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Chart with data -->
                                <lvc:CartesianChart Title="{Binding FinancialImpactOfReturnsTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    Series="{Binding ReturnFinancialImpactSeries}"
                                                    XAxes="{Binding ReturnFinancialImpactXAxes}"
                                                    YAxes="{Binding ReturnFinancialImpactYAxes}"
                                                    IsVisible="{Binding HasReturnFinancialImpactData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasReturnFinancialImpactData}">
                                    <TextBlock Text="No financial impact data"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>

                        <!-- Returns by Category -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Pie Chart - reusing Return Reasons -->
                                <lvc:PieChart Title="{Binding ReturnsByCategoryTitle}"
                                              PointerPressed="OnChartPointerPressed"
                                              Series="{Binding ReturnReasonsSeries}"
                                              LegendPosition="Right"
                                              LegendTextPaint="{Binding LegendTextPaint}"
                                              IsVisible="{Binding HasReturnReasonsData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasReturnReasonsData}">
                                    <TextBlock Text="No category data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>
                    </Grid>

                    <!-- Charts Row 3 -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Returns by Product -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Pie Chart - reusing Expense Distribution -->
                                <lvc:PieChart Title="{Binding ReturnsByProductTitle}"
                                              PointerPressed="OnChartPointerPressed"
                                              Series="{Binding ExpensesDistributionSeries}"
                                              LegendPosition="Right"
                                              LegendTextPaint="{Binding LegendTextPaint}"
                                              IsVisible="{Binding HasExpensesDistributionData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasExpensesDistributionData}">
                                    <TextBlock Text="No product data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>

                        <!-- Purchase vs Sale Returns -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Chart - using Sales vs Expenses -->
                                <lvc:CartesianChart Title="{Binding PurchaseVsSaleReturnsTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    Series="{Binding SalesVsExpensesSeries}"
                                                    XAxes="{Binding SalesVsExpensesXAxes}"
                                                    YAxes="{Binding SalesVsExpensesYAxes}"
                                                    IsVisible="{Binding HasSalesVsExpensesData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasSalesVsExpensesData}">
                                    <TextBlock Text="No comparison data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>
                    </Grid>
                </StackPanel>

                <!-- Losses Tab Content -->
                <StackPanel Margin="24" Spacing="24"
                            IsVisible="{Binding IsLossesTabSelected}">
                    <!-- Stats Grid -->
                    <UniformGrid Columns="4" Rows="1">
                        <controls:StatCard Label="Total Losses"
                                           Value="{Binding TotalLosses}"
                                           Icon="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"
                                           IconColor="Danger"
                                           ChangeValue="{Binding LossesChangeValue}"
                                           ChangeText="{Binding LossesChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}"
                                           Margin="0,0,12,0" />
                        <controls:StatCard Label="Loss Rate"
                                           Value="{Binding LossRate}"
                                           Icon="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"
                                           IconColor="Info"
                                           ChangeValue="{Binding LossRateChangeValue}"
                                           ChangeText="{Binding LossRateChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}"
                                           Margin="0,0,12,0" />
                        <controls:StatCard Label="Financial Impact"
                                           Value="{Binding LossesFinancialImpact}"
                                           Icon="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z"
                                           IconColor="Warning"
                                           ChangeValue="{Binding LossesImpactChangeValue}"
                                           ChangeText="{Binding LossesImpactChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}"
                                           Margin="0,0,12,0" />
                        <controls:StatCard Label="Insurance Claims"
                                           Value="{Binding InsuranceClaims}"
                                           Icon="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 16l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"
                                           IconColor="Success"
                                           ChangeValue="{Binding InsuranceClaimsChangeValue}"
                                           ChangeText="{Binding InsuranceClaimsChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                    </UniformGrid>

                    <!-- Charts Row 1 -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Losses Over Time -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Chart with data -->
                                <lvc:CartesianChart Title="{Binding LossesOverTimeTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    Series="{Binding LossesOverTimeSeries}"
                                                    XAxes="{Binding LossesOverTimeXAxes}"
                                                    YAxes="{Binding LossesOverTimeYAxes}"
                                                    IsVisible="{Binding HasLossesOverTimeData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasLossesOverTimeData}">
                                    <TextBlock Text="No losses data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>

                        <!-- Loss Reasons -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Pie Chart - Loss Reasons -->
                                <lvc:PieChart Title="{Binding LossReasonsTitle}"
                                              PointerPressed="OnChartPointerPressed"
                                              Series="{Binding LossReasonsSeries}"
                                              LegendPosition="Right"
                                              LegendTextPaint="{Binding LegendTextPaint}"
                                              IsVisible="{Binding HasLossReasonsData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasLossReasonsData}">
                                    <TextBlock Text="No loss reasons data"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>
                    </Grid>

                    <!-- Charts Row 2 -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Financial Impact of Losses -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Chart with data -->
                                <lvc:CartesianChart Title="{Binding FinancialImpactOfLossesTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    Series="{Binding LossFinancialImpactSeries}"
                                                    XAxes="{Binding LossFinancialImpactXAxes}"
                                                    YAxes="{Binding LossFinancialImpactYAxes}"
                                                    IsVisible="{Binding HasLossFinancialImpactData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasLossFinancialImpactData}">
                                    <TextBlock Text="No financial impact data"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>

                        <!-- Losses by Category -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Pie Chart - reusing Expense Distribution -->
                                <lvc:PieChart Title="{Binding LossesByCategoryTitle}"
                                              PointerPressed="OnChartPointerPressed"
                                              Series="{Binding ExpensesDistributionSeries}"
                                              LegendPosition="Right"
                                              LegendTextPaint="{Binding LegendTextPaint}"
                                              IsVisible="{Binding HasExpensesDistributionData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasExpensesDistributionData}">
                                    <TextBlock Text="No category data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>
                    </Grid>

                    <!-- Charts Row 3 -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Losses by Product -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Pie Chart - Losses by Product -->
                                <lvc:PieChart Title="{Binding LossesByProductTitle}"
                                              PointerPressed="OnChartPointerPressed"
                                              Series="{Binding LossesByProductSeries}"
                                              LegendPosition="Right"
                                              LegendTextPaint="{Binding LegendTextPaint}"
                                              IsVisible="{Binding HasLossesByProductData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasLossesByProductData}">
                                    <TextBlock Text="No product data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>

                        <!-- Purchase vs Sale Losses -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Chart - using Sales vs Expenses -->
                                <lvc:CartesianChart Title="{Binding PurchaseVsSaleLossesTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    Series="{Binding SalesVsExpensesSeries}"
                                                    XAxes="{Binding SalesVsExpensesXAxes}"
                                                    YAxes="{Binding SalesVsExpensesYAxes}"
                                                    IsVisible="{Binding HasSalesVsExpensesData}" />
                                <!-- No data placeholder -->
                                <Border Background="{DynamicResource SurfaceAltBrush}"
                                        CornerRadius="8"
                                        IsVisible="{Binding !HasSalesVsExpensesData}">
                                    <TextBlock Text="No comparison data available"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}" />
                                </Border>
                            </Panel>
                        </Border>
                    </Grid>
                </StackPanel>
            </Panel>
        </ScrollViewer>
    </Grid>

    <!-- Customer Activity Info Modal -->
    <Border Background="#80000000"
            IsVisible="{Binding IsCustomerActivityInfoOpen}"
            IsHitTestVisible="True"
            PointerPressed="CustomerActivityInfoBackdrop_PointerPressed">
        <Border Background="{DynamicResource SurfaceBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="12"
                Width="450"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                BoxShadow="0 8 32 0 #40000000"
                PointerPressed="CustomerActivityInfoModal_PointerPressed">
            <Grid RowDefinitions="Auto,*,Auto">
                <!-- Header -->
                <Border Grid.Row="0"
                        Padding="24,20"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="0,0,0,1">
                    <Grid ColumnDefinitions="*,Auto">
                        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12">
                            <PathIcon Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"
                                      Width="24" Height="24"
                                      Foreground="{DynamicResource PrimaryBrush}" />
                            <TextBlock Text="Customer Activity"
                                       FontSize="18"
                                       FontWeight="SemiBold"
                                       VerticalAlignment="Center"
                                       Foreground="{DynamicResource TextPrimaryBrush}" />
                        </StackPanel>
                        <Button Grid.Column="1"
                                Classes="info-button"
                                Command="{Binding CloseCustomerActivityInfoCommand}">
                            <PathIcon Data="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
                                      Width="18" Height="18" />
                        </Button>
                    </Grid>
                </Border>

                <!-- Body -->
                <Border Grid.Row="1" Padding="24,20">
                    <StackPanel Spacing="16">
                        <TextBlock Text="How is customer activity determined?"
                                   FontSize="15"
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextPrimaryBrush}" />

                        <TextBlock TextWrapping="Wrap"
                                   FontSize="14"
                                   LineHeight="22"
                                   Foreground="{DynamicResource TextSecondaryBrush}">
                            <Run Text="A customer is considered active if they have made at least one purchase within the selected date range." />
                        </TextBlock>

                        <TextBlock TextWrapping="Wrap"
                                   FontSize="14"
                                   LineHeight="22"
                                   Foreground="{DynamicResource TextSecondaryBrush}">
                            <Run Text="Customers with no purchases in this period are marked as inactive." />
                        </TextBlock>

                        <Border Background="{DynamicResource SurfaceAltBrush}"
                                CornerRadius="8"
                                Padding="16"
                                Margin="0,8,0,0">
                            <StackPanel Spacing="8">
                                <TextBlock Text="Tip"
                                           FontSize="13"
                                           FontWeight="SemiBold"
                                           Foreground="{DynamicResource PrimaryBrush}" />
                                <TextBlock Text="Change the date range at the top of the page to see customer activity over different time periods. For example, select 'All Time' to see lifetime activity."
                                           TextWrapping="Wrap"
                                           FontSize="13"
                                           LineHeight="20"
                                           Foreground="{DynamicResource TextSecondaryBrush}" />
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Border>

                <!-- Footer -->
                <Border Grid.Row="2"
                        Padding="24,16"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="0,1,0,0">
                    <Button Classes="primary-button"
                            Content="Got it"
                            HorizontalAlignment="Right"
                            Command="{Binding CloseCustomerActivityInfoCommand}" />
                </Border>
            </Grid>
        </Border>
    </Border>

    <!-- Global Chart Context Menu (rendered on top of everything) -->
    <controls:ChartContextMenu x:Name="ChartContextMenu"
                               IsOpen="{Binding IsChartContextMenuOpen}"
                               MenuX="{Binding ChartContextMenuX}"
                               MenuY="{Binding ChartContextMenuY}"
                               ShowResetZoom="{Binding ShowChartResetZoom}"
                               ShowExportOptions="{Binding ShowChartExportOptions}"
                               SaveChartAsImageCommand="{Binding SaveChartAsImageCommand}"
                               ExportToGoogleSheetsCommand="{Binding ExportToGoogleSheetsCommand}"
                               ExportToExcelCommand="{Binding ExportToExcelCommand}"
                               ResetChartZoomCommand="{Binding ResetChartZoomCommand}"
                               CloseCommand="{Binding HideChartContextMenuCommand}" />

    <!-- Custom Date Range Modal -->
    <controls:ModalOverlay IsOpen="{Binding IsCustomDateRangeModalOpen}"
                           CloseOnBackdropClick="False"
                           CloseOnEscape="True">
        <Border Background="{DynamicResource SurfaceBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="12"
                Width="360"
                BoxShadow="0 8 32 0 #40000000"
                Padding="0">
            <Grid RowDefinitions="Auto,*,Auto">
                <!-- Header -->
                <Border Grid.Row="0"
                        Padding="24,20"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="0,0,0,1">
                    <TextBlock Text="Select Date Range"
                               FontSize="18"
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource TextPrimaryBrush}" />
                </Border>

                <!-- Body -->
                <StackPanel Grid.Row="1" Spacing="16" Margin="24,20">
                    <!-- Start Date -->
                    <StackPanel Spacing="6">
                        <TextBlock Text="Start Date"
                                   FontSize="13"
                                   FontWeight="Medium"
                                   Foreground="{DynamicResource TextSecondaryBrush}" />
                        <DatePicker SelectedDate="{Binding ModalStartDateOffset}"
                                    HorizontalAlignment="Stretch" />
                    </StackPanel>

                    <!-- End Date -->
                    <StackPanel Spacing="6">
                        <TextBlock Text="End Date"
                                   FontSize="13"
                                   FontWeight="Medium"
                                   Foreground="{DynamicResource TextSecondaryBrush}" />
                        <DatePicker SelectedDate="{Binding ModalEndDateOffset}"
                                    HorizontalAlignment="Stretch" />
                    </StackPanel>
                </StackPanel>

                <!-- Footer -->
                <Border Grid.Row="2"
                        Padding="24,16"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="0,1,0,0">
                    <StackPanel Orientation="Horizontal"
                                HorizontalAlignment="Right"
                                Spacing="12">
                        <Button Classes="secondary-button"
                                Content="Cancel"
                                Command="{Binding CancelCustomDateRangeCommand}" />
                        <Button Classes="primary-button"
                                Content="Apply"
                                Command="{Binding ApplyCustomDateRangeCommand}" />
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </controls:ModalOverlay>
    </Panel>

    <UserControl.Styles>
        <!-- TabControl - page tabs styling -->
        <Style Selector="TabControl.page-tabs">
            <Setter Property="Background" Value="Transparent" />
        </Style>
        <Style Selector="TabControl.page-tabs /template/ ItemsPresenter#PART_ItemsPresenter">
            <Setter Property="Margin" Value="24,0" />
        </Style>
        <Style Selector="TabControl.page-tabs /template/ Border#PART_InnerBorder">
            <Setter Property="BorderThickness" Value="0" />
        </Style>
        <Style Selector="TabControl.page-tabs /template/ ContentPresenter#PART_SelectedContentHost">
            <Setter Property="IsVisible" Value="False" />
        </Style>

        <!-- Tab Item Styling -->
        <Style Selector="TabControl.page-tabs TabItem">
            <Setter Property="FontSize" Value="14" />
            <Setter Property="FontWeight" Value="Medium" />
            <Setter Property="Padding" Value="4,12,4,10" />
            <Setter Property="Margin" Value="8,0" />
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>
        <Style Selector="TabControl.page-tabs TabItem:pointerover">
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
        </Style>
        <Style Selector="TabControl.page-tabs TabItem:pointerover /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="TextBlock.Foreground" Value="{DynamicResource TextPrimaryBrush}" />
        </Style>
        <Style Selector="TabControl.page-tabs TabItem:selected">
            <Setter Property="Foreground" Value="{DynamicResource PrimaryBrush}" />
        </Style>
        <Style Selector="TabControl.page-tabs TabItem:selected /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="TextBlock.Foreground" Value="{DynamicResource PrimaryBrush}" />
        </Style>
        <Style Selector="TabControl.page-tabs TabItem:selected /template/ Border#PART_SelectedPipe">
            <Setter Property="IsVisible" Value="True" />
            <Setter Property="Background" Value="{DynamicResource PrimaryBrush}" />
            <Setter Property="Height" Value="2" />
            <Setter Property="VerticalAlignment" Value="Bottom" />
            <Setter Property="Margin" Value="0,0,0,0" />
            <Setter Property="CornerRadius" Value="1" />
        </Style>

        <!-- Form ComboBox -->
        <Style Selector="ComboBox.form-combobox">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Padding" Value="12,8" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="HorizontalAlignment" Value="Stretch" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>

        <!-- Chart Toggle Switch -->
        <Style Selector="ToggleSwitch.chart-toggle">
            <Setter Property="Width" Value="44" />
            <Setter Property="Height" Value="24" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="ClipToBounds" Value="False" />
        </Style>
        <Style Selector="ToggleSwitch.chart-toggle /template/ Grid">
            <Setter Property="ClipToBounds" Value="False" />
        </Style>
        <Style Selector="ToggleSwitch.chart-toggle /template/ Border#SwitchKnobBounds">
            <Setter Property="Background" Value="{DynamicResource SurfaceAltBrush}" />
            <Setter Property="CornerRadius" Value="12" />
        </Style>
        <Style Selector="ToggleSwitch.chart-toggle:checked /template/ Border#SwitchKnobBounds">
            <Setter Property="Background" Value="{DynamicResource PrimaryBrush}" />
        </Style>

        <!-- Segmented Button (RadioButton) -->
        <Style Selector="RadioButton.segmented-button">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}" />
            <Setter Property="Padding" Value="12,6" />
            <Setter Property="CornerRadius" Value="4" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="FontWeight" Value="Medium" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <ControlTemplate>
                    <Border Background="{TemplateBinding Background}"
                            CornerRadius="{TemplateBinding CornerRadius}"
                            Padding="{TemplateBinding Padding}">
                        <ContentPresenter Content="{TemplateBinding Content}"
                                          HorizontalAlignment="Center"
                                          VerticalAlignment="Center" />
                    </Border>
                </ControlTemplate>
            </Setter>
        </Style>
        <Style Selector="RadioButton.segmented-button:pointerover">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
        </Style>
        <Style Selector="RadioButton.segmented-button:checked">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
            <Setter Property="Foreground" Value="{DynamicResource PrimaryBrush}" />
        </Style>

        <!-- Info Button -->
        <Style Selector="Button.info-button">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="6" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>
        <Style Selector="Button.info-button /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="Transparent" />
        </Style>
        <Style Selector="Button.info-button:pointerover /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource SurfaceAltBrush}" />
        </Style>
        <Style Selector="Button.info-button PathIcon">
            <Setter Property="Foreground" Value="{DynamicResource TextTertiaryBrush}" />
        </Style>
        <Style Selector="Button.info-button:pointerover PathIcon">
            <Setter Property="Foreground" Value="{DynamicResource PrimaryBrush}" />
        </Style>
    </UserControl.Styles>
</UserControl>
