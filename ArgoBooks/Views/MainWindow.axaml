<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:ArgoBooks.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:controls="using:ArgoBooks.Controls"
        xmlns:modals="using:ArgoBooks.Modals"
        xmlns:views="using:ArgoBooks.Views"
        xmlns:loc="using:ArgoBooks.Localization"
        mc:Ignorable="d" d:DesignWidth="1280" d:DesignHeight="800"
        x:Class="ArgoBooks.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="{Binding WindowTitle}"
        Icon="/Assets/argo-logo.ico"
        MinWidth="1024"
        MinHeight="680"
        Width="{Binding WindowWidth, Mode=TwoWay}"
        Height="{Binding WindowHeight, Mode=TwoWay}"
        WindowState="{Binding WindowState, Mode=TwoWay}"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource BackgroundBrush}"
        TransparencyLevelHint="AcrylicBlur"
        ExtendClientAreaToDecorationsHint="True"
        ExtendClientAreaChromeHints="PreferSystemChrome"
        ExtendClientAreaTitleBarHeightHint="40"
        SystemDecorations="Full">

    <Design.DataContext>
        <vm:MainWindowViewModel />
    </Design.DataContext>

    <Panel>
        <!-- Modal Overlay (behind content but available for modals) -->
        <controls:ModalOverlay x:Name="ModalOverlay"
                               ZIndex="100" />

        <!-- Main Application Shell -->
        <DockPanel>
            <!-- Custom Title Bar (for platforms supporting client area extension) -->
            <Border DockPanel.Dock="Top"
                    Height="40"
                    Background="Transparent"
                    IsHitTestVisible="True"
                    x:Name="TitleBar">
                <Grid ColumnDefinitions="Auto,*,Auto">
                    <!-- App Icon and Name -->
                    <StackPanel Grid.Column="0"
                                Orientation="Horizontal"
                                Spacing="8"
                                Margin="12,0,0,0"
                                VerticalAlignment="Center"
                                IsHitTestVisible="False">
                        <Image Source="/Assets/argo-logo.ico"
                               Width="20" Height="20"
                               VerticalAlignment="Center" />
                        <TextBlock Text="{loc:Loc 'Argo Books'}"
                                   FontSize="{StaticResource FontSizeSm}"
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                   VerticalAlignment="Center" />
                        <!-- Separator and Company Name -->
                        <TextBlock Text="-"
                                   FontSize="{StaticResource FontSizeSm}"
                                   Foreground="{DynamicResource TextTertiaryBrush}"
                                   VerticalAlignment="Center"
                                   IsVisible="{Binding HasCompanyOpen}" />
                        <TextBlock Text="{Binding CurrentCompanyName}"
                                   FontSize="{StaticResource FontSizeSm}"
                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                   VerticalAlignment="Center"
                                   IsVisible="{Binding HasCompanyOpen}" />
                    </StackPanel>

                    <!-- Drag Region (center) -->
                    <Border Grid.Column="1"
                            Background="Transparent"
                            x:Name="DragRegion" />

                    <!-- Window Controls placeholder - handled by system on most platforms -->
                    <StackPanel Grid.Column="2"
                                Orientation="Horizontal"
                                Margin="0,0,8,0"
                                IsVisible="False"
                                x:Name="WindowControls">
                        <!-- Custom window controls if needed -->
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Main Content Area -->
            <ContentControl x:Name="MainContent" Content="{Binding CurrentView}" />
        </DockPanel>

        <!-- Welcome Screen (full-screen overlay when no company is open) -->
        <views:WelcomeScreen DataContext="{Binding WelcomeScreenViewModel}"
                             IsVisible="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).ShowWelcomeScreen}"
                             ZIndex="150" />

        <!-- Password Prompt Modal (above WelcomeScreen so it can be shown when opening encrypted files) -->
        <modals:PasswordPromptModal DataContext="{Binding PasswordPromptModalViewModel}"
                                    ZIndex="175" />

        <!-- Create Company Wizard (full-screen overlay above everything) -->
        <modals:CreateCompanyWizard DataContext="{Binding CreateCompanyViewModel}"
                                    ZIndex="200" />

        <!-- Loading Overlay (shows during long operations like import) -->
        <Border IsVisible="{Binding IsLoading}"
                Background="#80000000"
                ZIndex="225"
                IsHitTestVisible="True">
            <Border Background="{DynamicResource SurfaceBrush}"
                    CornerRadius="12"
                    Padding="32,24"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    BoxShadow="0 8 32 0 #40000000">
                <StackPanel Spacing="16" HorizontalAlignment="Center">
                    <ProgressBar IsIndeterminate="True"
                                 Width="120"
                                 Height="4"
                                 Foreground="{DynamicResource PrimaryBrush}" />
                    <TextBlock Text="{Binding LoadingMessage}"
                               FontSize="{StaticResource FontSizeMd}"
                               Foreground="{DynamicResource TextSecondaryBrush}"
                               HorizontalAlignment="Center" />
                </StackPanel>
            </Border>
        </Border>

        <!-- Receipt Viewer Modal -->
        <modals:ReceiptViewerModal DataContext="{Binding ReceiptViewerModalViewModel}"
                                   ZIndex="200" />

        <!-- Confirmation Dialog (high level, can appear over any modal) -->
        <modals:ConfirmationDialog DataContext="{Binding ConfirmationDialogViewModel}"
                                   ZIndex="250" />

        <!-- Unsaved Changes Dialog (highest level, critical for data safety) -->
        <modals:UnsavedChangesDialog DataContext="{Binding UnsavedChangesDialogViewModel}"
                                     ZIndex="275" />
    </Panel>
</Window>
