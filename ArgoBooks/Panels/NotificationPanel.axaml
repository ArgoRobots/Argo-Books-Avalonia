<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:ArgoBooks.ViewModels"
             mc:Ignorable="d" d:DesignWidth="360" d:DesignHeight="500"
             x:Class="ArgoBooks.Panels.NotificationPanel"
             x:DataType="vm:NotificationPanelViewModel">

    <Design.DataContext>
        <vm:NotificationPanelViewModel />
    </Design.DataContext>

    <Panel IsVisible="{Binding IsOpen}">
        <!-- Transparent backdrop for click-away -->
        <Border Background="Transparent"
                PointerPressed="Backdrop_PointerPressed" />

        <!-- Notification Panel Container with animation -->
        <Border x:Name="NotificationBorder"
                Background="{DynamicResource SurfaceBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Width="360"
                MaxHeight="480"
                HorizontalAlignment="Right"
                VerticalAlignment="Top"
                Margin="0,60,20,0"
                BoxShadow="0 4 16 0 #30000000"
                Opacity="0"
                RenderTransformOrigin="1,0">
            <Border.RenderTransform>
                <TranslateTransform Y="-8" />
            </Border.RenderTransform>
            <Border.Transitions>
                <Transitions>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.15" Easing="CubicEaseOut" />
                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.15" Easing="CubicEaseOut" />
                </Transitions>
            </Border.Transitions>
            <Grid RowDefinitions="Auto,*,Auto">
                <!-- Header -->
                <Border Grid.Row="0"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="0,0,0,1"
                        Padding="16,12">
                    <Grid ColumnDefinitions="*,Auto">
                        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="Notifications"
                                       FontSize="16"
                                       FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextPrimaryBrush}"
                                       VerticalAlignment="Center" />
                            <Border Background="{DynamicResource PrimaryBrush}"
                                    CornerRadius="10"
                                    Padding="8,2"
                                    IsVisible="{Binding HasUnreadNotifications}"
                                    VerticalAlignment="Center">
                                <TextBlock Text="{Binding UnreadCount}"
                                           FontSize="11"
                                           FontWeight="SemiBold"
                                           Foreground="White" />
                            </Border>
                        </StackPanel>
                        <Button Grid.Column="1"
                                Classes="text-button"
                                Content="Mark all read"
                                Command="{Binding MarkAllAsReadCommand}"
                                IsVisible="{Binding HasUnreadNotifications}" />
                    </Grid>
                </Border>

                <!-- Notification List -->
                <ScrollViewer Grid.Row="1"
                              VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled">
                    <Panel>
                        <!-- Empty State -->
                        <StackPanel IsVisible="{Binding !HasNotifications}"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Margin="0,60">
                            <PathIcon Data="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"
                                      Width="48" Height="48"
                                      Foreground="{DynamicResource TextTertiaryBrush}"
                                      HorizontalAlignment="Center"
                                      Margin="0,0,0,12" />
                            <TextBlock Text="No notifications"
                                       FontSize="14"
                                       Foreground="{DynamicResource TextTertiaryBrush}"
                                       HorizontalAlignment="Center" />
                            <TextBlock Text="You're all caught up!"
                                       FontSize="12"
                                       Foreground="{DynamicResource TextTertiaryBrush}"
                                       HorizontalAlignment="Center"
                                       Margin="0,4,0,0" />
                        </StackPanel>

                        <!-- Notifications List -->
                        <ItemsControl ItemsSource="{Binding Notifications}"
                                      IsVisible="{Binding HasNotifications}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="vm:NotificationItem">
                                    <Button Classes="notification-item"
                                            Classes.unread="{Binding !IsRead}"
                                            Command="{Binding $parent[UserControl].((vm:NotificationPanelViewModel)DataContext).NotificationClickedCommand}"
                                            CommandParameter="{Binding}">
                                        <Grid ColumnDefinitions="Auto,*,Auto">
                                            <!-- Type Indicator -->
                                            <Border Grid.Column="0"
                                                    Width="36" Height="36"
                                                    CornerRadius="18"
                                                    Margin="0,0,12,0"
                                                    VerticalAlignment="Top">
                                                <Border.Styles>
                                                    <Style Selector="Border">
                                                        <Setter Property="Background" Value="{DynamicResource SurfaceAltBrush}" />
                                                    </Style>
                                                </Border.Styles>
                                                <Panel>
                                                    <!-- Info Icon -->
                                                    <PathIcon Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"
                                                              Width="18" Height="18"
                                                              Foreground="{DynamicResource PrimaryBrush}"
                                                              IsVisible="{Binding Type, Converter={x:Static vm:NotificationTypeConverters.IsInfo}}" />
                                                    <!-- Success Icon -->
                                                    <PathIcon Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
                                                              Width="18" Height="18"
                                                              Foreground="{DynamicResource SuccessBrush}"
                                                              IsVisible="{Binding Type, Converter={x:Static vm:NotificationTypeConverters.IsSuccess}}" />
                                                    <!-- Warning Icon -->
                                                    <PathIcon Data="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"
                                                              Width="18" Height="18"
                                                              Foreground="{DynamicResource WarningBrush}"
                                                              IsVisible="{Binding Type, Converter={x:Static vm:NotificationTypeConverters.IsWarning}}" />
                                                    <!-- Error Icon -->
                                                    <PathIcon Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"
                                                              Width="18" Height="18"
                                                              Foreground="{DynamicResource DangerBrush}"
                                                              IsVisible="{Binding Type, Converter={x:Static vm:NotificationTypeConverters.IsError}}" />
                                                    <!-- System Icon -->
                                                    <PathIcon Data="M19.14 12.94c.04-.31.06-.63.06-.94s-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"
                                                              Width="18" Height="18"
                                                              Foreground="{DynamicResource TextSecondaryBrush}"
                                                              IsVisible="{Binding Type, Converter={x:Static vm:NotificationTypeConverters.IsSystem}}" />
                                                </Panel>
                                            </Border>

                                            <!-- Content -->
                                            <StackPanel Grid.Column="1" Spacing="2" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding Title}"
                                                           FontSize="13"
                                                           FontWeight="{Binding IsRead, Converter={x:Static vm:NotificationTypeConverters.ReadToFontWeight}}"
                                                           Foreground="{DynamicResource TextPrimaryBrush}"
                                                           TextTrimming="CharacterEllipsis" />
                                                <TextBlock Text="{Binding Message}"
                                                           FontSize="12"
                                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                                           TextTrimming="CharacterEllipsis"
                                                           TextWrapping="Wrap"
                                                           MaxLines="2" />
                                                <TextBlock Text="{Binding Timestamp, Converter={x:Static vm:NotificationTypeConverters.RelativeTime}}"
                                                           FontSize="11"
                                                           Foreground="{DynamicResource TextTertiaryBrush}"
                                                           Margin="0,2,0,0" />
                                            </StackPanel>

                                            <!-- Dismiss Button -->
                                            <Button Grid.Column="2"
                                                    Classes="icon-button-small"
                                                    Command="{Binding $parent[UserControl].((vm:NotificationPanelViewModel)DataContext).RemoveNotificationCommand}"
                                                    CommandParameter="{Binding}"
                                                    ToolTip.Tip="Dismiss"
                                                    VerticalAlignment="Top"
                                                    Margin="8,0,0,0">
                                                <PathIcon Data="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
                                                          Width="14" Height="14" />
                                            </Button>
                                        </Grid>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </Panel>
                </ScrollViewer>

                <!-- Footer -->
                <Border Grid.Row="2"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="0,1,0,0"
                        Padding="12,8">
                    <Grid ColumnDefinitions="*,Auto">
                        <Button Grid.Column="0"
                                Classes="text-button"
                                Content="Clear all"
                                Command="{Binding ClearAllCommand}"
                                IsVisible="{Binding HasNotifications}"
                                HorizontalAlignment="Left" />
                        <Button Grid.Column="1"
                                Classes="text-button"
                                Command="{Binding OpenSettingsCommand}"
                                HorizontalAlignment="Right">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <PathIcon Data="M19.14 12.94c.04-.31.06-.63.06-.94s-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58z"
                                          Width="14" Height="14" />
                                <TextBlock Text="Settings" />
                            </StackPanel>
                        </Button>
                    </Grid>
                </Border>
            </Grid>
        </Border>
    </Panel>

    <UserControl.Styles>
        <!-- Text Button Style -->
        <Style Selector="Button.text-button">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Foreground" Value="{DynamicResource PrimaryBrush}" />
            <Setter Property="Padding" Value="8,4" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>
        <Style Selector="Button.text-button /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="Transparent" />
        </Style>
        <Style Selector="Button.text-button:pointerover /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource SurfaceHoverBrush}" />
        </Style>

        <!-- Notification Item Style -->
        <Style Selector="Button.notification-item">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="16,12" />
            <Setter Property="HorizontalAlignment" Value="Stretch" />
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>
        <Style Selector="Button.notification-item /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="Transparent" />
        </Style>
        <Style Selector="Button.notification-item:pointerover /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource SurfaceHoverBrush}" />
        </Style>

        <!-- Unread Notification Style -->
        <Style Selector="Button.notification-item.unread /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource SurfaceAltBrush}" />
        </Style>
        <Style Selector="Button.notification-item.unread:pointerover /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource SurfaceHoverBrush}" />
        </Style>

        <!-- Small Icon Button Style -->
        <Style Selector="Button.icon-button-small">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Width" Value="24" />
            <Setter Property="Height" Value="24" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Foreground" Value="{DynamicResource TextTertiaryBrush}" />
            <Setter Property="Opacity" Value="0" />
        </Style>
        <Style Selector="Button.icon-button-small /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="Transparent" />
        </Style>
        <Style Selector="Button.notification-item:pointerover Button.icon-button-small">
            <Setter Property="Opacity" Value="1" />
        </Style>
        <Style Selector="Button.icon-button-small:pointerover">
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}" />
        </Style>
        <Style Selector="Button.icon-button-small:pointerover /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource SurfaceHoverBrush}" />
        </Style>
    </UserControl.Styles>
</UserControl>
