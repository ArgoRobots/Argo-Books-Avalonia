<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:ArgoBooks.ViewModels"
             xmlns:local="using:ArgoBooks.Converters"
             xmlns:icons="using:ArgoBooks"
             xmlns:controls="using:ArgoBooks.Controls"
             xmlns:table="using:ArgoBooks.Controls.ArgoTable"
             xmlns:loc="using:ArgoBooks.Localization"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
             x:Class="ArgoBooks.Views.ProductsPage"
             x:DataType="vm:ProductsPageViewModel">

    <Design.DataContext>
        <vm:ProductsPageViewModel />
    </Design.DataContext>

    <Panel>
    <Grid RowDefinitions="Auto,*">
        <!-- Tab Bar -->
        <Border Grid.Row="0"
                Background="{DynamicResource SurfaceBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="0,0,0,1">
            <TabControl x:Name="ProductsPageTabs"
                        SelectedIndex="{Binding SelectedTabIndex}"
                        Margin="0"
                        Classes="page-tabs">
                <TabItem Header="{loc:Loc Expenses}" />
                <TabItem Header="{loc:Loc Revenue}" />
            </TabControl>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1" RowDefinitions="Auto,*" Margin="24">
            <!-- Statistics Cards (Row 0) -->
            <Grid Grid.Row="0" ColumnDefinitions="*,*,*" RowDefinitions="Auto" Margin="0,0,0,24">
                    <Grid.Styles>
                        <Style Selector="Border.stat-card">
                            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
                            <Setter Property="CornerRadius" Value="12" />
                            <Setter Property="Padding" Value="20" />
                            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
                            <Setter Property="BorderThickness" Value="1" />
                        </Style>
                    </Grid.Styles>

                    <!-- Total Products -->
                    <Border Grid.Column="0" Classes="stat-card" Margin="0,0,12,0">
                        <Grid ColumnDefinitions="Auto,*">
                            <Border Grid.Column="0"
                                    Width="48" Height="48"
                                    CornerRadius="10"
                                    Background="{DynamicResource PrimaryLightBrush}"
                                    Margin="0,0,16,0">
                                <PathIcon Data="{x:Static icons:Icons.Products}"
                                          Width="24" Height="24"
                                          Foreground="{DynamicResource PrimaryBrush}" />
                            </Border>
                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                <TextBlock Text="{Binding TotalProducts}"
                                           FontSize="28"
                                           FontWeight="Bold"
                                           Foreground="{DynamicResource TextPrimaryBrush}" />
                                <TextBlock Text="{loc:Loc 'Total Products'}"
                                           FontSize="13"
                                           Foreground="{DynamicResource TextSecondaryBrush}" />
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Physical Products -->
                    <Border Grid.Column="1" Classes="stat-card" Margin="6,0">
                        <Grid ColumnDefinitions="Auto,*">
                            <Border Grid.Column="0"
                                    Width="48" Height="48"
                                    CornerRadius="10"
                                    Background="{DynamicResource SuccessLightBrush}"
                                    Margin="0,0,16,0">
                                <PathIcon Data="{x:Static icons:Icons.TableRows}"
                                          Width="24" Height="24"
                                          Foreground="{DynamicResource SuccessBrush}" />
                            </Border>
                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                <TextBlock Text="{Binding PhysicalProducts}"
                                           FontSize="28"
                                           FontWeight="Bold"
                                           Foreground="{DynamicResource TextPrimaryBrush}" />
                                <TextBlock Text="{loc:Loc 'Physical Products'}"
                                           FontSize="13"
                                           Foreground="{DynamicResource TextSecondaryBrush}" />
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Services -->
                    <Border Grid.Column="2" Classes="stat-card" Margin="12,0,0,0">
                        <Grid ColumnDefinitions="Auto,*">
                            <Border Grid.Column="0"
                                    Width="48" Height="48"
                                    CornerRadius="10"
                                    Background="{DynamicResource PurpleLightBrush}"
                                    Margin="0,0,16,0">
                                <PathIcon Data="{x:Static icons:Icons.Volume}"
                                          Width="24" Height="24"
                                          Foreground="{DynamicResource PurpleBrush}" />
                            </Border>
                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                <TextBlock Text="{Binding Services}"
                                           FontSize="28"
                                           FontWeight="Bold"
                                           Foreground="{DynamicResource TextPrimaryBrush}" />
                                <TextBlock Text="{loc:Loc Services}"
                                           FontSize="13"
                                           Foreground="{DynamicResource TextSecondaryBrush}" />
                            </StackPanel>
                        </Grid>
                    </Border>
            </Grid>

            <!-- Main Content Card using ArgoTable -->
            <table:ArgoTable Grid.Row="1"
                                Title="{Binding IsExpensesTabSelected, Converter={x:Static local:BoolConverters.ToExpensesOrRevenue}}"
                                ItemsSource="{Binding CurrentProducts}"
                                SearchQuery="{Binding SearchQuery, Mode=TwoWay}"
                                SearchPlaceholder="{loc:Loc 'Search products...'}"
                                SearchBoxWidth="{Binding ResponsiveHeader.SearchBoxWidth}"
                                SearchBoxMinHeight="{Binding ResponsiveHeader.SearchBoxMinHeight}"
                                SearchIconMargin="{Binding ResponsiveHeader.SearchIconMargin}"
                                HeaderPadding="{Binding ResponsiveHeader.HeaderPadding}"
                                HeaderSpacing="{Binding ResponsiveHeader.HeaderSpacing}"
                                IsCompactMode="{Binding ResponsiveHeader.IsCompactMode}"
                                IsMediumMode="{Binding ResponsiveHeader.IsMediumMode}"
                                ShowButtonText="{Binding ResponsiveHeader.ShowButtonText}"
                                FilterCommand="{Binding OpenFilterModalCommand}"
                                AddCommand="{Binding OpenAddModalCommand}"
                                AddButtonText="{loc:Loc 'Add Product'}"
                                AddButtonTooltip="{loc:Loc 'Add Product'}"
                                ColumnWidthsManager="{Binding ColumnWidths}"
                                CurrentPage="{Binding CurrentPage, Mode=TwoWay}"
                                TotalPages="{Binding TotalPages}"
                                PageSize="{Binding PageSize, Mode=TwoWay}"
                                PaginationText="{Binding PaginationText}"
                                GoToPageCommand="{Binding GoToPageCommand}"
                                GoToPreviousPageCommand="{Binding GoToPreviousPageCommand}"
                                GoToNextPageCommand="{Binding GoToNextPageCommand}"
                                ToggleColumnMenuCommand="{Binding ToggleColumnMenuCommand}"
                                EmptyIcon="{x:Static icons:Icons.Products}"
                                EmptyTitle="{loc:Loc 'No products found'}"
                                EmptyMessage="{loc:Loc 'Add your first product to start tracking your inventory.'}"
                                ShowExtraButtons="{Binding ShowRemainingProducts}"
                                BorderSizeChanged="OnHeaderSizeChanged"
                                TableGridSizeChanged="OnTableSizeChanged">

                <!-- Extra Buttons Content (Remaining Products + Upgrade) -->
                <table:ArgoTable.ExtraButtonsContent>
                    <StackPanel Orientation="Horizontal" Spacing="{Binding ResponsiveHeader.HeaderSpacing}">
                        <!-- Remaining Products Label (only shown on Free plan) -->
                        <TextBlock Text="{Binding RemainingProductsText}"
                                   FontSize="12"
                                   Foreground="{DynamicResource TextTertiaryBrush}"
                                   VerticalAlignment="Center"
                                   IsVisible="{Binding ShowRemainingProducts}" />

                        <!-- Upgrade Button (shown when limit reached) -->
                        <Button Classes="secondary-button"
                                Classes.compact="{Binding ResponsiveHeader.IsCompactMode}"
                                Classes.medium="{Binding ResponsiveHeader.IsMediumMode}"
                                Content="{loc:Loc Upgrade}"
                                Command="{Binding UpgradeCommand}"
                                IsVisible="{Binding ShowUpgradeButton}"
                                ToolTip.Tip="{Binding ResponsiveHeader.ShowButtonText, Converter={x:Static local:BoolConverters.ToParameterWhenFalse}, ConverterParameter={loc:Loc Upgrade}}"
                                Padding="12,6" />
                    </StackPanel>
                </table:ArgoTable.ExtraButtonsContent>

                <!-- Table Header Content - Using ArgoTableHeader for reduced boilerplate -->
                <table:ArgoTable.HeaderContent>
                    <Panel>
                        <!-- Table Header - Expenses Tab (8 columns) -->
                        <StackPanel Orientation="Horizontal" IsVisible="{Binding IsExpensesTabSelected}">
                            <table:ArgoTableHeader Header="{loc:Loc 'Product Name'}" ColumnName="Name" SortProperty="Name"
                                                       ColumnWidth="{Binding ColumnWidths.NameColumnWidth}"
                                                       IsColumnVisible="{Binding ShowNameColumn}"
                                                       SortColumn="{Binding SortColumn}" SortDirection="{Binding SortDirection}"
                                                       SortCommand="{Binding SortByCommand}" ColumnWidths="{Binding ColumnWidths}" />

                            <table:ArgoTableHeader Header="{loc:Loc Type}" ColumnName="Type" SortProperty="Type"
                                                       ColumnWidth="{Binding ColumnWidths.TypeColumnWidth}"
                                                       IsColumnVisible="{Binding ShowTypeColumn}"
                                                       SortColumn="{Binding SortColumn}" SortDirection="{Binding SortDirection}"
                                                       SortCommand="{Binding SortByCommand}" ColumnWidths="{Binding ColumnWidths}" />

                            <table:ArgoTableHeader Header="{loc:Loc Description}" ColumnName="Description" SortProperty="Description"
                                                       ColumnWidth="{Binding ColumnWidths.DescriptionColumnWidth}"
                                                       IsColumnVisible="{Binding ShowDescriptionColumn}"
                                                       SortColumn="{Binding SortColumn}" SortDirection="{Binding SortDirection}"
                                                       SortCommand="{Binding SortByCommand}" ColumnWidths="{Binding ColumnWidths}" />

                            <table:ArgoTableHeader Header="{loc:Loc Category}" ColumnName="Category" SortProperty="Category"
                                                       ColumnWidth="{Binding ColumnWidths.CategoryColumnWidth}"
                                                       IsColumnVisible="{Binding ShowCategoryColumn}"
                                                       SortColumn="{Binding SortColumn}" SortDirection="{Binding SortDirection}"
                                                       SortCommand="{Binding SortByCommand}" ColumnWidths="{Binding ColumnWidths}" />

                            <table:ArgoTableHeader Header="{loc:Loc Supplier}" ColumnName="Supplier" SortProperty="Supplier"
                                                       ColumnWidth="{Binding ColumnWidths.SupplierColumnWidth}"
                                                       IsColumnVisible="{Binding ShowSupplierColumn}"
                                                       SortColumn="{Binding SortColumn}" SortDirection="{Binding SortDirection}"
                                                       SortCommand="{Binding SortByCommand}" ColumnWidths="{Binding ColumnWidths}" />

                            <table:ArgoTableHeader Header="{loc:Loc Reorder}" ColumnName="Reorder"
                                                       ColumnWidth="{Binding ColumnWidths.ReorderColumnWidth}"
                                                       IsColumnVisible="{Binding ShowReorderColumn}"
                                                       IsSortable="False" ColumnWidths="{Binding ColumnWidths}" />

                            <table:ArgoTableHeader Header="{loc:Loc Overstock}" ColumnName="Overstock"
                                                       ColumnWidth="{Binding ColumnWidths.OverstockColumnWidth}"
                                                       IsColumnVisible="{Binding ShowOverstockColumn}"
                                                       IsSortable="False" ColumnWidths="{Binding ColumnWidths}" />

                            <table:ArgoTableHeader Header="{loc:Loc Actions}" ColumnName="Actions"
                                                       ColumnWidth="{Binding ColumnWidths.ActionsColumnWidth}"
                                                       IsSortable="False" IsResizable="False" ShowSeparator="False" />
                        </StackPanel>

                        <!-- Table Header - Revenue Tab (5 columns) -->
                        <StackPanel Orientation="Horizontal" IsVisible="{Binding IsRevenueTabSelected}">
                            <table:ArgoTableHeader Header="{loc:Loc 'Product Name'}" ColumnName="Name" SortProperty="Name"
                                                       ColumnWidth="{Binding ColumnWidths.NameColumnWidth}"
                                                       IsColumnVisible="{Binding ShowNameColumn}"
                                                       SortColumn="{Binding SortColumn}" SortDirection="{Binding SortDirection}"
                                                       SortCommand="{Binding SortByCommand}" ColumnWidths="{Binding ColumnWidths}" />

                            <table:ArgoTableHeader Header="{loc:Loc Type}" ColumnName="Type" SortProperty="Type"
                                                       ColumnWidth="{Binding ColumnWidths.TypeColumnWidth}"
                                                       IsColumnVisible="{Binding ShowTypeColumn}"
                                                       SortColumn="{Binding SortColumn}" SortDirection="{Binding SortDirection}"
                                                       SortCommand="{Binding SortByCommand}" ColumnWidths="{Binding ColumnWidths}" />

                            <table:ArgoTableHeader Header="{loc:Loc Description}" ColumnName="Description" SortProperty="Description"
                                                       ColumnWidth="{Binding ColumnWidths.DescriptionColumnWidth}"
                                                       IsColumnVisible="{Binding ShowDescriptionColumn}"
                                                       SortColumn="{Binding SortColumn}" SortDirection="{Binding SortDirection}"
                                                       SortCommand="{Binding SortByCommand}" ColumnWidths="{Binding ColumnWidths}" />

                            <table:ArgoTableHeader Header="{loc:Loc Category}" ColumnName="Category" SortProperty="Category"
                                                       ColumnWidth="{Binding ColumnWidths.CategoryColumnWidth}"
                                                       IsColumnVisible="{Binding ShowCategoryColumn}"
                                                       SortColumn="{Binding SortColumn}" SortDirection="{Binding SortDirection}"
                                                       SortCommand="{Binding SortByCommand}" ColumnWidths="{Binding ColumnWidths}" />

                            <table:ArgoTableHeader Header="{loc:Loc Actions}" ColumnName="Actions"
                                                       ColumnWidth="{Binding ColumnWidths.ActionsColumnWidth}"
                                                       IsSortable="False" IsResizable="False" ShowSeparator="False" />
                        </StackPanel>
                    </Panel>
                </table:ArgoTable.HeaderContent>

                <!-- Table Rows Content - Using ArgoTableCell for reduced boilerplate -->
                <table:ArgoTable.RowsContent>
                    <Panel>
                        <!-- Expenses Tab Products -->
                        <ItemsControl ItemsSource="{Binding ExpenseProducts}"
                                      IsVisible="{Binding IsExpensesTabSelected}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate DataType="vm:ProductDisplayItem">
                                    <Border Padding="24,0"
                                            BorderBrush="{DynamicResource BorderBrush}"
                                            BorderThickness="0,0,0,1"
                                            MinHeight="52">
                                        <StackPanel Orientation="Horizontal">
                                            <!-- Product Name with ID - Custom content required -->
                                            <table:ArgoTableCell ColumnWidth="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).ColumnWidths.NameColumnWidth}"
                                                                     IsColumnVisible="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).ShowNameColumn}">
                                                <table:ArgoTableCell.CellContent>
                                                    <StackPanel VerticalAlignment="Center">
                                                        <TextBlock Text="{Binding Name}" FontSize="14" FontWeight="Medium"
                                                                   Foreground="{DynamicResource TextPrimaryBrush}" TextTrimming="CharacterEllipsis" />
                                                        <TextBlock Text="{Binding Id}" FontSize="12"
                                                                   Foreground="{DynamicResource TextTertiaryBrush}" />
                                                    </StackPanel>
                                                </table:ArgoTableCell.CellContent>
                                            </table:ArgoTableCell>

                                            <!-- Type Badge - Custom content required -->
                                            <table:ArgoTableCell ColumnWidth="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).ColumnWidths.TypeColumnWidth}"
                                                                     IsColumnVisible="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).ShowTypeColumn}">
                                                <table:ArgoTableCell.CellContent>
                                                    <Border VerticalAlignment="Center" HorizontalAlignment="Left"
                                                            Padding="8,4" CornerRadius="4"
                                                            Background="{Binding ItemType, Converter={x:Static local:StringConverters.ToItemTypeBadgeBackground}}">
                                                        <TextBlock Text="{Binding ItemType, Converter={StaticResource TranslateConverter}}"
                                                                   FontSize="12" FontWeight="Medium"
                                                                   Foreground="{Binding ItemType, Converter={x:Static local:StringConverters.ToItemTypeBadgeForeground}}" />
                                                    </Border>
                                                </table:ArgoTableCell.CellContent>
                                            </table:ArgoTableCell>

                                            <!-- Simple text cells using ArgoTableCell -->
                                            <table:ArgoTableCell Text="{Binding Description, TargetNullValue='-', FallbackValue='-'}"
                                                                     ColumnWidth="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).ColumnWidths.DescriptionColumnWidth}"
                                                                     IsColumnVisible="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).ShowDescriptionColumn}" />

                                            <table:ArgoTableCell Text="{Binding CategoryName}"
                                                                     ColumnWidth="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).ColumnWidths.CategoryColumnWidth}"
                                                                     IsColumnVisible="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).ShowCategoryColumn}" />

                                            <table:ArgoTableCell Text="{Binding SupplierName}"
                                                                     ColumnWidth="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).ColumnWidths.SupplierColumnWidth}"
                                                                     IsColumnVisible="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).ShowSupplierColumn}" />

                                            <table:ArgoTableCell Text="{Binding ReorderPoint}"
                                                                     ColumnWidth="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).ColumnWidths.ReorderColumnWidth}"
                                                                     IsColumnVisible="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).ShowReorderColumn}" />

                                            <table:ArgoTableCell Text="{Binding OverstockThreshold}"
                                                                     ColumnWidth="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).ColumnWidths.OverstockColumnWidth}"
                                                                     IsColumnVisible="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).ShowOverstockColumn}" />

                                            <!-- Actions - Custom content required -->
                                            <table:ArgoTableCell ColumnWidth="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).ColumnWidths.ActionsColumnWidth}"
                                                                     ShowSeparator="False">
                                                <table:ArgoTableCell.CellContent>
                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center" Spacing="4">
                                                        <Button Classes="icon-button" ToolTip.Tip="{loc:Loc Edit}"
                                                                Command="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).OpenEditModalCommand}"
                                                                CommandParameter="{Binding}">
                                                            <PathIcon Data="{x:Static icons:Icons.Edit}" Width="16" Height="16" />
                                                        </Button>
                                                        <Button Classes="icon-button danger" ToolTip.Tip="{loc:Loc Delete}"
                                                                Command="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).OpenDeleteConfirmCommand}"
                                                                CommandParameter="{Binding}">
                                                            <PathIcon Data="{x:Static icons:Icons.Delete}" Width="16" Height="16" />
                                                        </Button>
                                                    </StackPanel>
                                                </table:ArgoTableCell.CellContent>
                                            </table:ArgoTableCell>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <!-- Revenue Tab Products -->
                        <ItemsControl ItemsSource="{Binding RevenueProducts}"
                                      IsVisible="{Binding IsRevenueTabSelected}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate DataType="vm:ProductDisplayItem">
                                    <Border Padding="24,0"
                                            BorderBrush="{DynamicResource BorderBrush}"
                                            BorderThickness="0,0,0,1"
                                            MinHeight="52">
                                        <StackPanel Orientation="Horizontal">
                                            <!-- Product Name with ID - Custom content required -->
                                            <table:ArgoTableCell ColumnWidth="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).ColumnWidths.NameColumnWidth}"
                                                                     IsColumnVisible="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).ShowNameColumn}">
                                                <table:ArgoTableCell.CellContent>
                                                    <StackPanel VerticalAlignment="Center">
                                                        <TextBlock Text="{Binding Name}" FontSize="14" FontWeight="Medium"
                                                                   Foreground="{DynamicResource TextPrimaryBrush}" TextTrimming="CharacterEllipsis" />
                                                        <TextBlock Text="{Binding Id}" FontSize="12"
                                                                   Foreground="{DynamicResource TextTertiaryBrush}" />
                                                    </StackPanel>
                                                </table:ArgoTableCell.CellContent>
                                            </table:ArgoTableCell>

                                            <!-- Type Badge - Custom content required -->
                                            <table:ArgoTableCell ColumnWidth="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).ColumnWidths.TypeColumnWidth}"
                                                                     IsColumnVisible="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).ShowTypeColumn}">
                                                <table:ArgoTableCell.CellContent>
                                                    <Border VerticalAlignment="Center" HorizontalAlignment="Left"
                                                            Padding="8,4" CornerRadius="4"
                                                            Background="{Binding ItemType, Converter={x:Static local:StringConverters.ToItemTypeBadgeBackground}}">
                                                        <TextBlock Text="{Binding ItemType, Converter={StaticResource TranslateConverter}}"
                                                                   FontSize="12" FontWeight="Medium"
                                                                   Foreground="{Binding ItemType, Converter={x:Static local:StringConverters.ToItemTypeBadgeForeground}}" />
                                                    </Border>
                                                </table:ArgoTableCell.CellContent>
                                            </table:ArgoTableCell>

                                            <!-- Simple text cells using ArgoTableCell -->
                                            <table:ArgoTableCell Text="{Binding Description, TargetNullValue='-', FallbackValue='-'}"
                                                                     ColumnWidth="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).ColumnWidths.DescriptionColumnWidth}"
                                                                     IsColumnVisible="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).ShowDescriptionColumn}" />

                                            <table:ArgoTableCell Text="{Binding CategoryName}"
                                                                     ColumnWidth="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).ColumnWidths.CategoryColumnWidth}"
                                                                     IsColumnVisible="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).ShowCategoryColumn}" />

                                            <!-- Actions - Custom content required -->
                                            <table:ArgoTableCell ColumnWidth="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).ColumnWidths.ActionsColumnWidth}"
                                                                     ShowSeparator="False">
                                                <table:ArgoTableCell.CellContent>
                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center" Spacing="4">
                                                        <Button Classes="icon-button" ToolTip.Tip="{loc:Loc Edit}"
                                                                Command="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).OpenEditModalCommand}"
                                                                CommandParameter="{Binding}">
                                                            <PathIcon Data="{x:Static icons:Icons.Edit}" Width="16" Height="16" />
                                                        </Button>
                                                        <Button Classes="icon-button danger" ToolTip.Tip="{loc:Loc Delete}"
                                                                Command="{Binding $parent[ItemsControl].((vm:ProductsPageViewModel)DataContext).OpenDeleteConfirmCommand}"
                                                                CommandParameter="{Binding}">
                                                            <PathIcon Data="{x:Static icons:Icons.Delete}" Width="16" Height="16" />
                                                        </Button>
                                                    </StackPanel>
                                                </table:ArgoTableCell.CellContent>
                                            </table:ArgoTableCell>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </Panel>
                </table:ArgoTable.RowsContent>
            </table:ArgoTable>
        </Grid>

    </Grid>

    <!-- Column Visibility Menu -->
    <controls:ColumnVisibilityMenu IsOpen="{Binding IsColumnMenuOpen}"
                                    MenuX="{Binding ColumnWidths.ColumnMenuX}"
                                    MenuY="{Binding ColumnWidths.ColumnMenuY}"
                                    CloseCommand="{Binding CloseColumnMenuCommand}"
                                    ResetCommand="{Binding ResetColumnVisibilityCommand}">
        <controls:ColumnVisibilityMenu.ColumnsContent>
            <StackPanel Spacing="4">
                <CheckBox IsChecked="{Binding ShowNameColumn}" Content="{loc:Loc 'Product Name'}" Classes="column-toggle" />
                <CheckBox IsChecked="{Binding ShowTypeColumn}" Content="{loc:Loc Type}" Classes="column-toggle" />
                <CheckBox IsChecked="{Binding ShowDescriptionColumn}" Content="{loc:Loc Description}" Classes="column-toggle" />
                <CheckBox IsChecked="{Binding ShowCategoryColumn}" Content="{loc:Loc Category}" Classes="column-toggle" />
                <CheckBox IsChecked="{Binding ShowSupplierColumn}" Content="{loc:Loc Supplier}" Classes="column-toggle" IsVisible="{Binding IsExpensesTabSelected}" />
                <CheckBox IsChecked="{Binding ShowReorderColumn}" Content="{loc:Loc Reorder}" Classes="column-toggle" IsVisible="{Binding IsExpensesTabSelected}" />
                <CheckBox IsChecked="{Binding ShowOverstockColumn}" Content="{loc:Loc Overstock}" Classes="column-toggle" IsVisible="{Binding IsExpensesTabSelected}" />
            </StackPanel>
        </controls:ColumnVisibilityMenu.ColumnsContent>
    </controls:ColumnVisibilityMenu>
    </Panel>

</UserControl>
