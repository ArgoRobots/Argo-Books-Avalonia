<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:controls="using:ArgoBooks.Controls"
             mc:Ignorable="d" d:DesignWidth="280" d:DesignHeight="120"
             x:Class="ArgoBooks.Controls.StatCard"
             x:DataType="controls:StatCard"
             x:Name="StatCardRoot">

    <Border BorderBrush="{DynamicResource BorderBrush}"
            BorderThickness="1"
            CornerRadius="{StaticResource RadiusMd}"
            Classes.alt-bg="{Binding UseAltBackground, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
            Classes.compact="{Binding IsCompact, RelativeSource={RelativeSource AncestorType=controls:StatCard}}">
        <Border.Styles>
            <Style Selector="Border">
                <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
                <Setter Property="Padding" Value="20" />
            </Style>
            <Style Selector="Border.alt-bg">
                <Setter Property="Background" Value="{DynamicResource SurfaceAltBrush}" />
                <Setter Property="BorderThickness" Value="0" />
            </Style>
            <Style Selector="Border.compact">
                <Setter Property="Padding" Value="12" />
            </Style>
        </Border.Styles>
        <Grid ColumnDefinitions="Auto,*">
            <!-- Icon Container -->
            <Border Grid.Column="0"
                    x:Name="IconContainer"
                    Width="48" Height="48"
                    CornerRadius="{StaticResource RadiusMd}"
                    VerticalAlignment="Top"
                    Margin="0,0,16,0"
                    IsVisible="{Binding Icon, RelativeSource={RelativeSource AncestorType=controls:StatCard}, Converter={x:Static ObjectConverters.IsNotNull}}"
                    Classes.primary="{Binding IsPrimaryColor, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                    Classes.success="{Binding IsSuccessColor, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                    Classes.danger="{Binding IsDangerColor, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                    Classes.warning="{Binding IsWarningColor, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                    Classes.info="{Binding IsInfoColor, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                    Classes.compact="{Binding IsCompact, RelativeSource={RelativeSource AncestorType=controls:StatCard}}">
                <Border.Styles>
                    <!-- Icon Background Colors based on IconColor property -->
                    <Style Selector="Border.primary">
                        <Setter Property="Background" Value="{DynamicResource PrimaryIconBgBrush}" />
                    </Style>
                    <Style Selector="Border.success">
                        <Setter Property="Background" Value="{DynamicResource SuccessIconBgBrush}" />
                    </Style>
                    <Style Selector="Border.danger">
                        <Setter Property="Background" Value="{DynamicResource DangerIconBgBrush}" />
                    </Style>
                    <Style Selector="Border.warning">
                        <Setter Property="Background" Value="{DynamicResource WarningIconBgBrush}" />
                    </Style>
                    <Style Selector="Border.info">
                        <Setter Property="Background" Value="{DynamicResource InfoIconBgBrush}" />
                    </Style>
                    <!-- Compact mode: smaller icon container -->
                    <Style Selector="Border.compact">
                        <Setter Property="Width" Value="36" />
                        <Setter Property="Height" Value="36" />
                        <Setter Property="Margin" Value="0,0,10,0" />
                        <Setter Property="CornerRadius" Value="8" />
                    </Style>
                </Border.Styles>
                <PathIcon x:Name="IconPath"
                          Data="{Binding Icon, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                          Width="24" Height="24"
                          Classes.primary="{Binding IsPrimaryColor, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                          Classes.success="{Binding IsSuccessColor, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                          Classes.danger="{Binding IsDangerColor, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                          Classes.warning="{Binding IsWarningColor, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                          Classes.info="{Binding IsInfoColor, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                          Classes.compact="{Binding IsCompact, RelativeSource={RelativeSource AncestorType=controls:StatCard}}">
                    <PathIcon.Styles>
                        <Style Selector="PathIcon.primary">
                            <Setter Property="Foreground" Value="{DynamicResource PrimaryBrush}" />
                        </Style>
                        <Style Selector="PathIcon.success">
                            <Setter Property="Foreground" Value="{DynamicResource SuccessBrush}" />
                        </Style>
                        <Style Selector="PathIcon.danger">
                            <Setter Property="Foreground" Value="{DynamicResource DangerBrush}" />
                        </Style>
                        <Style Selector="PathIcon.warning">
                            <Setter Property="Foreground" Value="{DynamicResource WarningBrush}" />
                        </Style>
                        <Style Selector="PathIcon.info">
                            <Setter Property="Foreground" Value="{DynamicResource InfoBrush}" />
                        </Style>
                        <!-- Compact mode: smaller icon -->
                        <Style Selector="PathIcon.compact">
                            <Setter Property="Width" Value="18" />
                            <Setter Property="Height" Value="18" />
                        </Style>
                    </PathIcon.Styles>
                </PathIcon>
            </Border>

            <!-- Content -->
            <StackPanel Grid.Column="1" Spacing="4" VerticalAlignment="Center"
                        Classes.compact="{Binding IsCompact, RelativeSource={RelativeSource AncestorType=controls:StatCard}}">
                <StackPanel.Styles>
                    <Style Selector="StackPanel.compact">
                        <Setter Property="Spacing" Value="2" />
                    </Style>
                </StackPanel.Styles>
                <!-- Main Value -->
                <TextBlock x:Name="ValueText"
                           Text="{Binding Value, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                           FontSize="{StaticResource FontSize2xl}"
                           FontWeight="Bold"
                           Classes.value-success="{Binding IsValueColorSuccess, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                           Classes.value-danger="{Binding IsValueColorDanger, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                           Classes.compact="{Binding IsCompact, RelativeSource={RelativeSource AncestorType=controls:StatCard}}">
                    <TextBlock.Styles>
                        <Style Selector="TextBlock">
                            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
                        </Style>
                        <Style Selector="TextBlock.value-success">
                            <Setter Property="Foreground" Value="{DynamicResource SuccessBrush}" />
                        </Style>
                        <Style Selector="TextBlock.value-danger">
                            <Setter Property="Foreground" Value="{DynamicResource DangerBrush}" />
                        </Style>
                        <!-- Compact mode: smaller font -->
                        <Style Selector="TextBlock.compact">
                            <Setter Property="FontSize" Value="18" />
                        </Style>
                    </TextBlock.Styles>
                </TextBlock>

                <!-- Label -->
                <TextBlock x:Name="LabelText"
                           Text="{Binding Label, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                           FontSize="{StaticResource FontSizeSm}"
                           Foreground="{DynamicResource TextSecondaryBrush}"
                           IsVisible="{Binding Label, RelativeSource={RelativeSource AncestorType=controls:StatCard}, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                           Classes.compact="{Binding IsCompact, RelativeSource={RelativeSource AncestorType=controls:StatCard}}">
                    <TextBlock.Styles>
                        <Style Selector="TextBlock.compact">
                            <Setter Property="FontSize" Value="11" />
                        </Style>
                    </TextBlock.Styles>
                </TextBlock>

                <!-- Trend Line: arrow + percentage + "from last month" -->
                <StackPanel Orientation="Horizontal" Spacing="4"
                            IsVisible="{Binding ShowChange, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                            Classes.compact="{Binding IsCompact, RelativeSource={RelativeSource AncestorType=controls:StatCard}}">
                    <StackPanel.Styles>
                        <Style Selector="StackPanel.compact">
                            <Setter Property="Spacing" Value="2" />
                        </Style>
                        <Style Selector="StackPanel.compact TextBlock">
                            <Setter Property="FontSize" Value="10" />
                        </Style>
                    </StackPanel.Styles>
                    <!-- Trend Arrow -->
                    <TextBlock VerticalAlignment="Center"
                               FontSize="{StaticResource FontSizeSm}"
                               Classes.up="{Binding IsTrendUp, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                               Classes.down="{Binding IsTrendDown, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                               Classes.flat="{Binding IsTrendFlat, RelativeSource={RelativeSource AncestorType=controls:StatCard}}">
                        <TextBlock.Styles>
                            <Style Selector="TextBlock.up">
                                <Setter Property="Text" Value="↑" />
                                <Setter Property="Foreground" Value="{DynamicResource SuccessBrush}" />
                            </Style>
                            <Style Selector="TextBlock.down">
                                <Setter Property="Text" Value="↓" />
                                <Setter Property="Foreground" Value="{DynamicResource DangerBrush}" />
                            </Style>
                            <Style Selector="TextBlock.flat">
                                <Setter Property="Text" Value="→" />
                                <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}" />
                            </Style>
                        </TextBlock.Styles>
                    </TextBlock>
                    <!-- Change Percentage -->
                    <TextBlock Text="{Binding ChangeText, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                               FontSize="{StaticResource FontSizeSm}"
                               VerticalAlignment="Center"
                               Classes.positive="{Binding IsPositiveTrend, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                               Classes.negative="{Binding IsNegativeTrend, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                               Classes.neutral="{Binding IsNeutralTrend, RelativeSource={RelativeSource AncestorType=controls:StatCard}}">
                        <TextBlock.Styles>
                            <Style Selector="TextBlock.positive">
                                <Setter Property="Foreground" Value="{DynamicResource SuccessBrush}" />
                            </Style>
                            <Style Selector="TextBlock.negative">
                                <Setter Property="Foreground" Value="{DynamicResource DangerBrush}" />
                            </Style>
                            <Style Selector="TextBlock.neutral">
                                <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}" />
                            </Style>
                        </TextBlock.Styles>
                    </TextBlock>
                    <!-- comparison label text -->
                    <TextBlock Text="{Binding ChangeLabel, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                               FontSize="{StaticResource FontSizeSm}"
                               VerticalAlignment="Center"
                               IsVisible="{Binding ChangeLabel, RelativeSource={RelativeSource AncestorType=controls:StatCard}, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                               Classes.positive="{Binding IsPositiveTrend, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                               Classes.negative="{Binding IsNegativeTrend, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                               Classes.neutral="{Binding IsNeutralTrend, RelativeSource={RelativeSource AncestorType=controls:StatCard}}">
                        <TextBlock.Styles>
                            <Style Selector="TextBlock.positive">
                                <Setter Property="Foreground" Value="{DynamicResource SuccessBrush}" />
                            </Style>
                            <Style Selector="TextBlock.negative">
                                <Setter Property="Foreground" Value="{DynamicResource DangerBrush}" />
                            </Style>
                            <Style Selector="TextBlock.neutral">
                                <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}" />
                            </Style>
                        </TextBlock.Styles>
                    </TextBlock>
                </StackPanel>

                <!-- Secondary Text -->
                <TextBlock Text="{Binding SecondaryText, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                           FontSize="{StaticResource FontSizeXs}"
                           Foreground="{DynamicResource TextTertiaryBrush}"
                           IsVisible="{Binding SecondaryText, RelativeSource={RelativeSource AncestorType=controls:StatCard}, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />
            </StackPanel>
        </Grid>
    </Border>
</UserControl>
