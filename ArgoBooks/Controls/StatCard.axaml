<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:controls="using:ArgoBooks.Controls"
             mc:Ignorable="d" d:DesignWidth="280" d:DesignHeight="120"
             x:Class="ArgoBooks.Controls.StatCard"
             x:DataType="controls:StatCard"
             x:Name="StatCardRoot">

    <UserControl.Styles>
        <!-- Base styles for all elements -->
        <Style Selector="controls|StatCard Border#OuterBorder">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
            <Setter Property="Padding" Value="20" />
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="8" />
        </Style>
        <Style Selector="controls|StatCard.alt-bg Border#OuterBorder">
            <Setter Property="Background" Value="{DynamicResource SurfaceAltBrush}" />
            <Setter Property="BorderThickness" Value="0" />
        </Style>
        <Style Selector="controls|StatCard.compact Border#OuterBorder">
            <Setter Property="Padding" Value="12" />
        </Style>

        <!-- Icon container base styles -->
        <Style Selector="controls|StatCard Border#IconContainer">
            <Setter Property="Width" Value="48" />
            <Setter Property="Height" Value="48" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Margin" Value="0,0,16,0" />
        </Style>
        <Style Selector="controls|StatCard.compact Border#IconContainer">
            <Setter Property="Width" Value="36" />
            <Setter Property="Height" Value="36" />
            <Setter Property="Margin" Value="0,0,10,0" />
            <Setter Property="CornerRadius" Value="8" />
        </Style>

        <!-- Icon container colors -->
        <Style Selector="controls|StatCard.icon-primary Border#IconContainer">
            <Setter Property="Background" Value="{DynamicResource PrimaryIconBgBrush}" />
        </Style>
        <Style Selector="controls|StatCard.icon-success Border#IconContainer">
            <Setter Property="Background" Value="{DynamicResource SuccessIconBgBrush}" />
        </Style>
        <Style Selector="controls|StatCard.icon-danger Border#IconContainer">
            <Setter Property="Background" Value="{DynamicResource DangerIconBgBrush}" />
        </Style>
        <Style Selector="controls|StatCard.icon-warning Border#IconContainer">
            <Setter Property="Background" Value="{DynamicResource WarningIconBgBrush}" />
        </Style>
        <Style Selector="controls|StatCard.icon-info Border#IconContainer">
            <Setter Property="Background" Value="{DynamicResource InfoIconBgBrush}" />
        </Style>

        <!-- PathIcon base styles -->
        <Style Selector="controls|StatCard PathIcon#IconPath">
            <Setter Property="Width" Value="24" />
            <Setter Property="Height" Value="24" />
        </Style>
        <Style Selector="controls|StatCard.compact PathIcon#IconPath">
            <Setter Property="Width" Value="18" />
            <Setter Property="Height" Value="18" />
        </Style>

        <!-- PathIcon colors -->
        <Style Selector="controls|StatCard.icon-primary PathIcon#IconPath">
            <Setter Property="Foreground" Value="{DynamicResource PrimaryBrush}" />
        </Style>
        <Style Selector="controls|StatCard.icon-success PathIcon#IconPath">
            <Setter Property="Foreground" Value="{DynamicResource SuccessBrush}" />
        </Style>
        <Style Selector="controls|StatCard.icon-danger PathIcon#IconPath">
            <Setter Property="Foreground" Value="{DynamicResource DangerBrush}" />
        </Style>
        <Style Selector="controls|StatCard.icon-warning PathIcon#IconPath">
            <Setter Property="Foreground" Value="{DynamicResource WarningBrush}" />
        </Style>
        <Style Selector="controls|StatCard.icon-info PathIcon#IconPath">
            <Setter Property="Foreground" Value="{DynamicResource InfoBrush}" />
        </Style>

        <!-- Value text styles -->
        <Style Selector="controls|StatCard TextBlock#ValueText">
            <Setter Property="FontSize" Value="28" />
            <Setter Property="FontWeight" Value="Bold" />
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
        </Style>
        <Style Selector="controls|StatCard.compact TextBlock#ValueText">
            <Setter Property="FontSize" Value="18" />
        </Style>
        <Style Selector="controls|StatCard.value-success TextBlock#ValueText">
            <Setter Property="Foreground" Value="{DynamicResource SuccessBrush}" />
        </Style>
        <Style Selector="controls|StatCard.value-danger TextBlock#ValueText">
            <Setter Property="Foreground" Value="{DynamicResource DangerBrush}" />
        </Style>

        <!-- Label text styles -->
        <Style Selector="controls|StatCard TextBlock#LabelText">
            <Setter Property="FontSize" Value="13" />
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}" />
        </Style>
        <Style Selector="controls|StatCard.compact TextBlock#LabelText">
            <Setter Property="FontSize" Value="11" />
        </Style>

        <!-- Content stack panel -->
        <Style Selector="controls|StatCard StackPanel#ContentPanel">
            <Setter Property="Spacing" Value="4" />
        </Style>
        <Style Selector="controls|StatCard.compact StackPanel#ContentPanel">
            <Setter Property="Spacing" Value="2" />
        </Style>

        <!-- Trend stack panel -->
        <Style Selector="controls|StatCard StackPanel#TrendPanel">
            <Setter Property="Spacing" Value="4" />
        </Style>
        <Style Selector="controls|StatCard.compact StackPanel#TrendPanel">
            <Setter Property="Spacing" Value="2" />
        </Style>
        <Style Selector="controls|StatCard.compact StackPanel#TrendPanel TextBlock">
            <Setter Property="FontSize" Value="10" />
        </Style>
    </UserControl.Styles>

    <Border x:Name="OuterBorder">
        <Grid ColumnDefinitions="Auto,*">
            <!-- Icon Container -->
            <Border Grid.Column="0"
                    x:Name="IconContainer"
                    VerticalAlignment="Top"
                    IsVisible="{Binding Icon, RelativeSource={RelativeSource AncestorType=controls:StatCard}, Converter={x:Static ObjectConverters.IsNotNull}}">
                <PathIcon x:Name="IconPath"
                          Data="{Binding Icon, RelativeSource={RelativeSource AncestorType=controls:StatCard}}" />
            </Border>

            <!-- Content -->
            <StackPanel Grid.Column="1" x:Name="ContentPanel" VerticalAlignment="Center">
                <!-- Main Value -->
                <TextBlock x:Name="ValueText"
                           Text="{Binding Value, RelativeSource={RelativeSource AncestorType=controls:StatCard}}" />

                <!-- Label -->
                <TextBlock x:Name="LabelText"
                           Text="{Binding Label, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                           IsVisible="{Binding Label, RelativeSource={RelativeSource AncestorType=controls:StatCard}, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />

                <!-- Trend Line: arrow + percentage + "from last month" -->
                <StackPanel x:Name="TrendPanel" Orientation="Horizontal"
                            IsVisible="{Binding ShowChange, RelativeSource={RelativeSource AncestorType=controls:StatCard}}">
                    <!-- Trend Arrow -->
                    <TextBlock VerticalAlignment="Center"
                               FontSize="12"
                               Classes.up="{Binding IsTrendUp, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                               Classes.down="{Binding IsTrendDown, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                               Classes.flat="{Binding IsTrendFlat, RelativeSource={RelativeSource AncestorType=controls:StatCard}}">
                        <TextBlock.Styles>
                            <Style Selector="TextBlock.up">
                                <Setter Property="Text" Value="↑" />
                                <Setter Property="Foreground" Value="{DynamicResource SuccessBrush}" />
                            </Style>
                            <Style Selector="TextBlock.down">
                                <Setter Property="Text" Value="↓" />
                                <Setter Property="Foreground" Value="{DynamicResource DangerBrush}" />
                            </Style>
                            <Style Selector="TextBlock.flat">
                                <Setter Property="Text" Value="→" />
                                <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}" />
                            </Style>
                        </TextBlock.Styles>
                    </TextBlock>
                    <!-- Change Percentage -->
                    <TextBlock Text="{Binding ChangeText, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                               FontSize="12"
                               VerticalAlignment="Center"
                               Classes.positive="{Binding IsPositiveTrend, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                               Classes.negative="{Binding IsNegativeTrend, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                               Classes.neutral="{Binding IsNeutralTrend, RelativeSource={RelativeSource AncestorType=controls:StatCard}}">
                        <TextBlock.Styles>
                            <Style Selector="TextBlock.positive">
                                <Setter Property="Foreground" Value="{DynamicResource SuccessBrush}" />
                            </Style>
                            <Style Selector="TextBlock.negative">
                                <Setter Property="Foreground" Value="{DynamicResource DangerBrush}" />
                            </Style>
                            <Style Selector="TextBlock.neutral">
                                <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}" />
                            </Style>
                        </TextBlock.Styles>
                    </TextBlock>
                    <!-- comparison label text -->
                    <TextBlock Text="{Binding ChangeLabel, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                               FontSize="12"
                               VerticalAlignment="Center"
                               IsVisible="{Binding ChangeLabel, RelativeSource={RelativeSource AncestorType=controls:StatCard}, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                               Classes.positive="{Binding IsPositiveTrend, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                               Classes.negative="{Binding IsNegativeTrend, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                               Classes.neutral="{Binding IsNeutralTrend, RelativeSource={RelativeSource AncestorType=controls:StatCard}}">
                        <TextBlock.Styles>
                            <Style Selector="TextBlock.positive">
                                <Setter Property="Foreground" Value="{DynamicResource SuccessBrush}" />
                            </Style>
                            <Style Selector="TextBlock.negative">
                                <Setter Property="Foreground" Value="{DynamicResource DangerBrush}" />
                            </Style>
                            <Style Selector="TextBlock.neutral">
                                <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}" />
                            </Style>
                        </TextBlock.Styles>
                    </TextBlock>
                </StackPanel>

                <!-- Secondary Text -->
                <TextBlock Text="{Binding SecondaryText, RelativeSource={RelativeSource AncestorType=controls:StatCard}}"
                           FontSize="10"
                           Foreground="{DynamicResource TextTertiaryBrush}"
                           IsVisible="{Binding SecondaryText, RelativeSource={RelativeSource AncestorType=controls:StatCard}, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />
            </StackPanel>
        </Grid>
    </Border>
</UserControl>
