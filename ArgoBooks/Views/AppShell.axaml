<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:ArgoBooks.ViewModels"
             xmlns:controls="using:ArgoBooks.Controls"
             xmlns:panels="using:ArgoBooks.Panels"
             xmlns:modals="using:ArgoBooks.Modals"
             xmlns:loc="using:ArgoBooks.Localization"
             xmlns:helpers="using:ArgoBooks.Helpers"
             xmlns:icons="using:ArgoBooks"
             mc:Ignorable="d" d:DesignWidth="1280" d:DesignHeight="800"
             x:Class="ArgoBooks.Views.AppShell"
             x:DataType="vm:AppShellViewModel"
             Background="{DynamicResource BackgroundBrush}"
             Focusable="True">

    <Design.DataContext>
        <vm:AppShellViewModel />
    </Design.DataContext>

    <Panel>
        <!-- Main Layout -->
        <Grid ColumnDefinitions="Auto,*">
            <!-- Sidebar with smooth width transition -->
            <controls:Sidebar x:Name="AppSidebar"
                              Grid.Column="0"
                              DataContext="{Binding SidebarViewModel}"
                              Width="{Binding Width}">
                <controls:Sidebar.Transitions>
                    <Transitions>
                        <DoubleTransition Property="Width" Duration="0:0:0.2" Easing="CubicEaseOut" />
                    </Transitions>
                </controls:Sidebar.Transitions>
            </controls:Sidebar>

            <!-- Main Content Area -->
            <Panel Grid.Column="1">
                <Grid RowDefinitions="Auto,*">
                    <!-- Header -->
                    <controls:Header x:Name="AppHeader"
                                     Grid.Row="0"
                                     DataContext="{Binding HeaderViewModel}" />

                    <!-- Page Content (from mockup: padding 30px, background #f5f7fa) -->
                    <Border x:Name="AppContent"
                            Grid.Row="1"
                            Background="{DynamicResource BackgroundSecondaryBrush}">
                        <Panel>
                            <ContentControl x:Name="PageContentControl"
                                            Content="{Binding CurrentPage}"
                                            Margin="30" />

                            <!-- Unsaved Changes Reminder Banner (overlays on top of page content) -->
                            <Border Classes="popup-banner"
                                    Background="{DynamicResource WarningBrush}"
                                    helpers:BannerAnimationBehavior.IsEnabled="True"
                                    helpers:BannerAnimationBehavior.IsVisible="{Binding HeaderViewModel.ShowUnsavedChangesReminder}"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Top"
                                    Margin="0,10,0,0"
                                    CornerRadius="6"
                                    Padding="12,8">
                                <Grid ColumnDefinitions="Auto,*,Auto">
                                    <PathIcon Grid.Column="0"
                                              Data="{x:Static icons:Icons.WarningCircle}"
                                              Width="16" Height="16"
                                              Foreground="White"
                                              VerticalAlignment="Center"
                                              Margin="0,0,10,0" />
                                    <TextBlock Grid.Column="1"
                                               Text="{loc:Loc 'You have unsaved changes. Remember to save your work!'}"
                                               Foreground="White"
                                               FontWeight="Medium"
                                               FontSize="13"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Center" />
                                    <Button Grid.Column="2"
                                            Command="{Binding HeaderViewModel.DismissUnsavedChangesReminderCommand}"
                                            ToolTip.Tip="Dismiss"
                                            Background="{DynamicResource WarningDarkBrush}"
                                            BorderThickness="0"
                                            CornerRadius="4"
                                            Padding="4"
                                            Margin="10,0,0,0"
                                            VerticalAlignment="Center">
                                        <PathIcon Data="{x:Static icons:Icons.Close}"
                                                  Width="12" Height="12"
                                                  Foreground="White" />
                                    </Button>
                                </Grid>
                            </Border>

                            <!-- Update Available Banner -->
                            <controls:InfoBanner ShowBanner="{Binding ShowUpdateAvailableBanner}"
                                                 Message="{Binding UpdateBannerMessage}"
                                                 ActionText="{loc:Loc 'Download now'}"
                                                 ActionCommand="{Binding OpenUpdateModalFromBannerCommand}"
                                                 DismissCommand="{Binding DismissUpdateBannerCommand}"
                                                 IconData="{x:Static icons:Icons.Download}"
                                                 BannerBackground="{DynamicResource InfoBrush}"
                                                 DismissBackground="{DynamicResource InfoDarkBrush}" />
                        </Panel>
                    </Border>
                </Grid>

                <!-- Tutorial Completion Overlay (covers content area but not sidebar) -->
                <controls:TutorialCompletionOverlay />
            </Panel>
        </Grid>

        <!-- Panels at root level (need full window coverage for click-away backdrop) -->

        <!-- Quick Actions Panel -->
        <panels:QuickActionsPanel DataContext="{Binding QuickActionsViewModel}" />

        <!-- File Menu Panel -->
        <panels:FileMenuPanel DataContext="{Binding FileMenuPanelViewModel}" />

        <!-- Notification Panel -->
        <panels:NotificationPanel DataContext="{Binding NotificationPanelViewModel}" />

        <!-- User Panel -->
        <panels:UserPanel DataContext="{Binding UserPanelViewModel}" />

        <!-- Help Panel -->
        <panels:HelpPanel DataContext="{Binding HelpPanelViewModel}" />

        <!-- Company Switcher Panel (positioned relative to sidebar) -->
        <panels:CompanySwitcherPanel DataContext="{Binding CompanySwitcherPanelViewModel}" />

        <!-- Profile Modal -->
        <modals:ProfileModal DataContext="{Binding ProfileModalViewModel}" />

        <!-- Upgrade Modal -->
        <modals:UpgradeModal DataContext="{Binding UpgradeModalViewModel}" />

        <!-- Note: CreateCompanyWizard is now at MainWindow level for full-screen overlay -->

        <!-- Settings Modal -->
        <modals:SettingsModal DataContext="{Binding SettingsModalViewModel}" />

        <!-- Check for Update Modal -->
        <modals:CheckForUpdateModal DataContext="{Binding CheckForUpdateModalViewModel}" />

        <!-- Prediction Info Modal -->
        <modals:PredictionInfoModal DataContext="{Binding PredictionInfoModalViewModel}" />

        <!-- Past Predictions Modal -->
        <modals:PastPredictionsModal DataContext="{Binding PastPredictionsModalViewModel}" />

        <!-- Import Modal -->
        <modals:ImportModal DataContext="{Binding ImportModalViewModel}" />

        <!-- Import Validation Dialog -->
        <modals:ImportValidationDialog DataContext="{Binding ImportValidationDialogViewModel}" />

        <!-- Export As Modal -->
        <modals:ExportAsModal DataContext="{Binding ExportAsModalViewModel}" />

        <!-- Switch Account Modal -->
        <modals:SwitchAccountModal DataContext="{Binding SwitchAccountModalViewModel}" />

        <!-- Login Modal -->
        <modals:LoginModal DataContext="{Binding LoginModalViewModel}" />

        <!-- Note: PasswordPromptModal is now at MainWindow level to appear above WelcomeScreen -->

        <!-- Edit Company Modal -->
        <modals:EditCompanyModal DataContext="{Binding EditCompanyModalViewModel}" />

        <!-- Customer Modals -->
        <modals:CustomerModals DataContext="{Binding CustomerModalsViewModel}" />

        <!-- Product Modals -->
        <modals:ProductModals DataContext="{Binding ProductModalsViewModel}" />

        <!-- Category Modals -->
        <modals:CategoryModals DataContext="{Binding CategoryModalsViewModel}" />

        <!-- Department Modals -->
        <modals:DepartmentModals DataContext="{Binding DepartmentModalsViewModel}" />

        <!-- Supplier Modals -->
        <modals:SupplierModals DataContext="{Binding SupplierModalsViewModel}" />

        <!-- Rental Inventory Modals -->
        <modals:RentalInventoryModals DataContext="{Binding RentalInventoryModalsViewModel}" />

        <!-- Rental Records Modals -->
        <modals:RentalRecordsModals DataContext="{Binding RentalRecordsModalsViewModel}" />

        <!-- Payment Modals -->
        <modals:PaymentModals DataContext="{Binding PaymentModalsViewModel}" />

        <!-- Invoice Modals -->
        <modals:InvoiceModals DataContext="{Binding InvoiceModalsViewModel}" />

        <!-- Invoice Template Designer Modal -->
        <modals:InvoiceTemplateDesignerModal DataContext="{Binding InvoiceTemplateDesignerViewModel}" />

        <!-- Expense Modals -->
        <modals:ExpenseModals DataContext="{Binding ExpenseModalsViewModel}" />

        <!-- Revenue Modals -->
        <modals:RevenueModals DataContext="{Binding RevenueModalsViewModel}" />

        <!-- Stock Levels Modals -->
        <modals:StockLevelsModals DataContext="{Binding StockLevelsModalsViewModel}" />

        <!-- Locations Modals -->
        <modals:LocationsModals DataContext="{Binding LocationsModalsViewModel}" />

        <!-- Stock Adjustments Modals -->
        <modals:StockAdjustmentsModals DataContext="{Binding StockAdjustmentsModalsViewModel}" />

        <!-- Purchase Orders Modals -->
        <modals:PurchaseOrdersModals DataContext="{Binding PurchaseOrdersModalsViewModel}" />

        <!-- Receipts Modals -->
        <modals:ReceiptsModals DataContext="{Binding ReceiptsModalsViewModel}" />

        <!-- Lost/Damaged Modals -->
        <modals:LostDamagedModals DataContext="{Binding LostDamagedModalsViewModel}" />

        <!-- Returns Modals -->
        <modals:ReturnsModals DataContext="{Binding ReturnsModalsViewModel}" />

        <!-- Report Modals -->
        <modals:ReportModals DataContext="{Binding ReportModalsViewModel}" />

        <!-- Unsaved Changes Dialog -->
        <modals:UnsavedChangesDialog DataContext="{Binding UnsavedChangesDialogViewModel}" />

        <!-- Version History Modal -->
        <modals:VersionHistoryModal DataContext="{Binding VersionHistoryModalViewModel}" />

        <!-- Quick Actions Settings Modal -->
        <modals:QuickActionsSettingsModal DataContext="{Binding QuickActionsSettingsModalViewModel}" />
    </Panel>
</UserControl>
