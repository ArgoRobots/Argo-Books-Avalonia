<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="200" d:DesignHeight="150"
             x:Class="ArgoBooks.Controls.Reports.CanvasElementControl"
             x:Name="ElementControl"
             Background="Transparent"
             ClipToBounds="False">

    <UserControl.Styles>
        <!-- Selection border style -->
        <Style Selector="Border.selection-border">
            <Setter Property="BorderBrush" Value="#2196F3"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="CornerRadius" Value="2"/>
        </Style>

        <!-- Hover border style -->
        <Style Selector="Border.hover-border">
            <Setter Property="BorderBrush" Value="#90CAF9"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderDashArray" Value="4,2"/>
        </Style>

        <!-- Resize handle style -->
        <Style Selector="Border.resize-handle">
            <Setter Property="Width" Value="10"/>
            <Setter Property="Height" Value="10"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#2196F3"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="1"/>
            <Setter Property="BoxShadow" Value="0 1 3 0 #40000000"/>
        </Style>

        <!-- Drag handle style (center) -->
        <Style Selector="Border.drag-handle">
            <Setter Property="Width" Value="24"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="Background" Value="#E3F2FD"/>
            <Setter Property="BorderBrush" Value="#2196F3"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Opacity" Value="0.8"/>
        </Style>
    </UserControl.Styles>

    <Grid>
        <!-- Main content area -->
        <Border x:Name="ContentBorder"
                Background="{Binding ElementBackground, RelativeSource={RelativeSource AncestorType=UserControl}}"
                CornerRadius="2">
            <ContentPresenter x:Name="ContentArea"
                              Content="{Binding ElementContent, RelativeSource={RelativeSource AncestorType=UserControl}}"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Stretch"/>
        </Border>

        <!-- Hover indicator (shown when mouse is over but not selected) -->
        <Border x:Name="HoverBorder"
                Classes="hover-border"
                IsVisible="False"
                IsHitTestVisible="False"/>

        <!-- Selection border (shown when selected) -->
        <Border x:Name="SelectionBorder"
                Classes="selection-border"
                IsVisible="False"
                IsHitTestVisible="False"/>

        <!-- Resize handles (shown when selected) -->
        <Canvas x:Name="ResizeHandlesCanvas"
                IsVisible="False"
                ClipToBounds="False">

            <!-- Top-Left handle -->
            <Border x:Name="HandleTopLeft"
                    Classes="resize-handle"
                    Cursor="TopLeftCorner"
                    PointerPressed="OnResizeHandlePointerPressed"
                    Tag="TopLeft"/>

            <!-- Top-Center handle -->
            <Border x:Name="HandleTop"
                    Classes="resize-handle"
                    Cursor="SizeNorthSouth"
                    PointerPressed="OnResizeHandlePointerPressed"
                    Tag="Top"/>

            <!-- Top-Right handle -->
            <Border x:Name="HandleTopRight"
                    Classes="resize-handle"
                    Cursor="TopRightCorner"
                    PointerPressed="OnResizeHandlePointerPressed"
                    Tag="TopRight"/>

            <!-- Middle-Left handle -->
            <Border x:Name="HandleLeft"
                    Classes="resize-handle"
                    Cursor="SizeWestEast"
                    PointerPressed="OnResizeHandlePointerPressed"
                    Tag="Left"/>

            <!-- Middle-Right handle -->
            <Border x:Name="HandleRight"
                    Classes="resize-handle"
                    Cursor="SizeWestEast"
                    PointerPressed="OnResizeHandlePointerPressed"
                    Tag="Right"/>

            <!-- Bottom-Left handle -->
            <Border x:Name="HandleBottomLeft"
                    Classes="resize-handle"
                    Cursor="BottomLeftCorner"
                    PointerPressed="OnResizeHandlePointerPressed"
                    Tag="BottomLeft"/>

            <!-- Bottom-Center handle -->
            <Border x:Name="HandleBottom"
                    Classes="resize-handle"
                    Cursor="SizeNorthSouth"
                    PointerPressed="OnResizeHandlePointerPressed"
                    Tag="Bottom"/>

            <!-- Bottom-Right handle -->
            <Border x:Name="HandleBottomRight"
                    Classes="resize-handle"
                    Cursor="BottomRightCorner"
                    PointerPressed="OnResizeHandlePointerPressed"
                    Tag="BottomRight"/>
        </Canvas>

        <!-- Element type indicator (top-left corner) -->
        <Border x:Name="TypeIndicator"
                HorizontalAlignment="Left"
                VerticalAlignment="Top"
                Margin="-1,-18,0,0"
                Padding="4,2"
                Background="#2196F3"
                CornerRadius="2,2,0,0"
                IsVisible="False"
                IsHitTestVisible="False">
            <TextBlock x:Name="TypeText"
                       FontSize="10"
                       Foreground="White"
                       Text="{Binding ElementTypeName, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
        </Border>

        <!-- Lock indicator (shown when element is locked) -->
        <Border x:Name="LockIndicator"
                HorizontalAlignment="Right"
                VerticalAlignment="Top"
                Margin="0,-18,-1,0"
                Padding="4,2"
                Background="#FF9800"
                CornerRadius="2,2,0,0"
                IsVisible="False"
                IsHitTestVisible="False">
            <PathIcon Width="12" Height="12"
                      Foreground="White"
                      Data="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z"/>
        </Border>
    </Grid>
</UserControl>
