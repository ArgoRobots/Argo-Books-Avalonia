<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:ArgoBooks.ViewModels"
             xmlns:controls="using:ArgoBooks.Controls"
             xmlns:modals="using:ArgoBooks.Modals"
             xmlns:lvc="using:LiveChartsCore.SkiaSharpView.Avalonia"
             xmlns:loc="using:ArgoBooks.Localization"
             mc:Ignorable="d" d:DesignWidth="1400" d:DesignHeight="900"
             x:Class="ArgoBooks.Views.AnalyticsPage"
             x:DataType="vm:AnalyticsPageViewModel">

    <Design.DataContext>
        <vm:AnalyticsPageViewModel />
    </Design.DataContext>

    <Panel>
        <Grid RowDefinitions="Auto,*">
        <!-- Header Bar with Date Range and Tabs -->
        <Border Grid.Row="0"
                Background="{DynamicResource SurfaceBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="0,0,0,1"
                ClipToBounds="False">
            <Grid RowDefinitions="Auto,Auto" ClipToBounds="False">
                <!-- Top Row: Date Range Selector -->
                <Border Grid.Row="0"
                        Padding="24,16"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="0,0,0,1">
                    <Grid ColumnDefinitions="*,Auto,Auto">
                        <!-- Page Title -->
                        <TextBlock Grid.Column="0"
                                   Text="{loc:Loc Analytics}"
                                   FontSize="20"
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                   VerticalAlignment="Center" />

                        <!-- Chart Type Selector -->
                        <controls:ChartTypeSelector Grid.Column="1"
                                                    VerticalAlignment="Top"
                                                    Margin="0,0,16,0"
                                                    IsVisible="{Binding !IsGeographicTabSelected}" />

                        <!-- Date Range Controls -->
                        <controls:DateRangeSelector Grid.Column="2" VerticalAlignment="Top" />
                    </Grid>
                </Border>

                <!-- Tab Bar -->
                <Grid Grid.Row="1" ClipToBounds="False">
                    <!-- Analytics Tabs -->
                    <TabControl SelectedIndex="{Binding SelectedTabIndex}"
                                Classes="page-tabs">
                        <TabItem Header="{loc:Loc Dashboard}" />
                        <TabItem Header="{loc:Loc Geographic}" />
                        <TabItem Header="{loc:Loc Operational}" IsVisible="False" />
                        <TabItem Header="{loc:Loc Performance}" />
                        <TabItem Header="{loc:Loc Customers}" />
                        <TabItem Header="{loc:Loc Returns}" />
                        <TabItem Header="{loc:Loc Losses}" />
                    </TabControl>
                </Grid>
            </Grid>
        </Border>

        <!-- Main Content Area -->
        <ScrollViewer Grid.Row="1"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled"
                      Background="{DynamicResource BackgroundSecondaryBrush}">
            <Panel>
                <!-- Dashboard Tab Content -->
                <StackPanel Margin="24" Spacing="24"
                            IsVisible="{Binding IsDashboardTabSelected}">
                    <!-- Statistics Cards Row -->
                    <controls:StatCardsRow>
                        <controls:StatCard Label="{loc:Loc 'Total Purchases'}"
                                           Value="{Binding TotalPurchases}"
                                           Icon="M19 14V6c0-1.1-.9-2-2-2H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zm-9-1c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm13-6v11c0 1.1-.9 2-2 2H4v-2h17V7h2z"
                                           IconColor="Danger"
                                           ChangeValue="{Binding PurchasesChangeValue}"
                                           ChangeText="{Binding PurchasesChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                        <controls:StatCard Label="{loc:Loc 'Total Sales'}"
                                           Value="{Binding TotalRevenue}"
                                           Icon="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z"
                                           IconColor="Success"
                                           ChangeValue="{Binding RevenueChangeValue}"
                                           ChangeText="{Binding RevenueChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                        <controls:StatCard Label="{loc:Loc 'Net Profit'}"
                                           Value="{Binding NetProfit}"
                                           Icon="M11 17h2v-6h-2v6zm1-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 9h2V7h-2v2z"
                                           IconColor="Primary"
                                           ChangeValue="{Binding ProfitChangeValue}"
                                           ChangeText="{Binding ProfitChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                        <controls:StatCard Label="{loc:Loc 'Profit Margin'}"
                                           Value="{Binding ProfitMargin}"
                                           Icon="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"
                                           IconColor="Info"
                                           ChangeValue="{Binding ProfitMarginChangeValue}"
                                           ChangeText="{Binding ProfitMarginChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                    </controls:StatCardsRow>

                    <!-- Charts Row 1: Profit Analysis -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Profit Trends Chart -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Chart with data -->
                                <lvc:CartesianChart Title="{Binding ProfitOverTimeTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                    Series="{Binding ProfitTrendsSeries}"
                                                    XAxes="{Binding ProfitTrendsXAxes}"
                                                    YAxes="{Binding ProfitTrendsYAxes}"
                                                    ZoomMode="Both"
                                                    IsVisible="{Binding HasProfitTrendsData}" />
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasProfitTrendsData}"
                                    DefaultMessage="{loc:Loc 'No profit data available'}"
                                    ShowDateRangeMessage="{Binding ShowFinancialDateRangeMessage}" />
                            </Panel>
                        </Border>

                        <!-- Sales vs Expenses Chart -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Chart with data -->
                                <lvc:CartesianChart Title="{Binding RevenueVsExpensesTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                    Series="{Binding RevenueVsExpensesSeries}"
                                                    XAxes="{Binding RevenueVsExpensesXAxes}"
                                                    YAxes="{Binding RevenueVsExpensesYAxes}"
                                                    ZoomMode="Both"
                                                    IsVisible="{Binding HasRevenueVsExpensesData}" />
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasRevenueVsExpensesData}"
                                    DefaultMessage="{loc:Loc 'No comparison data available'}"
                                    ShowDateRangeMessage="{Binding ShowFinancialDateRangeMessage}" />
                            </Panel>
                        </Border>
                    </Grid>

                    <!-- Charts Row 2: Sales -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Sales Trends Chart -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Chart with data -->
                                <lvc:CartesianChart Title="{Binding RevenueTrendsTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                    Series="{Binding RevenueTrendsSeries}"
                                                    XAxes="{Binding RevenueTrendsXAxes}"
                                                    YAxes="{Binding RevenueTrendsYAxes}"
                                                    ZoomMode="Both"
                                                    IsVisible="{Binding HasRevenueTrendsData}" />
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasRevenueTrendsData}"
                                    DefaultMessage="{loc:Loc 'No revenue data available'}"
                                    ShowDateRangeMessage="{Binding ShowRevenueDateRangeMessage}" />
                            </Panel>
                        </Border>

                        <!-- Revenue Distribution Chart -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Pie Chart with custom legend -->
                                <Grid RowDefinitions="Auto,*" IsVisible="{Binding HasRevenueDistributionData}">
                                    <TextBlock Grid.Row="0"
                                               Text="{loc:Loc 'Revenue Distribution'}"
                                               HorizontalAlignment="Center"
                                               FontSize="16"
                                               FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               Margin="0,8,0,4" />
                                    <Grid Grid.Row="1" ColumnDefinitions="*,Auto">
                                        <lvc:PieChart Grid.Column="0"
                                                      PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                      Series="{Binding RevenueDistributionSeries}"
                                                      LegendPosition="Hidden" />
                                        <controls:PieChartLegend Grid.Column="1"
                                                                 PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                                 Items="{Binding RevenueDistributionLegend}"
                                                                 MaxHeightOverride="240"
                                                                 Width="200"
                                                                 Margin="8,0,0,0"
                                                                 VerticalAlignment="Center" />
                                    </Grid>
                                </Grid>
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasRevenueDistributionData}"
                                    DefaultMessage="{loc:Loc 'No distribution data available'}"
                                    ShowDateRangeMessage="{Binding ShowRevenueDateRangeMessage}" />
                            </Panel>
                        </Border>
                    </Grid>

                    <!-- Charts Row 3: Purchases -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Purchase Trends Chart -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Chart with data -->
                                <lvc:CartesianChart Title="{Binding ExpenseTrendsTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                    Series="{Binding ExpensesTrendsSeries}"
                                                    XAxes="{Binding ExpensesTrendsXAxes}"
                                                    YAxes="{Binding ExpensesTrendsYAxes}"
                                                    ZoomMode="Both"
                                                    IsVisible="{Binding HasExpensesTrendsData}" />
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasExpensesTrendsData}"
                                    DefaultMessage="{loc:Loc 'No expense data available'}"
                                    ShowDateRangeMessage="{Binding ShowExpenseDateRangeMessage}" />
                            </Panel>
                        </Border>

                        <!-- Expense Distribution Chart -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Pie Chart with custom legend -->
                                <Grid RowDefinitions="Auto,*" IsVisible="{Binding HasExpensesDistributionData}">
                                    <TextBlock Grid.Row="0"
                                               Text="{loc:Loc 'Expense Distribution'}"
                                               HorizontalAlignment="Center"
                                               FontSize="16"
                                               FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               Margin="0,8,0,4" />
                                    <Grid Grid.Row="1" ColumnDefinitions="*,Auto">
                                        <lvc:PieChart Grid.Column="0"
                                                      PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                      Series="{Binding ExpensesDistributionSeries}"
                                                      LegendPosition="Hidden" />
                                        <controls:PieChartLegend Grid.Column="1"
                                                                 PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                                 Items="{Binding ExpensesDistributionLegend}"
                                                                 MaxHeightOverride="240"
                                                                 Width="200"
                                                                 Margin="8,0,0,0"
                                                                 VerticalAlignment="Center" />
                                    </Grid>
                                </Grid>
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasExpensesDistributionData}"
                                    DefaultMessage="{loc:Loc 'No distribution data available'}"
                                    ShowDateRangeMessage="{Binding ShowExpenseDateRangeMessage}" />
                            </Panel>
                        </Border>
                    </Grid>
                </StackPanel>

                <!-- Geographic Tab Content -->
                <StackPanel Margin="24" Spacing="24"
                            IsVisible="{Binding IsGeographicTabSelected}">
                    <!-- Row 1: Countries/Companies of Origin -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Countries of Origin Chart -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Pie Chart with custom legend -->
                                <Grid RowDefinitions="Auto,*" IsVisible="{Binding HasCountriesOfOriginData}">
                                    <TextBlock Grid.Row="0"
                                               Text="{loc:Loc 'Countries of Origin'}"
                                               HorizontalAlignment="Center"
                                               FontSize="16"
                                               FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               Margin="0,8,0,4" />
                                    <Grid Grid.Row="1" ColumnDefinitions="*,Auto">
                                        <lvc:PieChart Grid.Column="0"
                                                      PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                      Series="{Binding CountriesOfOriginSeries}"
                                                      LegendPosition="Hidden" />
                                        <controls:PieChartLegend Grid.Column="1"
                                                                 PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                                 Items="{Binding CountriesOfOriginLegend}"
                                                                 MaxHeightOverride="240"
                                                                 Width="200"
                                                                 Margin="8,0,0,0"
                                                                 VerticalAlignment="Center" />
                                    </Grid>
                                </Grid>
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasCountriesOfOriginData}"
                                    DefaultMessage="{loc:Loc 'No country data available'}"
                                    ShowDateRangeMessage="{Binding ShowRevenueDateRangeMessage}" />
                            </Panel>
                        </Border>

                        <!-- Companies of Origin Chart -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Pie Chart with custom legend -->
                                <Grid RowDefinitions="Auto,*" IsVisible="{Binding HasCompaniesOfOriginData}">
                                    <TextBlock Grid.Row="0"
                                               Text="{loc:Loc 'Companies of Origin'}"
                                               HorizontalAlignment="Center"
                                               FontSize="16"
                                               FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               Margin="0,8,0,4" />
                                    <Grid Grid.Row="1" ColumnDefinitions="*,Auto">
                                        <lvc:PieChart Grid.Column="0"
                                                      PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                      Series="{Binding CompaniesOfOriginSeries}"
                                                      LegendPosition="Hidden" />
                                        <controls:PieChartLegend Grid.Column="1"
                                                                 PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                                 Items="{Binding CompaniesOfOriginLegend}"
                                                                 MaxHeightOverride="240"
                                                                 Width="200"
                                                                 Margin="8,0,0,0"
                                                                 VerticalAlignment="Center" />
                                    </Grid>
                                </Grid>
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasCompaniesOfOriginData}"
                                    DefaultMessage="{loc:Loc 'No company data available'}"
                                    ShowDateRangeMessage="{Binding ShowRevenueDateRangeMessage}" />
                            </Panel>
                        </Border>
                    </Grid>

                    <!-- Row 2: Countries/Companies of Destination -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Countries of Destination Chart -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Pie Chart with custom legend -->
                                <Grid RowDefinitions="Auto,*" IsVisible="{Binding HasCountriesOfDestinationData}">
                                    <TextBlock Grid.Row="0"
                                               Text="{loc:Loc 'Countries of Destination'}"
                                               HorizontalAlignment="Center"
                                               FontSize="16"
                                               FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               Margin="0,8,0,4" />
                                    <Grid Grid.Row="1" ColumnDefinitions="*,Auto">
                                        <lvc:PieChart Grid.Column="0"
                                                      PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                      Series="{Binding CountriesOfDestinationSeries}"
                                                      LegendPosition="Hidden" />
                                        <controls:PieChartLegend Grid.Column="1"
                                                                 PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                                 Items="{Binding CountriesOfDestinationLegend}"
                                                                 MaxHeightOverride="240"
                                                                 Width="200"
                                                                 Margin="8,0,0,0"
                                                                 VerticalAlignment="Center" />
                                    </Grid>
                                </Grid>
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasCountriesOfDestinationData}"
                                    DefaultMessage="{loc:Loc 'No destination data available'}"
                                    ShowDateRangeMessage="{Binding ShowExpenseDateRangeMessage}" />
                            </Panel>
                        </Border>

                        <!-- Companies of Destination Chart -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Pie Chart with custom legend -->
                                <Grid RowDefinitions="Auto,*" IsVisible="{Binding HasCompaniesOfDestinationData}">
                                    <TextBlock Grid.Row="0"
                                               Text="{loc:Loc 'Companies of Destination'}"
                                               HorizontalAlignment="Center"
                                               FontSize="16"
                                               FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               Margin="0,8,0,4" />
                                    <Grid Grid.Row="1" ColumnDefinitions="*,Auto">
                                        <lvc:PieChart Grid.Column="0"
                                                      PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                      Series="{Binding CompaniesOfDestinationSeries}"
                                                      LegendPosition="Hidden" />
                                        <controls:PieChartLegend Grid.Column="1"
                                                                 PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                                 Items="{Binding CompaniesOfDestinationLegend}"
                                                                 MaxHeightOverride="240"
                                                                 Width="200"
                                                                 Margin="8,0,0,0"
                                                                 VerticalAlignment="Center" />
                                    </Grid>
                                </Grid>
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasCompaniesOfDestinationData}"
                                    DefaultMessage="{loc:Loc 'No company data available'}"
                                    ShowDateRangeMessage="{Binding ShowRevenueDateRangeMessage}" />
                            </Panel>
                        </Border>
                    </Grid>

                    <!-- Row 3: World Map (Full Width) -->
                    <Border Background="{DynamicResource SurfaceBrush}"
                            BorderBrush="{DynamicResource BorderBrush}"
                            BorderThickness="1"
                            CornerRadius="12"
                            Height="550">
                        <Grid RowDefinitions="Auto,*">
                            <Border Grid.Row="0"
                                    Padding="20,16"
                                    BorderBrush="{DynamicResource BorderBrush}"
                                    BorderThickness="0,0,0,1">
                                <Grid ColumnDefinitions="*,Auto">
                                    <TextBlock Grid.Column="0"
                                               Text="{loc:Loc 'World Map Overview'}"
                                               FontSize="16"
                                               FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               VerticalAlignment="Center" />
                                    <!-- Origin/Destination Toggle -->
                                    <Border Grid.Column="1"
                                            Background="{DynamicResource SurfaceAltBrush}"
                                            CornerRadius="6"
                                            Padding="4">
                                        <StackPanel Orientation="Horizontal" Spacing="4">
                                            <RadioButton Content="{loc:Loc Origin}"
                                                         GroupName="MapMode"
                                                         IsChecked="{Binding IsMapModeOrigin}"
                                                         Classes="segmented-button" />
                                            <RadioButton Content="{loc:Loc Destination}"
                                                         GroupName="MapMode"
                                                         IsChecked="{Binding IsMapModeDestination}"
                                                         Classes="segmented-button" />
                                        </StackPanel>
                                    </Border>
                                </Grid>
                            </Border>
                            <Border Grid.Row="1" Padding="10">
                                <Panel>
                                    <!-- Origin GeoMap (supplier countries from purchases) -->
                                    <lvc:GeoMap Series="{Binding OriginGeoMapSeries}"
                                                MapProjection="Mercator"
                                                IsVisible="{Binding IsMapModeOrigin}"
                                                PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased" />
                                    <!-- Destination GeoMap (customer countries from sales) -->
                                    <lvc:GeoMap Series="{Binding DestinationGeoMapSeries}"
                                                MapProjection="Mercator"
                                                IsVisible="{Binding IsMapModeDestination}"
                                                PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased" />
                                    <!-- No data message for Origin (only show when in origin mode AND no data) -->
                                    <controls:ChartEmptyState
                                        DefaultMessage="{loc:Loc 'No origin data available'}"
                                        ShowDateRangeMessage="{Binding ShowExpenseDateRangeMessage}">
                                        <controls:ChartEmptyState.IsVisible>
                                            <MultiBinding Converter="{x:Static BoolConverters.And}">
                                                <Binding Path="IsMapModeOrigin" />
                                                <Binding Path="!HasOriginMapData" />
                                            </MultiBinding>
                                        </controls:ChartEmptyState.IsVisible>
                                    </controls:ChartEmptyState>
                                    <!-- No data message for Destination (only show when in destination mode AND no data) -->
                                    <controls:ChartEmptyState
                                        DefaultMessage="{loc:Loc 'No destination data available'}"
                                        ShowDateRangeMessage="{Binding ShowRevenueDateRangeMessage}">
                                        <controls:ChartEmptyState.IsVisible>
                                            <MultiBinding Converter="{x:Static BoolConverters.And}">
                                                <Binding Path="IsMapModeDestination" />
                                                <Binding Path="!HasDestinationMapData" />
                                            </MultiBinding>
                                        </controls:ChartEmptyState.IsVisible>
                                    </controls:ChartEmptyState>
                                </Panel>
                            </Border>
                        </Grid>
                    </Border>
                </StackPanel>

                <!-- Operational Tab Content -->
                <StackPanel Margin="24" Spacing="24"
                            IsVisible="{Binding IsOperationalTabSelected}">
                    <!-- Statistics Cards Row -->
                    <controls:StatCardsRow>
                        <controls:StatCard Label="{loc:Loc 'Active Accountants'}"
                                           Value="{Binding ActiveAccountants}"
                                           Icon="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
                                           IconColor="Primary" />
                        <controls:StatCard Label="{loc:Loc 'Transactions Processed'}"
                                           Value="{Binding TransactionsProcessed}"
                                           Icon="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm7 13H5v-.23c0-.62.28-1.2.76-1.58C7.47 15.82 9.64 15 12 15s4.53.82 6.24 2.19c.48.38.76.97.76 1.58V19z"
                                           IconColor="Success"
                                           ChangeValue="{Binding TransactionsChangeValue}"
                                           ChangeText="{Binding TransactionsChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                        <controls:StatCard Label="{loc:Loc 'Avg Processing Time'}"
                                           Value="{Binding AvgProcessingTime}"
                                           Icon="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"
                                           IconColor="Warning"
                                           ChangeValue="{Binding ProcessingTimeChangeValue}"
                                           ChangeText="{Binding ProcessingTimeChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                        <controls:StatCard Label="{loc:Loc 'Accuracy Rate'}"
                                           Value="{Binding AccuracyRate}"
                                           Icon="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"
                                           IconColor="Info"
                                           ChangeValue="{Binding AccuracyChangeValue}"
                                           ChangeText="{Binding AccuracyChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                    </controls:StatCardsRow>

                    <!-- Charts -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Transactions by Accountant -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Pie Chart with custom legend -->
                                <Grid RowDefinitions="Auto,*" IsVisible="{Binding HasAccountantsTransactionsData}">
                                    <TextBlock Grid.Row="0"
                                               Text="{loc:Loc 'Transactions by Accountant'}"
                                               HorizontalAlignment="Center"
                                               FontSize="16"
                                               FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               Margin="0,8,0,4" />
                                    <Grid Grid.Row="1" ColumnDefinitions="*,Auto">
                                        <lvc:PieChart Grid.Column="0"
                                                      PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                      Series="{Binding AccountantsTransactionsSeries}"
                                                      LegendPosition="Hidden" />
                                        <controls:PieChartLegend Grid.Column="1"
                                                                 PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                                 Items="{Binding AccountantsTransactionsLegend}"
                                                                 MaxHeightOverride="240"
                                                                 Width="200"
                                                                 Margin="8,0,0,0"
                                                                 VerticalAlignment="Center" />
                                    </Grid>
                                </Grid>
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasAccountantsTransactionsData}"
                                    DefaultMessage="{loc:Loc 'No accountant data available'}"
                                    ShowDateRangeMessage="{Binding ShowFinancialDateRangeMessage}" />
                            </Panel>
                        </Border>

                        <!-- Workload Distribution -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Chart with data -->
                                <lvc:CartesianChart Title="{Binding WorkloadDistributionTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                    Series="{Binding TotalTransactionsSeries}"
                                                    XAxes="{Binding TotalTransactionsXAxes}"
                                                    YAxes="{Binding TotalTransactionsYAxes}"
                                                    ZoomMode="Both"
                                                    IsVisible="{Binding HasTotalTransactionsData}" />
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasTotalTransactionsData}"
                                    DefaultMessage="{loc:Loc 'No transaction data available'}"
                                    ShowDateRangeMessage="{Binding ShowFinancialDateRangeMessage}" />
                            </Panel>
                        </Border>
                    </Grid>
                </StackPanel>

                <!-- Performance Tab Content -->
                <StackPanel Margin="24" Spacing="24"
                            IsVisible="{Binding IsPerformanceTabSelected}">
                    <!-- Statistics Cards Row -->
                    <controls:StatCardsRow>
                        <controls:StatCard Label="{loc:Loc 'Revenue Growth'}"
                                           Value="{Binding RevenueGrowth}"
                                           Icon="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"
                                           IconColor="Success"
                                           ChangeValue="{Binding RevenueGrowthChangeValue}"
                                           ChangeText="{Binding RevenueGrowthChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                        <controls:StatCard Label="{loc:Loc 'Total Transactions'}"
                                           Value="{Binding TotalTransactions}"
                                           Icon="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm7 13H5v-.23c0-.62.28-1.2.76-1.58C7.47 15.82 9.64 15 12 15s4.53.82 6.24 2.19c.48.38.76.97.76 1.58V19z"
                                           IconColor="Primary"
                                           ChangeValue="{Binding TotalTransactionsChangeValue}"
                                           ChangeText="{Binding TotalTransactionsChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                        <controls:StatCard Label="{loc:Loc 'Avg Transaction Value'}"
                                           Value="{Binding AvgTransactionValue}"
                                           Icon="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z"
                                           IconColor="Info"
                                           ChangeValue="{Binding AvgTransactionChangeValue}"
                                           ChangeText="{Binding AvgTransactionChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                        <controls:StatCard Label="{loc:Loc 'Avg Shipping Cost'}"
                                           Value="{Binding AvgShippingCost}"
                                           Icon="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm13.5-9l1.96 2.5H17V9.5h2.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"
                                           IconColor="Warning"
                                           ChangeValue="{Binding AvgShippingChangeValue}"
                                           ChangeText="{Binding AvgShippingChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                    </controls:StatCardsRow>

                    <!-- Charts Row 1 -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Average Transaction Value -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Chart with data -->
                                <lvc:CartesianChart Title="{Binding AverageTransactionValueTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                    Series="{Binding AvgTransactionValueSeries}"
                                                    XAxes="{Binding AvgTransactionValueXAxes}"
                                                    YAxes="{Binding AvgTransactionValueYAxes}"
                                                    ZoomMode="Both"
                                                    IsVisible="{Binding HasAvgTransactionValueData}" />
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasAvgTransactionValueData}"
                                    DefaultMessage="{loc:Loc 'No transaction data available'}"
                                    ShowDateRangeMessage="{Binding ShowFinancialDateRangeMessage}" />
                            </Panel>
                        </Border>

                        <!-- Total Transactions Over Time -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Chart with data -->
                                <lvc:CartesianChart Title="{Binding TotalTransactionsTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                    Series="{Binding TotalTransactionsSeries}"
                                                    XAxes="{Binding TotalTransactionsXAxes}"
                                                    YAxes="{Binding TotalTransactionsYAxes}"
                                                    ZoomMode="Both"
                                                    IsVisible="{Binding HasTotalTransactionsData}" />
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasTotalTransactionsData}"
                                    DefaultMessage="{loc:Loc 'No transaction data available'}"
                                    ShowDateRangeMessage="{Binding ShowFinancialDateRangeMessage}" />
                            </Panel>
                        </Border>
                    </Grid>

                    <!-- Charts Row 2 -->
                    <Grid ColumnDefinitions="*" Height="300">
                        <!-- Average Shipping Costs -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10">
                            <Panel>
                                <!-- Chart with data -->
                                <lvc:CartesianChart Title="{Binding AverageShippingCostsTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                    Series="{Binding AvgShippingCostsSeries}"
                                                    XAxes="{Binding AvgShippingCostsXAxes}"
                                                    YAxes="{Binding AvgShippingCostsYAxes}"
                                                    ZoomMode="Both"
                                                    IsVisible="{Binding HasAvgShippingCostsData}" />
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasAvgShippingCostsData}"
                                    DefaultMessage="{loc:Loc 'No shipping data available'}"
                                    ShowDateRangeMessage="{Binding ShowFinancialDateRangeMessage}" />
                            </Panel>
                        </Border>
                    </Grid>
                </StackPanel>

                <!-- Customers Tab Content -->
                <StackPanel Margin="24" Spacing="24"
                            IsVisible="{Binding IsCustomersTabSelected}">
                    <!-- Statistics Cards Row -->
                    <controls:StatCardsRow>
                        <controls:StatCard Label="{loc:Loc 'Total Customers'}"
                                           Value="{Binding TotalCustomers}"
                                           Icon="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"
                                           IconColor="Primary"
                                           ChangeValue="{Binding CustomersChangeValue}"
                                           ChangeText="{Binding CustomersChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                        <controls:StatCard Label="{loc:Loc 'New Customers'}"
                                           Value="{Binding NewCustomers}"
                                           Icon="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
                                           IconColor="Success"
                                           ChangeValue="{Binding NewCustomersChangeValue}"
                                           ChangeText="{Binding NewCustomersChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                        <controls:StatCard Label="{loc:Loc 'Retention Rate'}"
                                           Value="{Binding RetentionRate}"
                                           Icon="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
                                           IconColor="Info"
                                           ChangeValue="{Binding RetentionChangeValue}"
                                           ChangeText="{Binding RetentionChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                        <controls:StatCard Label="{loc:Loc 'Avg Customer Value'}"
                                           Value="{Binding AvgCustomerValue}"
                                           Icon="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z"
                                           IconColor="Warning"
                                           ChangeValue="{Binding AvgCustomerValueChangeValue}"
                                           ChangeText="{Binding AvgCustomerValueChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                    </controls:StatCardsRow>

                    <!-- Charts Row 1 -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Top Customers by Revenue -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Pie Chart with custom legend -->
                                <Grid RowDefinitions="Auto,*" IsVisible="{Binding HasCompaniesOfOriginData}">
                                    <TextBlock Grid.Row="0"
                                               Text="{loc:Loc 'Top Customers by Revenue'}"
                                               HorizontalAlignment="Center"
                                               FontSize="16"
                                               FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               Margin="0,8,0,4" />
                                    <Grid Grid.Row="1" ColumnDefinitions="*,Auto">
                                        <lvc:PieChart Grid.Column="0"
                                                      PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                      Series="{Binding CompaniesOfOriginSeries}"
                                                      LegendPosition="Hidden" />
                                        <controls:PieChartLegend Grid.Column="1"
                                                                 PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                                 Items="{Binding CompaniesOfOriginLegend}"
                                                                 MaxHeightOverride="240"
                                                                 Width="200"
                                                                 Margin="8,0,0,0"
                                                                 VerticalAlignment="Center" />
                                    </Grid>
                                </Grid>
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasCompaniesOfOriginData}"
                                    DefaultMessage="{loc:Loc 'No customer data available'}"
                                    ShowDateRangeMessage="{Binding ShowRevenueDateRangeMessage}" />
                            </Panel>
                        </Border>

                        <!-- Customer Payment Status -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Pie Chart with custom legend -->
                                <Grid RowDefinitions="Auto,*" IsVisible="{Binding HasCustomerPaymentStatusData}">
                                    <TextBlock Grid.Row="0"
                                               Text="{loc:Loc 'Customer Payment Status'}"
                                               HorizontalAlignment="Center"
                                               FontSize="16"
                                               FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               Margin="0,8,0,4" />
                                    <Grid Grid.Row="1" ColumnDefinitions="*,Auto">
                                        <lvc:PieChart Grid.Column="0"
                                                      PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                      Series="{Binding CustomerPaymentStatusSeries}"
                                                      LegendPosition="Hidden" />
                                        <controls:PieChartLegend Grid.Column="1"
                                                                 PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                                 Items="{Binding CustomerPaymentStatusLegend}"
                                                                 MaxHeightOverride="240"
                                                                 Width="200"
                                                                 Margin="8,0,0,0"
                                                                 VerticalAlignment="Center" />
                                    </Grid>
                                </Grid>
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasCustomerPaymentStatusData}"
                                    DefaultMessage="{loc:Loc 'No payment data available'}"
                                    ShowDateRangeMessage="{Binding ShowRevenueDateRangeMessage}" />
                            </Panel>
                        </Border>
                    </Grid>

                    <!-- Charts Row 2 -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Customer Growth -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Chart - using Customer Growth -->
                                <lvc:CartesianChart Title="{Binding CustomerGrowthTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                    Series="{Binding CustomerGrowthSeries}"
                                                    XAxes="{Binding CustomerGrowthXAxes}"
                                                    YAxes="{Binding CustomerGrowthYAxes}"
                                                    ZoomMode="Both"
                                                    IsVisible="{Binding HasCustomerGrowthData}" />
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasCustomerGrowthData}"
                                    DefaultMessage="{loc:Loc 'No growth data available'}"
                                    ShowDateRangeMessage="{Binding ShowRevenueDateRangeMessage}" />
                            </Panel>
                        </Border>

                        <!-- Customer Lifetime Value -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Chart - using Avg Transaction Value -->
                                <lvc:CartesianChart Title="{Binding CustomerLifetimeValueTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                    Series="{Binding AvgTransactionValueSeries}"
                                                    XAxes="{Binding AvgTransactionValueXAxes}"
                                                    YAxes="{Binding AvgTransactionValueYAxes}"
                                                    ZoomMode="Both"
                                                    IsVisible="{Binding HasAvgTransactionValueData}" />
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasAvgTransactionValueData}"
                                    DefaultMessage="{loc:Loc 'No value data available'}"
                                    ShowDateRangeMessage="{Binding ShowFinancialDateRangeMessage}" />
                            </Panel>
                        </Border>
                    </Grid>

                    <!-- Charts Row 3 -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Active vs Inactive Customers -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Pie Chart with custom legend -->
                                <Grid RowDefinitions="Auto,*" IsVisible="{Binding HasActiveInactiveCustomersData}">
                                    <TextBlock Grid.Row="0"
                                               Text="{loc:Loc 'Active vs Inactive Customers'}"
                                               HorizontalAlignment="Center"
                                               FontSize="16"
                                               FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               Margin="0,8,0,4" />
                                    <Grid Grid.Row="1" ColumnDefinitions="*,Auto">
                                        <lvc:PieChart Grid.Column="0"
                                                      PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                      Series="{Binding ActiveInactiveCustomersSeries}"
                                                      LegendPosition="Hidden" />
                                        <controls:PieChartLegend Grid.Column="1"
                                                                 PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                                 Items="{Binding ActiveInactiveCustomersLegend}"
                                                                 MaxHeightOverride="240"
                                                                 Width="200"
                                                                 Margin="8,0,0,0"
                                                                 VerticalAlignment="Center" />
                                    </Grid>
                                </Grid>
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasActiveInactiveCustomersData}"
                                    DefaultMessage="{loc:Loc 'No customer activity data'}"
                                    ShowDateRangeMessage="{Binding ShowRevenueDateRangeMessage}" />
                            </Panel>
                        </Border>

                        <!-- Rentals per Customer -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Chart - using Total Transactions -->
                                <lvc:CartesianChart Title="{Binding RentalsPerCustomerTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                    Series="{Binding TotalTransactionsSeries}"
                                                    XAxes="{Binding TotalTransactionsXAxes}"
                                                    YAxes="{Binding TotalTransactionsYAxes}"
                                                    ZoomMode="Both"
                                                    IsVisible="{Binding HasTotalTransactionsData}" />
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasTotalTransactionsData}"
                                    DefaultMessage="{loc:Loc 'No rental data available'}"
                                    ShowDateRangeMessage="{Binding ShowRentalDateRangeMessage}" />
                            </Panel>
                        </Border>
                    </Grid>
                </StackPanel>

                <!-- Returns Tab Content -->
                <StackPanel Margin="24" Spacing="24"
                            IsVisible="{Binding IsReturnsTabSelected}">
                    <!-- Statistics Cards Row -->
                    <controls:StatCardsRow>
                        <controls:StatCard Label="{loc:Loc 'Total Returns'}"
                                           Value="{Binding TotalReturns}"
                                           Icon="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"
                                           IconColor="Warning"
                                           ChangeValue="{Binding ReturnsChangeValue}"
                                           ChangeText="{Binding ReturnsChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                        <controls:StatCard Label="{loc:Loc 'Return Rate'}"
                                           Value="{Binding ReturnRate}"
                                           Icon="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"
                                           IconColor="Info"
                                           ChangeValue="{Binding ReturnRateChangeValue}"
                                           ChangeText="{Binding ReturnRateChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                        <controls:StatCard Label="{loc:Loc 'Financial Impact'}"
                                           Value="{Binding ReturnsFinancialImpact}"
                                           Icon="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z"
                                           IconColor="Danger"
                                           ChangeValue="{Binding ReturnsImpactChangeValue}"
                                           ChangeText="{Binding ReturnsImpactChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                        <controls:StatCard Label="{loc:Loc 'Avg Resolution Time'}"
                                           Value="{Binding AvgResolutionTime}"
                                           Icon="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"
                                           IconColor="Success"
                                           ChangeValue="{Binding ResolutionTimeChangeValue}"
                                           ChangeText="{Binding ResolutionTimeChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                    </controls:StatCardsRow>

                    <!-- Charts Row 1 -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Returns Over Time -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Chart with data -->
                                <lvc:CartesianChart Title="{Binding ReturnsOverTimeTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                    Series="{Binding ReturnsOverTimeSeries}"
                                                    XAxes="{Binding ReturnsOverTimeXAxes}"
                                                    YAxes="{Binding ReturnsOverTimeYAxes}"
                                                    ZoomMode="Both"
                                                    IsVisible="{Binding HasReturnsOverTimeData}" />
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasReturnsOverTimeData}"
                                    DefaultMessage="{loc:Loc 'No returns data available'}"
                                    ShowDateRangeMessage="{Binding ShowReturnDateRangeMessage}" />
                            </Panel>
                        </Border>

                        <!-- Return Reasons -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Pie Chart with custom legend -->
                                <Grid RowDefinitions="Auto,*" IsVisible="{Binding HasReturnReasonsData}">
                                    <TextBlock Grid.Row="0"
                                               Text="{loc:Loc 'Return Reasons'}"
                                               HorizontalAlignment="Center"
                                               FontSize="16"
                                               FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               Margin="0,8,0,4" />
                                    <Grid Grid.Row="1" ColumnDefinitions="*,Auto">
                                        <lvc:PieChart Grid.Column="0"
                                                      PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                      Series="{Binding ReturnReasonsSeries}"
                                                      LegendPosition="Hidden" />
                                        <controls:PieChartLegend Grid.Column="1"
                                                                 PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                                 Items="{Binding ReturnReasonsLegend}"
                                                                 MaxHeightOverride="240"
                                                                 Width="200"
                                                                 Margin="8,0,0,0"
                                                                 VerticalAlignment="Center" />
                                    </Grid>
                                </Grid>
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasReturnReasonsData}"
                                    DefaultMessage="{loc:Loc 'No return reasons data'}"
                                    ShowDateRangeMessage="{Binding ShowReturnDateRangeMessage}" />
                            </Panel>
                        </Border>
                    </Grid>

                    <!-- Charts Row 2 -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Financial Impact of Returns -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Chart with data -->
                                <lvc:CartesianChart Title="{Binding FinancialImpactOfReturnsTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                    Series="{Binding ReturnFinancialImpactSeries}"
                                                    XAxes="{Binding ReturnFinancialImpactXAxes}"
                                                    YAxes="{Binding ReturnFinancialImpactYAxes}"
                                                    ZoomMode="Both"
                                                    IsVisible="{Binding HasReturnFinancialImpactData}" />
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasReturnFinancialImpactData}"
                                    DefaultMessage="{loc:Loc 'No financial impact data'}"
                                    ShowDateRangeMessage="{Binding ShowReturnDateRangeMessage}" />
                            </Panel>
                        </Border>

                        <!-- Returns by Category -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Pie Chart with custom legend -->
                                <Grid RowDefinitions="Auto,*" IsVisible="{Binding HasReturnsByCategoryData}">
                                    <TextBlock Grid.Row="0"
                                               Text="{loc:Loc 'Returns by Category'}"
                                               HorizontalAlignment="Center"
                                               FontSize="16"
                                               FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               Margin="0,8,0,4" />
                                    <Grid Grid.Row="1" ColumnDefinitions="*,Auto">
                                        <lvc:PieChart Grid.Column="0"
                                                      PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                      Series="{Binding ReturnsByCategorySeries}"
                                                      LegendPosition="Hidden" />
                                        <controls:PieChartLegend Grid.Column="1"
                                                                 PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                                 Items="{Binding ReturnsByCategoryLegend}"
                                                                 MaxHeightOverride="240"
                                                                 Width="200"
                                                                 Margin="8,0,0,0"
                                                                 VerticalAlignment="Center" />
                                    </Grid>
                                </Grid>
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasReturnsByCategoryData}"
                                    DefaultMessage="{loc:Loc 'No category data available'}"
                                    ShowDateRangeMessage="{Binding ShowReturnDateRangeMessage}" />
                            </Panel>
                        </Border>
                    </Grid>

                    <!-- Charts Row 3 -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Returns by Product -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Pie Chart with custom legend - Returns by Product -->
                                <Grid RowDefinitions="Auto,*" IsVisible="{Binding HasReturnsByProductData}">
                                    <TextBlock Grid.Row="0"
                                               Text="{loc:Loc 'Returns by Product'}"
                                               HorizontalAlignment="Center"
                                               FontSize="16"
                                               FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               Margin="0,8,0,4" />
                                    <Grid Grid.Row="1" ColumnDefinitions="*,Auto">
                                        <lvc:PieChart Grid.Column="0"
                                                      PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                      Series="{Binding ReturnsByProductSeries}"
                                                      LegendPosition="Hidden" />
                                        <controls:PieChartLegend Grid.Column="1"
                                                                 PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                                 Items="{Binding ReturnsByProductLegend}"
                                                                 MaxHeightOverride="240"
                                                                 Width="200"
                                                                 Margin="8,0,0,0"
                                                                 VerticalAlignment="Center" />
                                    </Grid>
                                </Grid>
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasReturnsByProductData}"
                                    DefaultMessage="{loc:Loc 'No product data available'}"
                                    ShowDateRangeMessage="{Binding ShowReturnDateRangeMessage}" />
                            </Panel>
                        </Border>

                        <!-- Purchase vs Sale Returns -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Chart - Expense vs Revenue Returns -->
                                <lvc:CartesianChart Title="{Binding ExpenseVsRevenueReturnsTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                    Series="{Binding ExpenseVsRevenueReturnsSeries}"
                                                    XAxes="{Binding ExpenseVsRevenueReturnsXAxes}"
                                                    YAxes="{Binding ExpenseVsRevenueReturnsYAxes}"
                                                    ZoomMode="Both"
                                                    IsVisible="{Binding HasExpenseVsRevenueReturnsData}" />
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasExpenseVsRevenueReturnsData}"
                                    DefaultMessage="{loc:Loc 'No comparison data available'}"
                                    ShowDateRangeMessage="{Binding ShowReturnDateRangeMessage}" />
                            </Panel>
                        </Border>
                    </Grid>
                </StackPanel>

                <!-- Losses Tab Content -->
                <StackPanel Margin="24" Spacing="24"
                            IsVisible="{Binding IsLossesTabSelected}">
                    <!-- Statistics Cards Row -->
                    <controls:StatCardsRow>
                        <controls:StatCard Label="{loc:Loc 'Total Losses'}"
                                           Value="{Binding TotalLosses}"
                                           Icon="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"
                                           IconColor="Danger"
                                           ChangeValue="{Binding LossesChangeValue}"
                                           ChangeText="{Binding LossesChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                        <controls:StatCard Label="{loc:Loc 'Loss Rate'}"
                                           Value="{Binding LossRate}"
                                           Icon="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"
                                           IconColor="Info"
                                           ChangeValue="{Binding LossRateChangeValue}"
                                           ChangeText="{Binding LossRateChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                        <controls:StatCard Label="{loc:Loc 'Financial Impact'}"
                                           Value="{Binding LossesFinancialImpact}"
                                           Icon="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z"
                                           IconColor="Warning"
                                           ChangeValue="{Binding LossesImpactChangeValue}"
                                           ChangeText="{Binding LossesImpactChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                        <controls:StatCard Label="{loc:Loc 'Insurance Claims'}"
                                           Value="{Binding InsuranceClaims}"
                                           Icon="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 16l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"
                                           IconColor="Success"
                                           ChangeValue="{Binding InsuranceClaimsChangeValue}"
                                           ChangeText="{Binding InsuranceClaimsChangeText}"
                                           ChangeLabel="{Binding ComparisonPeriodLabel}" />
                    </controls:StatCardsRow>

                    <!-- Charts Row 1 -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Losses Over Time -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Chart with data -->
                                <lvc:CartesianChart Title="{Binding LossesOverTimeTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                    Series="{Binding LossesOverTimeSeries}"
                                                    XAxes="{Binding LossesOverTimeXAxes}"
                                                    YAxes="{Binding LossesOverTimeYAxes}"
                                                    ZoomMode="Both"
                                                    IsVisible="{Binding HasLossesOverTimeData}" />
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasLossesOverTimeData}"
                                    DefaultMessage="{loc:Loc 'No losses data available'}"
                                    ShowDateRangeMessage="{Binding ShowLossDateRangeMessage}" />
                            </Panel>
                        </Border>

                        <!-- Loss Reasons -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Pie Chart with custom legend -->
                                <Grid RowDefinitions="Auto,*" IsVisible="{Binding HasLossReasonsData}">
                                    <TextBlock Grid.Row="0"
                                               Text="{loc:Loc 'Loss Reasons'}"
                                               HorizontalAlignment="Center"
                                               FontSize="16"
                                               FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               Margin="0,8,0,4" />
                                    <Grid Grid.Row="1" ColumnDefinitions="*,Auto">
                                        <lvc:PieChart Grid.Column="0"
                                                      PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                      Series="{Binding LossReasonsSeries}"
                                                      LegendPosition="Hidden" />
                                        <controls:PieChartLegend Grid.Column="1"
                                                                 PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                                 Items="{Binding LossReasonsLegend}"
                                                                 MaxHeightOverride="240"
                                                                 Width="200"
                                                                 Margin="8,0,0,0"
                                                                 VerticalAlignment="Center" />
                                    </Grid>
                                </Grid>
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasLossReasonsData}"
                                    DefaultMessage="{loc:Loc 'No loss reasons data'}"
                                    ShowDateRangeMessage="{Binding ShowLossDateRangeMessage}" />
                            </Panel>
                        </Border>
                    </Grid>

                    <!-- Charts Row 2 -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Financial Impact of Losses -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Chart with data -->
                                <lvc:CartesianChart Title="{Binding FinancialImpactOfLossesTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                    Series="{Binding LossFinancialImpactSeries}"
                                                    XAxes="{Binding LossFinancialImpactXAxes}"
                                                    YAxes="{Binding LossFinancialImpactYAxes}"
                                                    ZoomMode="Both"
                                                    IsVisible="{Binding HasLossFinancialImpactData}" />
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasLossFinancialImpactData}"
                                    DefaultMessage="{loc:Loc 'No financial impact data'}"
                                    ShowDateRangeMessage="{Binding ShowLossDateRangeMessage}" />
                            </Panel>
                        </Border>

                        <!-- Losses by Category -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Pie Chart with custom legend - Losses by Category -->
                                <Grid RowDefinitions="Auto,*" IsVisible="{Binding HasLossesByCategoryData}">
                                    <TextBlock Grid.Row="0"
                                               Text="{loc:Loc 'Losses by Category'}"
                                               HorizontalAlignment="Center"
                                               FontSize="16"
                                               FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               Margin="0,8,0,4" />
                                    <Grid Grid.Row="1" ColumnDefinitions="*,Auto">
                                        <lvc:PieChart Grid.Column="0"
                                                      PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                      Series="{Binding LossesByCategorySeries}"
                                                      LegendPosition="Hidden" />
                                        <controls:PieChartLegend Grid.Column="1"
                                                                 PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                                 Items="{Binding LossesByCategoryLegend}"
                                                                 MaxHeightOverride="240"
                                                                 Width="200"
                                                                 Margin="8,0,0,0"
                                                                 VerticalAlignment="Center" />
                                    </Grid>
                                </Grid>
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasLossesByCategoryData}"
                                    DefaultMessage="{loc:Loc 'No category data available'}"
                                    ShowDateRangeMessage="{Binding ShowLossDateRangeMessage}" />
                            </Panel>
                        </Border>
                    </Grid>

                    <!-- Charts Row 3 -->
                    <Grid ColumnDefinitions="*,*" Height="300">
                        <!-- Losses by Product -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="0,0,12,0">
                            <Panel>
                                <!-- Pie Chart with custom legend -->
                                <Grid RowDefinitions="Auto,*" IsVisible="{Binding HasLossesByProductData}">
                                    <TextBlock Grid.Row="0"
                                               Text="{loc:Loc 'Losses by Product'}"
                                               HorizontalAlignment="Center"
                                               FontSize="16"
                                               FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               Margin="0,8,0,4" />
                                    <Grid Grid.Row="1" ColumnDefinitions="*,Auto">
                                        <lvc:PieChart Grid.Column="0"
                                                      PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                      Series="{Binding LossesByProductSeries}"
                                                      LegendPosition="Hidden" />
                                        <controls:PieChartLegend Grid.Column="1"
                                                                 PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                                 Items="{Binding LossesByProductLegend}"
                                                                 MaxHeightOverride="240"
                                                                 Width="200"
                                                                 Margin="8,0,0,0"
                                                                 VerticalAlignment="Center" />
                                    </Grid>
                                </Grid>
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasLossesByProductData}"
                                    DefaultMessage="{loc:Loc 'No product data available'}"
                                    ShowDateRangeMessage="{Binding ShowLossDateRangeMessage}" />
                            </Panel>
                        </Border>

                        <!-- Purchase vs Sale Losses -->
                        <Border Grid.Column="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10"
                                Margin="12,0,0,0">
                            <Panel>
                                <!-- Chart - Expense vs Revenue Losses -->
                                <lvc:CartesianChart Title="{Binding ExpenseVsRevenueLossesTitle}"
                                                    PointerPressed="OnChartPointerPressed"
                                                    PointerReleased="OnChartPointerReleased"
                                                    Series="{Binding ExpenseVsRevenueLossesSeries}"
                                                    XAxes="{Binding ExpenseVsRevenueLossesXAxes}"
                                                    YAxes="{Binding ExpenseVsRevenueLossesYAxes}"
                                                    ZoomMode="Both"
                                                    IsVisible="{Binding HasExpenseVsRevenueLossesData}" />
                                <!-- No data placeholder -->
                                <controls:ChartEmptyState
                                    IsVisible="{Binding !HasExpenseVsRevenueLossesData}"
                                    DefaultMessage="{loc:Loc 'No comparison data available'}"
                                    ShowDateRangeMessage="{Binding ShowLossDateRangeMessage}" />
                            </Panel>
                        </Border>
                    </Grid>
                </StackPanel>
            </Panel>
        </ScrollViewer>
    </Grid>

    <!-- Customer Activity Info Modal -->
    <Border Background="{DynamicResource OverlayBrush}"
            IsVisible="{Binding IsCustomerActivityInfoOpen}"
            IsHitTestVisible="True"
            PointerPressed="CustomerActivityInfoBackdrop_PointerPressed">
        <Border Background="{DynamicResource SurfaceBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="12"
                Width="450"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                BoxShadow="0 8 32 0 #40000000"
                PointerPressed="CustomerActivityInfoModal_PointerPressed">
            <Grid RowDefinitions="Auto,*,Auto">
                <!-- Header -->
                <Border Grid.Row="0"
                        Padding="24,20"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="0,0,0,1">
                    <Grid ColumnDefinitions="*,Auto">
                        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12">
                            <PathIcon Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"
                                      Width="24" Height="24"
                                      Foreground="{DynamicResource PrimaryBrush}" />
                            <TextBlock Text="{loc:Loc 'Customer Activity'}"
                                       FontSize="18"
                                       FontWeight="SemiBold"
                                       VerticalAlignment="Center"
                                       Foreground="{DynamicResource TextPrimaryBrush}" />
                        </StackPanel>
                        <Button Grid.Column="1"
                                Classes="info-button"
                                Command="{Binding CloseCustomerActivityInfoCommand}">
                            <PathIcon Data="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
                                      Width="18" Height="18" />
                        </Button>
                    </Grid>
                </Border>

                <!-- Body -->
                <Border Grid.Row="1" Padding="24,20">
                    <StackPanel Spacing="16">
                        <TextBlock Text="{loc:Loc 'How is customer activity determined?'}"
                                   FontSize="15"
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextPrimaryBrush}" />

                        <TextBlock Text="{loc:Loc 'A customer is considered active if they have made at least one purchase within the selected date range.'}"
                                   TextWrapping="Wrap"
                                   FontSize="14"
                                   LineHeight="22"
                                   Foreground="{DynamicResource TextSecondaryBrush}" />

                        <TextBlock Text="{loc:Loc 'Customers with no purchases in this period are marked as inactive.'}"
                                   TextWrapping="Wrap"
                                   FontSize="14"
                                   LineHeight="22"
                                   Foreground="{DynamicResource TextSecondaryBrush}" />

                        <Border Background="{DynamicResource SurfaceAltBrush}"
                                CornerRadius="8"
                                Padding="16"
                                Margin="0,8,0,0">
                            <StackPanel Spacing="8">
                                <TextBlock Text="{loc:Loc Tip}"
                                           FontSize="13"
                                           FontWeight="SemiBold"
                                           Foreground="{DynamicResource PrimaryBrush}" />
                                <TextBlock Text="{loc:Loc 'Change the date range at the top of the page to see customer activity over different time periods. For example, select ''All Time'' to see lifetime activity.'}"
                                           TextWrapping="Wrap"
                                           FontSize="13"
                                           LineHeight="20"
                                           Foreground="{DynamicResource TextSecondaryBrush}" />
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Border>

                <!-- Footer -->
                <Border Grid.Row="2"
                        Padding="24,16"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="0,1,0,0">
                    <Button Classes="primary-button"
                            Content="{loc:Loc 'Got it'}"
                            HorizontalAlignment="Right"
                            Command="{Binding CloseCustomerActivityInfoCommand}" />
                </Border>
            </Grid>
        </Border>
    </Border>

    <!-- Global Chart Context Menu (rendered on top of everything) -->
    <controls:ChartContextMenu x:Name="ChartContextMenu"
                               IsOpen="{Binding IsChartContextMenuOpen}"
                               MenuX="{Binding ChartContextMenuX}"
                               MenuY="{Binding ChartContextMenuY}"
                               ShowResetZoom="{Binding ShowChartResetZoom}"
                               ShowExportOptions="{Binding ShowChartExportOptions}"
                               SaveChartAsImageCommand="{Binding SaveChartAsImageCommand}"
                               ExportToGoogleSheetsCommand="{Binding ExportToGoogleSheetsCommand}"
                               ExportToExcelCommand="{Binding ExportToExcelCommand}"
                               ResetChartZoomCommand="{Binding ResetChartZoomCommand}"
                               CloseCommand="{Binding HideChartContextMenuCommand}" />

    <!-- Custom Date Range Modal -->
    <modals:CustomDateRangeModal />
    </Panel>

    <UserControl.Styles>
        <!-- TabControl - page tabs styling -->
        <Style Selector="TabControl.page-tabs">
            <Setter Property="Background" Value="Transparent" />
        </Style>
        <Style Selector="TabControl.page-tabs /template/ ItemsPresenter#PART_ItemsPresenter">
            <Setter Property="Margin" Value="24,0" />
        </Style>
        <Style Selector="TabControl.page-tabs /template/ Border#PART_InnerBorder">
            <Setter Property="BorderThickness" Value="0" />
        </Style>
        <Style Selector="TabControl.page-tabs /template/ ContentPresenter#PART_SelectedContentHost">
            <Setter Property="IsVisible" Value="False" />
        </Style>

        <!-- Tab Item Styling -->
        <Style Selector="TabControl.page-tabs TabItem">
            <Setter Property="FontSize" Value="14" />
            <Setter Property="FontWeight" Value="Medium" />
            <Setter Property="Padding" Value="4,12,4,10" />
            <Setter Property="Margin" Value="8,0" />
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>
        <Style Selector="TabControl.page-tabs TabItem:pointerover">
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
        </Style>
        <Style Selector="TabControl.page-tabs TabItem:pointerover /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="TextBlock.Foreground" Value="{DynamicResource TextPrimaryBrush}" />
        </Style>
        <Style Selector="TabControl.page-tabs TabItem:selected">
            <Setter Property="Foreground" Value="{DynamicResource PrimaryBrush}" />
        </Style>
        <Style Selector="TabControl.page-tabs TabItem:selected /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="TextBlock.Foreground" Value="{DynamicResource PrimaryBrush}" />
        </Style>
        <Style Selector="TabControl.page-tabs TabItem:selected /template/ Border#PART_SelectedPipe">
            <Setter Property="IsVisible" Value="True" />
            <Setter Property="Background" Value="{DynamicResource PrimaryBrush}" />
            <Setter Property="Height" Value="2" />
            <Setter Property="VerticalAlignment" Value="Bottom" />
            <Setter Property="Margin" Value="0,0,0,0" />
            <Setter Property="CornerRadius" Value="1" />
        </Style>

        <!-- Chart Toggle Switch -->
        <Style Selector="ToggleSwitch.chart-toggle">
            <Setter Property="Width" Value="44" />
            <Setter Property="Height" Value="24" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="ClipToBounds" Value="False" />
        </Style>
        <Style Selector="ToggleSwitch.chart-toggle /template/ Grid">
            <Setter Property="ClipToBounds" Value="False" />
        </Style>
        <Style Selector="ToggleSwitch.chart-toggle /template/ Border#SwitchKnobBounds">
            <Setter Property="Background" Value="{DynamicResource SurfaceAltBrush}" />
            <Setter Property="CornerRadius" Value="12" />
        </Style>
        <Style Selector="ToggleSwitch.chart-toggle:checked /template/ Border#SwitchKnobBounds">
            <Setter Property="Background" Value="{DynamicResource PrimaryBrush}" />
        </Style>

        <!-- Segmented Button (RadioButton) -->
        <Style Selector="RadioButton.segmented-button">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}" />
            <Setter Property="Padding" Value="12,6" />
            <Setter Property="CornerRadius" Value="4" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="FontWeight" Value="Medium" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <ControlTemplate>
                    <Border Background="{TemplateBinding Background}"
                            CornerRadius="{TemplateBinding CornerRadius}"
                            Padding="{TemplateBinding Padding}">
                        <ContentPresenter Content="{TemplateBinding Content}"
                                          HorizontalAlignment="Center"
                                          VerticalAlignment="Center" />
                    </Border>
                </ControlTemplate>
            </Setter>
        </Style>
        <Style Selector="RadioButton.segmented-button:pointerover">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
        </Style>
        <Style Selector="RadioButton.segmented-button:checked">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
            <Setter Property="Foreground" Value="{DynamicResource PrimaryBrush}" />
        </Style>

        <!-- Info Button -->
        <Style Selector="Button.info-button">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="6" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>
        <Style Selector="Button.info-button /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="Transparent" />
        </Style>
        <Style Selector="Button.info-button:pointerover /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource SurfaceAltBrush}" />
        </Style>
        <Style Selector="Button.info-button PathIcon">
            <Setter Property="Foreground" Value="{DynamicResource TextTertiaryBrush}" />
        </Style>
        <Style Selector="Button.info-button:pointerover PathIcon">
            <Setter Property="Foreground" Value="{DynamicResource PrimaryBrush}" />
        </Style>
    </UserControl.Styles>
</UserControl>
