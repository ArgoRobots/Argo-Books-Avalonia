<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:controls="using:ArgoBooks.Controls"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="500"
             x:Class="ArgoBooks.Controls.ResizableDataGrid"
             x:DataType="controls:ResizableDataGrid"
             x:Name="Root">

    <UserControl.Styles>
        <!-- Column Header Style -->
        <Style Selector="TextBlock.column-header">
            <Setter Property="FontSize" Value="12" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="TextTrimming" Value="CharacterEllipsis" />
        </Style>

        <!-- Resize Handle Style -->
        <Style Selector="Border.resize-handle">
            <Setter Property="Width" Value="8" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Cursor" Value="SizeWestEast" />
            <Setter Property="Margin" Value="-4,0" />
            <Setter Property="ZIndex" Value="100" />
        </Style>
        <Style Selector="Border.resize-handle:pointerover">
            <Setter Property="Background" Value="{DynamicResource PrimaryBrush}" />
            <Setter Property="Opacity" Value="0.3" />
        </Style>
        <Style Selector="Border.resize-handle.resizing">
            <Setter Property="Background" Value="{DynamicResource PrimaryBrush}" />
            <Setter Property="Opacity" Value="0.5" />
        </Style>

        <!-- Cell Style -->
        <Style Selector="TextBlock.cell">
            <Setter Property="FontSize" Value="14" />
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="TextTrimming" Value="CharacterEllipsis" />
        </Style>

        <!-- Row Style -->
        <Style Selector="Border.data-row">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
            <Setter Property="BorderThickness" Value="0,0,0,1" />
            <Setter Property="Padding" Value="0,16" />
        </Style>
        <Style Selector="Border.data-row:pointerover">
            <Setter Property="Background" Value="{DynamicResource TableRowHoverBrush}" />
        </Style>
    </UserControl.Styles>

    <Grid RowDefinitions="Auto,*">
        <!-- Column Headers -->
        <Border Grid.Row="0"
                x:Name="HeaderBorder"
                Background="{DynamicResource SurfaceAltBrush}"
                Padding="{Binding HeaderPadding, ElementName=Root}">
            <Canvas x:Name="HeaderCanvas" Height="24" ClipToBounds="True">
                <!-- Headers are added programmatically -->
            </Canvas>
        </Border>

        <!-- Data Rows (scrollable) -->
        <ScrollViewer Grid.Row="1"
                      x:Name="ContentScrollViewer"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled">
            <ItemsControl x:Name="RowsContainer"
                          ItemsSource="{Binding ItemsSource, ElementName=Root}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Classes="data-row"
                                Padding="{Binding RowPadding, ElementName=Root}">
                            <Canvas x:Name="RowCanvas"
                                    Height="24"
                                    ClipToBounds="True"
                                    Tag="{Binding}">
                                <!-- Cells are added programmatically via code-behind -->
                            </Canvas>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Empty State -->
        <Border Grid.Row="1"
                Padding="32"
                IsVisible="{Binding !HasItems, ElementName=Root}">
            <StackPanel HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Spacing="8">
                <PathIcon Data="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zM7 10h2v7H7zm4-3h2v10h-2zm4 6h2v4h-2z"
                          Width="48" Height="48"
                          Foreground="{DynamicResource TextTertiaryBrush}" />
                <TextBlock Text="{Binding EmptyMessage, ElementName=Root}"
                           FontSize="14"
                           Foreground="{DynamicResource TextSecondaryBrush}"
                           HorizontalAlignment="Center" />
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
