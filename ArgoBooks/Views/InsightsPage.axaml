<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:ArgoBooks.ViewModels"
             xmlns:controls="using:ArgoBooks.Controls"
             xmlns:modals="using:ArgoBooks.Modals"
             xmlns:loc="using:ArgoBooks.Localization"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
             x:Class="ArgoBooks.Views.InsightsPage"
             x:DataType="vm:InsightsPageViewModel">

    <Design.DataContext>
        <vm:InsightsPageViewModel />
    </Design.DataContext>

    <!-- Main Content -->
    <Panel>
    <ScrollViewer VerticalScrollBarVisibility="Auto"
                  HorizontalScrollBarVisibility="Disabled">
        <Grid RowDefinitions="Auto,Auto,Auto,*" Margin="24">
            <!-- Statistics Cards Row -->
            <controls:StatCardsRow Grid.Row="0" Margin="0,0,0,24">
                <controls:StatCard Label="{loc:Loc 'AI Insights'}"
                                   Value="{Binding TotalInsights}"
                                   Icon="M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19C8.14 2 5 5.14 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7zm2.85 11.1l-.85.6V16h-4v-2.3l-.85-.6C7.8 12.16 7 10.63 7 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 1.63-.8 3.16-2.15 4.1z"
                                   IconColor="Info" />
                <controls:StatCard Label="{loc:Loc 'Trends Detected'}"
                                   Value="{Binding TrendsDetected}"
                                   Icon="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"
                                   IconColor="Success" />
                <controls:StatCard Label="{loc:Loc Anomalies}"
                                   Value="{Binding AnomaliesDetected}"
                                   Icon="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"
                                   IconColor="Warning" />
                <controls:StatCard Label="{loc:Loc Opportunities}"
                                   Value="{Binding Opportunities}"
                                   Icon="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
                                   IconColor="Primary" />
            </controls:StatCardsRow>

            <!-- Page Header (Row 1) -->
            <Border Grid.Row="1"
                    Background="{DynamicResource SurfaceBrush}"
                    CornerRadius="12"
                    BorderBrush="{DynamicResource BorderBrush}"
                    BorderThickness="1"
                    Padding="24,20"
                    Margin="0,0,0,24">
                <Grid ColumnDefinitions="Auto,*,Auto">
                    <!-- AI Icon and Title -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="16" VerticalAlignment="Center">
                        <Border Width="48" Height="48"
                                CornerRadius="10"
                                Background="{DynamicResource PrimaryLightBrush}">
                            <PathIcon Data="M21 10.12h-6.78l2.74-2.82c-2.73-2.7-7.15-2.8-9.88-.1-2.73 2.71-2.73 7.08 0 9.79s7.15 2.71 9.88 0C18.32 15.65 19 14.08 19 12.1h2c0 1.98-.88 4.55-2.64 6.29-3.51 3.48-9.21 3.48-12.72 0-3.5-3.47-3.53-9.11-.02-12.58s9.14-3.47 12.65 0L21 3v7.12zM12.5 8v4.25l3.5 2.08-.72 1.21L11 13V8h1.5z"
                                      Width="24" Height="24"
                                      Foreground="{DynamicResource PrimaryBrush}" />
                        </Border>
                        <StackPanel>
                            <TextBlock Text="{loc:Loc 'AI Business Insights'}"
                                       FontSize="20"
                                       FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextPrimaryBrush}" />
                            <TextBlock Text="{loc:Loc 'Intelligent analysis of your business data'}"
                                       FontSize="13"
                                       Foreground="{DynamicResource TextSecondaryBrush}" />
                        </StackPanel>
                    </StackPanel>

                    <!-- Last Updated -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                        <TextBlock Text="{loc:Loc 'Last updated:'}"
                                   FontSize="13"
                                   Foreground="{DynamicResource TextTertiaryBrush}"
                                   VerticalAlignment="Center" />
                        <TextBlock Text="{Binding LastUpdated}"
                                   FontSize="13"
                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                   VerticalAlignment="Center" />
                        <Button Classes="secondary-button"
                                Margin="16,0,0,0"
                                Command="{Binding RefreshInsightsCommand}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <PathIcon Classes.sync-spinning="{Binding IsRefreshing}"
                                          Data="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"
                                          Width="16" Height="16"
                                          RenderTransformOrigin="50%,50%">
                                    <PathIcon.RenderTransform>
                                        <RotateTransform />
                                    </PathIcon.RenderTransform>
                                </PathIcon>
                                <TextBlock Text="{loc:Loc Refresh}" />
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Forecasted Growth Section (Row 2) -->
            <Border Grid.Row="2"
                    Background="{DynamicResource SurfaceBrush}"
                    CornerRadius="12"
                    BorderBrush="{DynamicResource BorderBrush}"
                    BorderThickness="1"
                    Padding="24"
                    Margin="0,0,0,24">
                <StackPanel Spacing="20">
                    <!-- Section Header -->
                    <Grid ColumnDefinitions="Auto,*,Auto">
                        <Border Grid.Column="0"
                                Width="32" Height="32"
                                CornerRadius="8"
                                Background="#DBEAFE"
                                Margin="0,0,12,0">
                            <PathIcon Data="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"
                                      Width="16" Height="16"
                                      Foreground="#3B82F6" />
                        </Border>
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock Text="{loc:Loc 'Forecasted Growth'}"
                                       FontSize="16"
                                       FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextPrimaryBrush}" />
                            <TextBlock Text="{loc:Loc 'Predictions based on historical data and market trends'}"
                                       FontSize="12"
                                       Foreground="{DynamicResource TextTertiaryBrush}" />
                        </StackPanel>
                        <!-- Date Range Selector -->
                        <controls:DateRangeSelector Grid.Column="2" VerticalAlignment="Top" />
                    </Grid>

                    <!-- Forecast Cards Row -->
                    <controls:StatCardsRow>
                        <controls:StatCard Label="{loc:Loc 'Next Month Revenue'}"
                                           Value="{Binding ForecastedRevenue}"
                                           ChangeValue="{Binding RevenueGrowthValue}"
                                           ChangeText="{Binding RevenueGrowth}"
                                           ChangeLabel="{loc:Loc 'from current period'}"
                                           UseAltBackground="True" />
                        <controls:StatCard Label="{loc:Loc 'Next Month Expenses'}"
                                           Value="{Binding ForecastedExpenses}"
                                           ChangeValue="{Binding ExpenseGrowthValue}"
                                           ChangeText="{Binding ExpenseGrowth}"
                                           ChangeLabel="{loc:Loc 'from current period'}"
                                           UseAltBackground="True" />
                        <controls:StatCard Label="{loc:Loc 'Projected Profit'}"
                                           Value="{Binding ForecastedProfit}"
                                           ChangeValue="{Binding ProfitGrowthValue}"
                                           ChangeText="{Binding ProfitGrowth}"
                                           ChangeLabel="{loc:Loc 'from current period'}"
                                           ValueColor="Success"
                                           UseAltBackground="True" />
                        <controls:StatCard Label="{loc:Loc 'Expected New Customers'}"
                                           Value="{Binding ForecastedCustomers}"
                                           ChangeValue="{Binding CustomerGrowthValue}"
                                           ChangeText="{Binding CustomerGrowth}"
                                           ChangeLabel="{loc:Loc 'from current period'}"
                                           UseAltBackground="True" />
                    </controls:StatCardsRow>

                    <!-- Confidence Indicator -->
                    <Border Background="{DynamicResource SurfaceAltBrush}"
                            CornerRadius="8"
                            Padding="16">
                        <Grid ColumnDefinitions="Auto,*,Auto">
                            <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                                <PathIcon Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
                                          Width="16" Height="16"
                                          Foreground="#22C55E" />
                                <TextBlock Text="{loc:Loc 'Prediction Confidence:'}"
                                           FontSize="13"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           VerticalAlignment="Center" />
                                <TextBlock Text="{Binding PredictionConfidence}"
                                           FontSize="13"
                                           FontWeight="SemiBold"
                                           Foreground="#22C55E"
                                           VerticalAlignment="Center" />
                            </StackPanel>
                            <TextBlock Grid.Column="2"
                                       Text="{loc:Loc 'Based on 12 months of historical data'}"
                                       FontSize="12"
                                       Foreground="{DynamicResource TextTertiaryBrush}"
                                       VerticalAlignment="Center" />
                        </Grid>
                    </Border>
                </StackPanel>
            </Border>

            <!-- Insights Content (Row 3) -->
            <Grid Grid.Row="3" ColumnDefinitions="*,*">
                <!-- Left Column -->
                <StackPanel Grid.Column="0" Spacing="16" Margin="0,0,12,0">
                    <!-- Revenue Trends Section -->
                    <Border Background="{DynamicResource SurfaceBrush}"
                            CornerRadius="12"
                            BorderBrush="{DynamicResource BorderBrush}"
                            BorderThickness="1">
                        <StackPanel>
                            <Border Padding="20"
                                    BorderBrush="{DynamicResource BorderBrush}"
                                    BorderThickness="0,0,0,1">
                                <Grid ColumnDefinitions="Auto,*">
                                    <Border Grid.Column="0"
                                            Width="32" Height="32"
                                            CornerRadius="8"
                                            Background="#DCFCE7"
                                            Margin="0,0,12,0">
                                        <PathIcon Data="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"
                                                  Width="16" Height="16"
                                                  Foreground="#22C55E" />
                                    </Border>
                                    <TextBlock Grid.Column="1"
                                               Text="{loc:Loc 'Revenue Trends'}"
                                               FontSize="16"
                                               FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               VerticalAlignment="Center" />
                                </Grid>
                            </Border>
                            <ItemsControl ItemsSource="{Binding RevenueTrends}" Margin="0">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate DataType="vm:InsightItem">
                                        <Border Padding="20"
                                                BorderBrush="{DynamicResource BorderBrush}"
                                                BorderThickness="0,0,0,1"
                                                Classes.last-item="{Binding IsLastItem}">
                                            <Border.Styles>
                                                <Style Selector="Border.last-item">
                                                    <Setter Property="BorderThickness" Value="0" />
                                                </Style>
                                            </Border.Styles>
                                            <Grid ColumnDefinitions="Auto,*">
                                                <Border Grid.Column="0"
                                                        Width="8" Height="8"
                                                        CornerRadius="4"
                                                        Background="{Binding StatusColor}"
                                                        Margin="0,6,12,0"
                                                        VerticalAlignment="Top" />
                                                <StackPanel Grid.Column="1" Spacing="4">
                                                    <TextBlock Text="{Binding Title}"
                                                               FontSize="14"
                                                               FontWeight="Medium"
                                                               Foreground="{DynamicResource TextPrimaryBrush}" />
                                                    <TextBlock Text="{Binding Description}"
                                                               FontSize="13"
                                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                                               TextWrapping="Wrap" />
                                                    <TextBlock Text="{Binding Recommendation}"
                                                               FontSize="12"
                                                               Foreground="{DynamicResource PrimaryBrush}"
                                                               Margin="0,4,0,0"
                                                               IsVisible="{Binding HasRecommendation}" />
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>

                    <!-- Forecasting Section -->
                    <Border Background="{DynamicResource SurfaceBrush}"
                            CornerRadius="12"
                            BorderBrush="{DynamicResource BorderBrush}"
                            BorderThickness="1">
                        <StackPanel>
                            <Border Padding="20"
                                    BorderBrush="{DynamicResource BorderBrush}"
                                    BorderThickness="0,0,0,1">
                                <Grid ColumnDefinitions="Auto,*">
                                    <Border Grid.Column="0"
                                            Width="32" Height="32"
                                            CornerRadius="8"
                                            Background="#EDE9FE"
                                            Margin="0,0,12,0">
                                        <PathIcon Data="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"
                                                  Width="16" Height="16"
                                                  Foreground="#8B5CF6" />
                                    </Border>
                                    <TextBlock Grid.Column="1"
                                               Text="{loc:Loc Forecasting}"
                                               FontSize="16"
                                               FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               VerticalAlignment="Center" />
                                </Grid>
                            </Border>
                            <ItemsControl ItemsSource="{Binding Forecasts}" Margin="0">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate DataType="vm:InsightItem">
                                        <Border Padding="20"
                                                BorderBrush="{DynamicResource BorderBrush}"
                                                BorderThickness="0,0,0,1"
                                                Classes.last-item="{Binding IsLastItem}">
                                            <Border.Styles>
                                                <Style Selector="Border.last-item">
                                                    <Setter Property="BorderThickness" Value="0" />
                                                </Style>
                                            </Border.Styles>
                                            <Grid ColumnDefinitions="Auto,*">
                                                <Border Grid.Column="0"
                                                        Width="8" Height="8"
                                                        CornerRadius="4"
                                                        Background="{Binding StatusColor}"
                                                        Margin="0,6,12,0"
                                                        VerticalAlignment="Top" />
                                                <StackPanel Grid.Column="1" Spacing="4">
                                                    <TextBlock Text="{Binding Title}"
                                                               FontSize="14"
                                                               FontWeight="Medium"
                                                               Foreground="{DynamicResource TextPrimaryBrush}" />
                                                    <TextBlock Text="{Binding Description}"
                                                               FontSize="13"
                                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                                               TextWrapping="Wrap" />
                                                    <TextBlock Text="{Binding Recommendation}"
                                                               FontSize="12"
                                                               Foreground="{DynamicResource PrimaryBrush}"
                                                               Margin="0,4,0,0"
                                                               IsVisible="{Binding HasRecommendation}" />
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- Right Column -->
                <StackPanel Grid.Column="1" Spacing="16" Margin="12,0,0,0">
                    <!-- Anomalies Section -->
                    <Border Background="{DynamicResource SurfaceBrush}"
                            CornerRadius="12"
                            BorderBrush="{DynamicResource BorderBrush}"
                            BorderThickness="1">
                        <StackPanel>
                            <Border Padding="20"
                                    BorderBrush="{DynamicResource BorderBrush}"
                                    BorderThickness="0,0,0,1">
                                <Grid ColumnDefinitions="Auto,*">
                                    <Border Grid.Column="0"
                                            Width="32" Height="32"
                                            CornerRadius="8"
                                            Background="#FEF3C7"
                                            Margin="0,0,12,0">
                                        <PathIcon Data="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"
                                                  Width="16" Height="16"
                                                  Foreground="#F59E0B" />
                                    </Border>
                                    <TextBlock Grid.Column="1"
                                               Text="{loc:Loc 'Anomaly Detection'}"
                                               FontSize="16"
                                               FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               VerticalAlignment="Center" />
                                </Grid>
                            </Border>
                            <ItemsControl ItemsSource="{Binding Anomalies}" Margin="0">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate DataType="vm:InsightItem">
                                        <Border Padding="20"
                                                BorderBrush="{DynamicResource BorderBrush}"
                                                BorderThickness="0,0,0,1"
                                                Classes.last-item="{Binding IsLastItem}">
                                            <Border.Styles>
                                                <Style Selector="Border.last-item">
                                                    <Setter Property="BorderThickness" Value="0" />
                                                </Style>
                                            </Border.Styles>
                                            <Grid ColumnDefinitions="Auto,*">
                                                <Border Grid.Column="0"
                                                        Width="8" Height="8"
                                                        CornerRadius="4"
                                                        Background="{Binding StatusColor}"
                                                        Margin="0,6,12,0"
                                                        VerticalAlignment="Top" />
                                                <StackPanel Grid.Column="1" Spacing="4">
                                                    <TextBlock Text="{Binding Title}"
                                                               FontSize="14"
                                                               FontWeight="Medium"
                                                               Foreground="{DynamicResource TextPrimaryBrush}" />
                                                    <TextBlock Text="{Binding Description}"
                                                               FontSize="13"
                                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                                               TextWrapping="Wrap" />
                                                    <TextBlock Text="{Binding Recommendation}"
                                                               FontSize="12"
                                                               Foreground="{DynamicResource PrimaryBrush}"
                                                               Margin="0,4,0,0"
                                                               IsVisible="{Binding HasRecommendation}" />
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>

                    <!-- Recommendations Section -->
                    <Border Background="{DynamicResource SurfaceBrush}"
                            CornerRadius="12"
                            BorderBrush="{DynamicResource BorderBrush}"
                            BorderThickness="1">
                        <StackPanel>
                            <Border Padding="20"
                                    BorderBrush="{DynamicResource BorderBrush}"
                                    BorderThickness="0,0,0,1">
                                <Grid ColumnDefinitions="Auto,*">
                                    <Border Grid.Column="0"
                                            Width="32" Height="32"
                                            CornerRadius="8"
                                            Background="#DBEAFE"
                                            Margin="0,0,12,0">
                                        <PathIcon Data="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
                                                  Width="16" Height="16"
                                                  Foreground="#3B82F6" />
                                    </Border>
                                    <TextBlock Grid.Column="1"
                                               Text="{loc:Loc Recommendations}"
                                               FontSize="16"
                                               FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               VerticalAlignment="Center" />
                                </Grid>
                            </Border>
                            <ItemsControl ItemsSource="{Binding Recommendations}" Margin="0">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate DataType="vm:InsightItem">
                                        <Border Padding="20"
                                                BorderBrush="{DynamicResource BorderBrush}"
                                                BorderThickness="0,0,0,1"
                                                Classes.last-item="{Binding IsLastItem}">
                                            <Border.Styles>
                                                <Style Selector="Border.last-item">
                                                    <Setter Property="BorderThickness" Value="0" />
                                                </Style>
                                            </Border.Styles>
                                            <Grid ColumnDefinitions="Auto,*">
                                                <Border Grid.Column="0"
                                                        Width="8" Height="8"
                                                        CornerRadius="4"
                                                        Background="{Binding StatusColor}"
                                                        Margin="0,6,12,0"
                                                        VerticalAlignment="Top" />
                                                <StackPanel Grid.Column="1" Spacing="4">
                                                    <TextBlock Text="{Binding Title}"
                                                               FontSize="14"
                                                               FontWeight="Medium"
                                                               Foreground="{DynamicResource TextPrimaryBrush}" />
                                                    <TextBlock Text="{Binding Description}"
                                                               FontSize="13"
                                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                                               TextWrapping="Wrap" />
                                                    <TextBlock Text="{Binding Recommendation}"
                                                               FontSize="12"
                                                               Foreground="{DynamicResource PrimaryBrush}"
                                                               Margin="0,4,0,0"
                                                               IsVisible="{Binding HasRecommendation}" />
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Grid>
        </Grid>
    </ScrollViewer>

    <!-- Custom Date Range Modal -->
    <modals:CustomDateRangeModal />
    </Panel>
</UserControl>
